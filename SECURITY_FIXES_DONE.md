# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - –í—ã–ø–æ–ª–Ω–µ–Ω–æ

## –ß—Ç–æ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. ‚úÖ Rate Limiting
- –î–æ–±–∞–≤–ª–µ–Ω `flask-limiter`
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç: 200 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å, 50/—á–∞—Å
- Endpoint `/api/work`: 30 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
- Endpoint `/api/set_name`: 5 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É

### 2. ‚úÖ Race Conditions
- –î–æ–±–∞–≤–ª–µ–Ω `cache_lock` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –§—É–Ω–∫—Ü–∏–∏ `get_user_data()` –∏ `update_user_data()` thread-safe
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫—ç—à–µ–º –∑–∞—â–∏—â–µ–Ω—ã Lock

### 3. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ù–∞—Å—Ç—Ä–æ–µ–Ω logging —Å —É—Ä–æ–≤–Ω–µ–º INFO
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—à–∏–±–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏

### 4. ‚úÖ CORS Security
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- –¢–æ–ª—å–∫–æ Telegram –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω

### 5. ‚úÖ Health Check
- Endpoint `/health` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ë–î
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ timestamp

### 6. ‚úÖ Database Optimization
- –î–æ–±–∞–≤–ª–µ–Ω –∏–Ω–¥–µ–∫—Å –Ω–∞ `last_updated`
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∑–∞–ø—Ä–æ—Å leaderboard (LIMIT 1000)

### 7. ‚úÖ Error Handling
- –û–±—Ä–∞–±–æ—Ç–∫–∞ JSON.JSONDecodeError –≤ leaderboard
- Try-catch –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 8. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `verify_telegram_webapp_data()`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ HMAC –ø–æ–¥–ø–∏—Å–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏ user_id

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é:

### 1. ‚ö†Ô∏è –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
–í `templates/simple.html` –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å `initData`:

```javascript
// –í –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞
const tg = window.Telegram.WebApp;
const initData = tg.initData || 'demo';

// –í –∫–∞–∂–¥–æ–º fetch –∑–∞–ø—Ä–æ—Å–µ –¥–æ–±–∞–≤–∏—Ç—å:
headers: {
    'Content-Type': 'application/json',
    'X-Telegram-Init-Data': initData
}
```

### 2. ‚ö†Ô∏è –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ –±—ç–∫–µ–Ω–¥–µ
–í –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ API –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É:

```python
@app.route('/api/work', methods=['POST'])
@limiter.limit("30 per minute")
def work():
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram –¥–∞–Ω–Ω—ã–µ
    init_data = request.headers.get('X-Telegram-Init-Data')
    if not verify_telegram_webapp_data(init_data):
        logger.warning(f"Invalid Telegram data from {request.remote_addr}")
        return jsonify({"error": "Unauthorized"}), 401
    
    # –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥...
```

### 3. ‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±—ç–∫–∞–ø—ã
–°–º. —Ñ–∞–π–ª `BACKUP_SETUP.md`

### 4. ‚ö†Ô∏è –ü–æ–¥–∫–ª—é—á–∏—Ç—å Sentry (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
pip install sentry-sdk[flask]
```

```python
import sentry_sdk
from sentry_sdk.integrations.flask import FlaskIntegration

sentry_sdk.init(
    dsn="your-sentry-dsn",
    integrations=[FlaskIntegration()],
    traces_sample_rate=1.0
)
```

### 5. ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é Git –Ω–∞ —Ç–æ–∫–µ–Ω—ã
```bash
git log --all --full-history -- .env
```

–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –±—ã–ª –∑–∞–∫–æ–º–º–∏—á–µ–Ω - —Å–æ–∑–¥–∞–π –Ω–æ–≤—ã–π —É @BotFather!

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä—å rate limiting:
```bash
# –û—Ç–ø—Ä–∞–≤—å 35 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–¥—Ä—è–¥ - –¥–æ–ª–∂–µ–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
for i in {1..35}; do
  curl -X POST http://localhost:5000/api/work \
    -H "Content-Type: application/json" \
    -d '{"user_id":"test"}'
done
```

### –ü—Ä–æ–≤–µ—Ä—å health check:
```bash
curl http://localhost:5000/health
```

### –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:
```bash
# –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
tail -f logs/app.log
```

---

## –û—Ü–µ–Ω–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

**–î–æ:** 40% üî¥
**–ü–æ—Å–ª–µ:** 75% üü°

### –û—Å—Ç–∞–ª–æ—Å—å –¥–ª—è 100%:
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é Telegram –≤–æ –≤—Å–µ—Ö endpoints (15%)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã (5%)
- –ü–æ–¥–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry) (5%)

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –ª–æ–∫–∞–ª—å–Ω–æ
2. –ó–∞–¥–µ–ø–ª–æ–π –Ω–∞ Render
3. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç
4. –ù–∞—Å—Ç—Ä–æ–π –±—ç–∫–∞–ø—ã
5. –ú–æ–Ω–∏—Ç–æ—Ä—å –ª–æ–≥–∏ –ø–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞
6. –ì–æ—Ç–æ–≤ –∫ –º—è–≥–∫–æ–º—É –∑–∞–ø—É—Å–∫—É! üöÄ
