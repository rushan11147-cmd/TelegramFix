<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–í—ã–∂–∏–≤–∏ –¥–æ –∑–∞—Ä–ø–ª–∞—Ç—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('/static/game-background.jpg.jpg') center center / cover no-repeat fixed;
            color: #2c3e50;
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }
        
        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 100%;
            overflow: hidden;
            padding: 0;
        }
        
        .top-bar {
            background: linear-gradient(135deg, #2c5f8d 0%, #1e4266 100%);
            border-radius: 20px;
            padding: 10px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        
        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .main-area {
            flex: 1;
            display: flex;
            gap: 0;
            align-items: stretch;
            justify-content: center;
            overflow: hidden;
            padding: 0;
        }
        
        .character-area {
            flex: 0.3;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 0;
        }
        
        .character-card {
            display: none;
        }
        
        .character-image {
            display: none;
        }
        
        .character-image img {
            display: none;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞—Ä–∞ –æ—Ç –∫–æ—Ñ–µ */
        @keyframes steam {
            0% {
                transform: translateY(0) scale(1);
                opacity: 0.8;
            }
            50% {
                transform: translateY(-30px) scale(1.2);
                opacity: 0.4;
            }
            100% {
                transform: translateY(-60px) scale(1.5);
                opacity: 0;
            }
        }
        
        .steam {
            position: absolute;
            width: 8px;
            height: 20px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            filter: blur(4px);
            animation: steam 2s ease-out infinite;
        }
        
        .steam:nth-child(1) {
            left: 45%;
            animation-delay: 0s;
        }
        
        .steam:nth-child(2) {
            left: 50%;
            animation-delay: 0.5s;
        }
        
        .steam:nth-child(3) {
            left: 55%;
            animation-delay: 1s;
        }
        
        /* –§–æ–Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏—Ü—ã */
        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
            }
            50% {
                transform: translateY(-20px) translateX(10px);
            }
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 4s ease-in-out infinite;
        }
        
        .character-level-badge {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            z-index: 10;
        }
        
        .right-panel { 
            width: 65%;
            min-width: 340px;
            max-width: 550px;
            background: linear-gradient(135deg, #f5f0e8 0%, #e8dcc0 100%);
            border-radius: 25px;
            padding: 18px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            border: 6px solid #d4c4a0;
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
            margin: 10px 10px 10px 0;
        }
        
        .stat-bar {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            border-radius: 15px;
            padding: 6px 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .stat-bar::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: var(--progress, 100%);
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            transition: width 0.3s ease;
        }
        
        .stat-bar.mood {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        }
        
        .stat-bar.health {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        
        .stat-bar-left {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 1;
        }
        
        .stat-bar-right {
            position: relative;
            z-index: 1;
        }
        
        .stat-bar-icon {
            font-size: 18px;
        }
        
        .money-progress {
            display: none;
        }
        
        .stat-label {
            display: none;
        }
        
        .stat-icon {
            display: none;
        }
        
        .progress-bar {
            display: none;
        }
        
        .progress-fill {
            display: none;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –±–ª–µ—Å–∫–∞ –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–µ */
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShine 2s infinite;
        }
        
        @keyframes progressShine {
            0% { left: -100%; }
            50%, 100% { left: 100%; }
        }
        
        /* –ü—É–ª—å—Å–∞—Ü–∏—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π */
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }
        
        .progress-fill.critical {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        /* –ü–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ */
        .progress-fill {
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1), 
                        background 0.5s ease;
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç –≤–æ–ª–Ω—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ */
        @keyframes fillWave {
            0% { transform: scaleX(0); transform-origin: left; }
            100% { transform: scaleX(1); }
        }
        
        .progress-fill.updating {
            animation: fillWave 0.6s ease-out;
        }
        
        /* –ú–∏–∫—Ä–æ-–∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö */
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.5);
            }
        }
        
        @keyframes coinSpin {
            0% {
                transform: translateY(0) rotateY(0deg);
            }
            50% {
                transform: translateY(-50px) rotateY(180deg);
            }
            100% {
                transform: translateY(-100px) rotateY(360deg);
                opacity: 0;
            }
        }
        
        .floating-emoji {
            position: fixed;
            font-size: 30px;
            pointer-events: none;
            z-index: 9999;
            animation: floatUp 1.5s ease-out forwards;
        }
        
        .floating-coin {
            position: fixed;
            font-size: 25px;
            pointer-events: none;
            z-index: 9999;
            animation: coinSpin 1.2s ease-out forwards;
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç —Ç—Ä—è—Å–∫–∏ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç —É—Å–ø–µ—Ö–∞ */
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(39, 174, 96, 0.6); }
            100% { transform: scale(1); }
        }
        
        .success-pulse {
            animation: successPulse 0.6s ease-out;
        }
        
        .top-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 5px;
        }
        
        .top-btn {
            padding: 12px 8px;
            font-size: 13px;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .top-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: buttonShine 3s infinite;
        }
        
        @keyframes buttonShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .top-btn:active {
            transform: scale(0.98);
        }
        
        .top-btn.work {
            background: linear-gradient(135deg, #8b4513 0%, #654321 100%);
        }
        
        .top-btn.shop {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        
        .top-btn.goals {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        
        .top-btn i, .action-btn i {
            width: 28px;
            height: 28px;
            background: rgba(255,255,255,0.25);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .action-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .action-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.15), transparent);
            transform: rotate(45deg);
            animation: buttonShine 3s infinite;
        }
        
        .action-btn::after {
            content: '‚ú®';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            opacity: 0.6;
            animation: sparkle 2s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0.3; transform: translateY(-50%) scale(0.8); }
            50% { opacity: 0.8; transform: translateY(-50%) scale(1.2); }
        }
        
        .action-btn:active {
            transform: scale(0.98);
        }
        
        .action-btn.work {
            background: linear-gradient(135deg, #8b4513 0%, #654321 100%);
        }
        
        .action-btn.sidejob {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        
        .action-btn.entertainment {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        
        .action-btn.do-work {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }
        
        .action-btn.end-day {
            background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .action-btn:disabled::after {
            display: none;
        }
        
        .nav-buttons {
            display: none;
        }
        
        .nav-btn {
            display: none;
        }
        
        .nav-btn-icon { 
            display: none;
        }
        
        .job-info-card {
            background: rgba(139, 69, 19, 0.1);
            border-radius: 12px;
            padding: 10px;
            border: 2px solid rgba(139, 69, 19, 0.2);
        }
        
        .job-info {
            display: none;
        }
        
        .work-button, .next-day-btn {
            display: none;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
            border-radius: 20px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 4px solid #34495e;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            padding: 20px;
            border-radius: 16px 16px 0 0;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            font-size: 24px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .modal-body { padding: 20px; }
        
        .item-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border: 3px solid #8b7355;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
        }
        
        .item-card.locked { opacity: 0.5; cursor: not-allowed; }
        .item-card.owned {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
        }
        
        .item-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .item-icon { font-size: 32px; }
        .item-name { flex: 1; font-weight: bold; font-size: 16px; }
        .item-price { font-size: 16px; font-weight: bold; color: #27ae60; }
        .item-desc { font-size: 13px; color: #666; }
        
        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 2000;
            display: none;
            font-weight: bold;
        }
        
        .message.success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }
        
        .shop-tabs {
            display: flex;
            gap: 5px;
            padding: 15px;
            background: rgba(0,0,0,0.1);
        }
        
        .shop-tab {
            flex: 1;
            padding: 12px 10px;
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            border: 2px solid #5a6268;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .shop-tab.active {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            border-color: #21618c;
            transform: scale(1.05);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .container {
                gap: 10px;
            }
            
            .main-area {
                flex-direction: column;
                gap: 0;
            }
            
            .character-area {
                display: none;
            }
            
            .right-panel {
                width: 100%;
                max-width: 100%;
                min-width: 100%;
                border-radius: 20px;
                padding: 15px;
            }
            
            .top-bar {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .modal {
                padding: 10px;
            }
            
            .modal-content {
                max-height: 85vh;
            }
            
            .modal-header {
                padding: 12px 15px;
                font-size: 16px;
            }
            
            .modal-body {
                padding: 12px;
            }
            
            .item-card {
                padding: 10px;
                margin: 6px 0;
                border: 2px solid #8b7355;
            }
            
            .item-icon {
                font-size: 24px;
            }
            
            .item-name {
                font-size: 14px;
            }
            
            .item-price {
                font-size: 14px;
            }
            
            .item-desc {
                font-size: 11px;
            }
            
            .close-btn {
                width: 30px;
                height: 30px;
                font-size: 20px;
            }
            
            .shop-tabs {
                padding: 10px;
                gap: 4px;
            }
            
            .shop-tab {
                padding: 8px 6px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-area">
            <div class="character-area">
                <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂ –≤–∏–¥–µ–Ω –Ω–∞ —Ñ–æ–Ω–µ -->
            </div>
            
            <div class="right-panel">
                <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å –í–ù–£–¢–†–ò –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏ -->
                <div class="top-bar">
                    <div class="top-bar-left">
                        <span>–ú–µ—Å—è—Ü <span id="month">1</span> | –î–µ–Ω—å <span id="day">1</span> / 30</span>
                    </div>
                    <div class="top-bar-right">
                        <span>üí∞ <span id="topMoney">500</span>‚ÇΩ</span>
                        <button class="close-btn" style="border: none; background: rgba(255,255,255,0.2); width: 35px; height: 35px; border-radius: 10px; color: white; font-size: 18px; cursor: pointer;" onclick="showLeaderboard()"><i class="fas fa-trophy"></i></button>
                        <button class="close-btn" style="border: none; background: rgba(255,255,255,0.2); width: 35px; height: 35px; border-radius: 10px; color: white; font-size: 18px; cursor: pointer;" onclick="showStats()"><i class="fas fa-chart-bar"></i></button>
                    </div>
                </div>
                
                <!-- –î–µ–Ω—å–≥–∏ -->
                <div class="stat-bar" style="--progress: 100%;">
                    <div class="stat-bar-left">
                        <span class="stat-bar-icon">üí∞</span>
                        <span id="money">500</span> ‚ÇΩ
                    </div>
                    <div class="stat-bar-right">
                        <span id="energyDisplay">100/100</span> ‚ö°
                    </div>
                </div>
                
                <!-- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ -->
                <div class="stat-bar mood" id="moodBar" style="--progress: 50%;">
                    <div class="stat-bar-left">
                        <span class="stat-bar-icon" id="moodEmoji">üòä</span>
                        <span id="moodValue">50</span>
                    </div>
                    <div class="stat-bar-right" id="moodText">–ù–æ—Ä–º–∞–ª—å–Ω–æ</div>
                </div>
                
                <!-- –ó–¥–æ—Ä–æ–≤—å–µ -->
                <div class="stat-bar health" id="healthBar" style="--progress: 100%;">
                    <div class="stat-bar-left">
                        <span class="stat-bar-icon">‚ù§Ô∏è</span>
                        <span id="healthValue">100</span>
                    </div>
                    <div class="stat-bar-right" id="healthText">–ó–¥–æ—Ä–æ–≤</div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ 1x3 -->
                <div class="top-buttons">
                    <button class="top-btn work" onclick="showJobs()">
                        <i class="fas fa-briefcase"></i> –†–∞–±–æ—Ç–∞
                    </button>
                    <button class="top-btn shop" onclick="showShop()">
                        <i class="fas fa-shopping-cart"></i> –ú–∞–≥–∞–∑–∏–Ω
                    </button>
                    <button class="top-btn" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);" onclick="showEntertainment()">
                        <i class="fas fa-gamepad"></i> –ò–≥—Ä—ã
                    </button>
                </div>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ -->
                <div class="job-info-card">
                    <div style="font-weight: bold; margin-bottom: 5px; font-size: 14px;">–¢–≤–æ—è —Ä–∞–±–æ—Ç–∞: <span id="currentJobName">–ö—É—Ä—å–µ—Ä</span></div>
                    <div style="font-size: 13px; color: #666;">
                        üí∞ –ó–∞—Ä–ø–ª–∞—Ç–∞: +<span id="jobIncome">80</span>‚ÇΩ | ‚ö° –≠–Ω–µ—Ä–≥–∏—è: -<span id="jobEnergy">5</span>
                    </div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="action-buttons">
                    <button class="action-btn sidejob" onclick="showSideJobs()">
                        <i class="fas fa-clock"></i> –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∏
                    </button>
                    
                    <button class="action-btn" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);" onclick="showBusiness()">
                        <i class="fas fa-store"></i> –ë–∏–∑–Ω–µ—Å
                    </button>
                    
                    <button class="action-btn" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);" onclick="showSkills()">
                        <i class="fas fa-star"></i> –ù–∞–≤—ã–∫–∏
                    </button>
                    
                    <button class="action-btn do-work" id="workBtn" onclick="work()">
                        <i class="fas fa-briefcase"></i> –ü–æ—Ä–∞–±–æ—Ç–∞—Ç—å
                    </button>
                    
                    <button class="action-btn end-day" id="nextDayBtn" onclick="confirmEndDay()">
                        <i class="fas fa-moon"></i> –ó–∞–∫–æ–Ω—á–∏—Ç—å –¥–µ–Ω—å –∏ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="jobsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-briefcase"></i> –í—ã–±–µ—Ä–∏ —Ä–∞–±–æ—Ç—É</div>
                <button class="close-btn" onclick="document.getElementById('jobsModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body" id="jobsList"></div>
        </div>
    </div>
    
    <div class="modal" id="shopModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-shopping-cart"></i> –ú–∞–≥–∞–∑–∏–Ω</div>
                <button class="close-btn" onclick="document.getElementById('shopModal').style.display='none'">√ó</button>
            </div>
            <div class="shop-tabs">
                <button class="shop-tab active" onclick="showShopTab('boosters')"><i class="fas fa-coffee"></i> –ë—É—Å—Ç–µ—Ä—ã</button>
                <button class="shop-tab" onclick="showShopTab('cars')"><i class="fas fa-car"></i> –ú–∞—à–∏–Ω—ã</button>
                <button class="shop-tab" onclick="showShopTab('realestate')"><i class="fas fa-home"></i> –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</button>
            </div>
            <div class="modal-body" id="shopList"></div>
        </div>
    </div>
    
    <div class="modal" id="goalsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-trophy"></i> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                <button class="close-btn" onclick="document.getElementById('goalsModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body" id="goalsList"></div>
        </div>
    </div>
    
    <div class="modal" id="businessModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-store"></i> –ú–æ–π –±–∏–∑–Ω–µ—Å</div>
                <button class="close-btn" onclick="document.getElementById('businessModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body" id="businessList">
                <div style="text-align: center; padding: 20px;">
                    <p style="margin-bottom: 15px;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="sideJobsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-briefcase-medical"></i> –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∏</div>
                <button class="close-btn" onclick="document.getElementById('sideJobsModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body" id="sideJobsList">
                <div style="text-align: center; padding: 20px;">
                    <p style="margin-bottom: 15px;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="traitModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;">–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —á–µ—Ä—Ç—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞</div>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: #555;">–ß–µ—Ä—Ç–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Å—å –≥–µ–π–º–ø–ª–µ–π. –í—ã–±–µ—Ä–∏ –º—É–¥—Ä–æ!</p>
                <div id="traitsList"></div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                <button class="close-btn" onclick="document.getElementById('statsModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body">
                <div style="background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%); border: 3px solid #8b7355; border-radius: 12px; padding: 15px; margin: 10px 0;">
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">üí∞ –§–∏–Ω–∞–Ω—Å—ã</div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–¢–µ–∫—É—â–∏–µ –¥–µ–Ω—å–≥–∏: <span id="statMoney">0</span>‚ÇΩ</div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="statTotalEarned">0</span>‚ÇΩ</div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ: <span id="statTotalSpent">0</span>‚ÇΩ</div>
                </div>
                
                <div style="background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%); border: 3px solid #8b7355; border-radius: 12px; padding: 15px; margin: 10px 0;">
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–î–Ω–µ–π –ø—Ä–æ–∂–∏—Ç–æ: <span id="statDays">0</span></div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–†–∞–∑ —Ä–∞–±–æ—Ç–∞–ª: <span id="statWorkCount">0</span></div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–¶–µ–ª–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: <span id="statGoals">0</span></div>
                </div>
                
                <div style="background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%); border: 3px solid #8b7355; border-radius: 12px; padding: 15px; margin: 10px 0;">
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">üè† –ò–º—É—â–µ—Å—Ç–≤–æ</div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–ú–∞—à–∏–Ω: <span id="statCars">0</span></div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏: <span id="statProperty">0</span></div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–ö—Ä–µ–¥–∏—Ç–æ–≤: <span id="statCredits">0</span></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="rouletteModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-dice-five"></i> –†—É–ª–µ—Ç–∫–∞</div>
                <button class="close-btn" onclick="document.getElementById('rouletteModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <!-- –ë–∞—Ä–∞–±–∞–Ω —Ä—É–ª–µ—Ç–∫–∏ -->
                <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); border-radius: 20px; padding: 30px 20px; margin: 20px 0; border: 4px solid #f39c12; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 20px;">
                        <!-- –ë–∞—Ä–∞–±–∞–Ω 1 -->
                        <div style="background: white; border-radius: 15px; padding: 20px 15px; min-width: 80px; border: 3px solid #34495e; box-shadow: inset 0 4px 8px rgba(0,0,0,0.2);">
                            <div id="slot1" style="font-size: 50px; transition: all 0.1s;">üé∞</div>
                        </div>
                        <!-- –ë–∞—Ä–∞–±–∞–Ω 2 -->
                        <div style="background: white; border-radius: 15px; padding: 20px 15px; min-width: 80px; border: 3px solid #34495e; box-shadow: inset 0 4px 8px rgba(0,0,0,0.2);">
                            <div id="slot2" style="font-size: 50px; transition: all 0.1s;">üé∞</div>
                        </div>
                        <!-- –ë–∞—Ä–∞–±–∞–Ω 3 -->
                        <div style="background: white; border-radius: 15px; padding: 20px 15px; min-width: 80px; border: 3px solid #34495e; box-shadow: inset 0 4px 8px rgba(0,0,0,0.2);">
                            <div id="slot3" style="font-size: 50px; transition: all 0.1s;">üé∞</div>
                        </div>
                    </div>
                    <div id="rouletteMessage" style="font-size: 20px; font-weight: bold; color: #f39c12; min-height: 30px;"></div>
                </div>
                
                <div style="font-size: 18px; margin: 15px 0; color: #555;">–í—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É:</div>
                <div style="display: flex; gap: 10px; justify-content: center; margin: 20px 0;">
                    <button class="nav-btn" style="padding: 15px 20px; background: linear-gradient(135deg, #27ae60 0%, #229954 100%); border-color: #1e8449;" onclick="playRoulette(100)">üí∞ 100‚ÇΩ</button>
                    <button class="nav-btn" style="padding: 15px 20px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border-color: #21618c;" onclick="playRoulette(500)">üíé 500‚ÇΩ</button>
                    <button class="nav-btn" style="padding: 15px 20px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); border-color: #a93226;" onclick="playRoulette(1000)">üëë 1000‚ÇΩ</button>
                </div>
                <div style="font-size: 14px; color: #888; margin-top: 10px;">
                    –®–∞–Ω—Å—ã: 60% üò≠ | 25% üôÇ | 10% üòÑ | 5% ü§ë
                </div>
            </div>
        </div>
    </div>
    
    <!-- Entertainment Menu Modal -->
    <div class="modal" id="entertainmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-dice"></i> –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</div>
                <button class="close-btn" onclick="document.getElementById('entertainmentModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 15px; color: #555;">
                    –í—ã–±–µ—Ä–∏ –∏–≥—Ä—É:
                </div>
                
                <!-- –†—É–ª–µ—Ç–∫–∞ -->
                <div class="item-card" onclick="showRoulette()" style="cursor: pointer;">
                    <div class="item-header">
                        <div class="item-icon">üé∞</div>
                        <div class="item-name">–†—É–ª–µ—Ç–∫–∞</div>
                    </div>
                    <div class="item-desc">3 –±–∞—Ä–∞–±–∞–Ω–∞, —Å—Ç–∞–≤–∫–∏ 100-1000‚ÇΩ</div>
                    <div class="item-desc" style="color: #27ae60;">–®–∞–Ω—Å—ã: x2 (25%), x5 (10%), x10 (5%)</div>
                </div>
                
                <!-- –ö–æ—Å—Ç–∏ -->
                <div class="item-card" onclick="showDice()" style="cursor: pointer;">
                    <div class="item-header">
                        <div class="item-icon">üé≤</div>
                        <div class="item-name">–ö–æ—Å—Ç–∏</div>
                    </div>
                    <div class="item-desc">2 –∫—É–±–∏–∫–∞, —Å—Ç–∞–≤–∫–∏ 100-1000‚ÇΩ</div>
                    <div class="item-desc" style="color: #27ae60;">–ù–∏–∑–∫–∏–µ x2.5, –°–µ–º–µ—Ä–∫–∞ x6, –í—ã—Å–æ–∫–∏–µ x2.5</div>
                </div>
                
                <!-- –ö—Ä–∞—à -->
                <div class="item-card" onclick="showCrash()" style="cursor: pointer;">
                    <div class="item-header">
                        <div class="item-icon">üìà</div>
                        <div class="item-name">–ö—Ä–∞—à</div>
                    </div>
                    <div class="item-desc">–†–∞—Å—Ç—É—â–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å, —Å—Ç–∞–≤–∫–∏ 100-5000‚ÇΩ</div>
                    <div class="item-desc" style="color: #27ae60;">–ó–∞–±–µ—Ä–∏ –¥–æ –∫—Ä–∞—à–∞ –∏ –≤—ã–∏–≥—Ä–∞–π!</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Dice Game Modal -->
    <div class="modal" id="diceModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-dice"></i> –ö–æ—Å—Ç–∏</div>
                <button class="close-btn" onclick="document.getElementById('diceModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <!-- –ö–æ—Å—Ç–∏ -->
                <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); border-radius: 20px; padding: 30px 20px; margin: 20px 0; border: 4px solid #27ae60; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px;">
                        <div id="dice1" style="font-size: 80px; transition: all 0.1s;">üé≤</div>
                        <div id="dice2" style="font-size: 80px; transition: all 0.1s;">üé≤</div>
                    </div>
                    <div id="diceSum" style="font-size: 24px; font-weight: bold; color: #f39c12; margin-bottom: 10px;">–°—É–º–º–∞: -</div>
                    <div id="diceMessage" style="font-size: 18px; font-weight: bold; color: #f39c12; min-height: 25px;"></div>
                </div>
                
                <div style="font-size: 16px; margin: 15px 0; color: #555;">
                    <div style="margin-bottom: 10px;">–°—Ç–∞–≤–∫–∞: <input type="number" id="diceBet" min="100" max="1000" value="100" style="width: 100px; padding: 5px; border: 2px solid #8b7355; border-radius: 5px; text-align: center; font-size: 16px;">‚ÇΩ</div>
                </div>
                
                <div style="font-size: 16px; margin: 15px 0; color: #555;">–í—ã–±–µ—Ä–∏ –¥–∏–∞–ø–∞–∑–æ–Ω:</div>
                <div style="display: flex; gap: 10px; justify-content: center; margin: 20px 0; flex-wrap: wrap;">
                    <button class="nav-btn" style="padding: 12px 15px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border-color: #21618c; flex: 1; min-width: 100px;" onclick="playDice('low')">
                        <div style="font-size: 14px;">–ù–∏–∑–∫–∏–µ</div>
                        <div style="font-size: 12px; margin-top: 3px;">2-6 (x2.5)</div>
                    </button>
                    <button class="nav-btn" style="padding: 12px 15px; background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); border-color: #ca6f1e; flex: 1; min-width: 100px;" onclick="playDice('seven')">
                        <div style="font-size: 14px;">–°–µ–º–µ—Ä–∫–∞</div>
                        <div style="font-size: 12px; margin-top: 3px;">7 (x6)</div>
                    </button>
                    <button class="nav-btn" style="padding: 12px 15px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); border-color: #a93226; flex: 1; min-width: 100px;" onclick="playDice('high')">
                        <div style="font-size: 14px;">–í—ã—Å–æ–∫–∏–µ</div>
                        <div style="font-size: 12px; margin-top: 3px;">8-12 (x2.5)</div>
                    </button>
                </div>
                <div style="font-size: 13px; color: #888; margin-top: 10px;">
                    üí° –£–¥–∞—á–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∞–Ω—Å –≤—ã–∏–≥—Ä—ã—à–∞!
                </div>
            </div>
        </div>
    </div>
    
    <!-- Crash Game Modal -->
    <div class="modal" id="crashModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-chart-line"></i> –ö—Ä–∞—à</div>
                <button class="close-btn" onclick="document.getElementById('crashModal').style.display='none'; stopCrashGame()">√ó</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <!-- –ú–Ω–æ–∂–∏—Ç–µ–ª—å -->
                <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); border-radius: 20px; padding: 40px 20px; margin: 20px 0; border: 4px solid #e74c3c; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <div id="crashMultiplier" style="font-size: 60px; font-weight: bold; color: #27ae60; margin-bottom: 15px;">x1.00</div>
                    <div id="crashMessage" style="font-size: 18px; font-weight: bold; color: #f39c12; min-height: 25px;">üìà –£—Å—Ç–∞–Ω–æ–≤–∏ —Å—Ç–∞–≤–∫—É</div>
                </div>
                
                <div id="crashBetInput" style="font-size: 16px; margin: 15px 0; color: #555;">
                    <div style="margin-bottom: 10px;">–°—Ç–∞–≤–∫–∞: <input type="number" id="crashBet" min="100" max="5000" value="100" style="width: 120px; padding: 5px; border: 2px solid #8b7355; border-radius: 5px; text-align: center; font-size: 16px;">‚ÇΩ</div>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: center; margin: 20px 0;">
                    <button class="nav-btn" id="crashPlayBtn" style="padding: 15px 25px; background: linear-gradient(135deg, #27ae60 0%, #229954 100%); border-color: #1e8449; font-size: 16px;" onclick="startCrashGame()">
                        üöÄ –ò–≥—Ä–∞—Ç—å
                    </button>
                    <button class="nav-btn" id="crashCashOutBtn" style="padding: 15px 25px; background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); border-color: #ca6f1e; font-size: 16px; display: none;" onclick="cashOutCrash()">
                        üí∞ –ó–∞–±—Ä–∞—Ç—å
                    </button>
                </div>
                <div style="font-size: 13px; color: #888; margin-top: 10px;">
                    üí° –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ä–∞—Å—Ç–µ—Ç –æ—Ç x1.0 –¥–æ –∫—Ä–∞—à–∞<br>
                    –ù–∞–∂–º–∏ "–ó–∞–±—Ä–∞—Ç—å" –¥–æ –∫—Ä–∞—à–∞ –∏ –≤—ã–∏–≥—Ä–∞–π!
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="skillsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-star"></i> –ù–∞–≤—ã–∫–∏</div>
                <button class="close-btn" onclick="document.getElementById('skillsModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 24px; font-weight: bold; color: #f39c12;">
                        –û—á–∫–æ–≤ –Ω–∞–≤—ã–∫–æ–≤: <span id="skillPoints">0</span> <i class="fas fa-star"></i>
                    </div>
                    <div style="font-size: 14px; color: #888; margin-top: 5px;">
                        –ü–æ–ª—É—á–∞–π –æ—á–∫–∏ –∑–∞ —Ä–∞–±–æ—Ç—É!
                    </div>
                </div>
                
                <div class="item-card" onclick="upgradeSkill('speed')">
                    <div class="item-header">
                        <div class="item-icon"><i class="fas fa-running"></i></div>
                        <div class="item-name">–°–∫–æ—Ä–æ—Å—Ç—å</div>
                        <div class="item-price">–£—Ä–æ–≤–µ–Ω—å <span id="speedLevel">1</span></div>
                    </div>
                    <div class="item-desc">–ú–µ–Ω—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ —Ä–∞–±–æ—Ç—É (-5% –∑–∞ —É—Ä–æ–≤–µ–Ω—å)</div>
                    <div class="item-desc">–°—Ç–æ–∏–º–æ—Å—Ç—å: 1 –æ—á–∫–æ</div>
                </div>
                
                <div class="item-card" onclick="upgradeSkill('luck')">
                    <div class="item-header">
                        <div class="item-icon"><i class="fas fa-clover"></i></div>
                        <div class="item-name">–£–¥–∞—á–∞</div>
                        <div class="item-price">–£—Ä–æ–≤–µ–Ω—å <span id="luckLevel">1</span></div>
                    </div>
                    <div class="item-desc">–ë–æ–ª—å—à–µ —à–∞–Ω—Å –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (+5% –∑–∞ —É—Ä–æ–≤–µ–Ω—å)</div>
                    <div class="item-desc">–°—Ç–æ–∏–º–æ—Å—Ç—å: 1 –æ—á–∫–æ</div>
                </div>
                
                <div class="item-card" onclick="upgradeSkill('charisma')">
                    <div class="item-header">
                        <div class="item-icon"><i class="fas fa-comments"></i></div>
                        <div class="item-name">–•–∞—Ä–∏–∑–º–∞</div>
                        <div class="item-price">–£—Ä–æ–≤–µ–Ω—å <span id="charismaLevel">1</span></div>
                    </div>
                    <div class="item-desc">–ë–æ–ª—å—à–µ –¥–æ—Ö–æ–¥ –æ—Ç —Ä–∞–±–æ—Ç—ã (+5% –∑–∞ —É—Ä–æ–≤–µ–Ω—å)</div>
                    <div class="item-desc">–°—Ç–æ–∏–º–æ—Å—Ç—å: 1 –æ—á–∫–æ</div>
                </div>
                
                <div class="item-card" onclick="upgradeSkill('intelligence')">
                    <div class="item-header">
                        <div class="item-icon"><i class="fas fa-brain"></i></div>
                        <div class="item-name">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</div>
                        <div class="item-price">–£—Ä–æ–≤–µ–Ω—å <span id="intelligenceLevel">1</span></div>
                    </div>
                    <div class="item-desc">–ë—ã—Å—Ç—Ä–µ–µ –ø–æ–ª—É—á–∞–µ—à—å –æ—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ (+10% –∑–∞ —É—Ä–æ–≤–µ–Ω—å)</div>
                    <div class="item-desc">–°—Ç–æ–∏–º–æ—Å—Ç—å: 1 –æ—á–∫–æ</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–∞–π–¥ -->
    <div class="modal" id="welcomeModal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <h2 style="margin: 0; color: white;"><i class="fas fa-hand-wave"></i> –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            </div>
            <div class="modal-body" style="padding: 25px; line-height: 1.8; color: #2c3e50;">
                <!-- –ù–û–í–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï -->
                <div style="background: linear-gradient(135deg, #8e44ad 0%, #6c3483 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; color: white; text-align: center; border: 3px solid #5b2c6f; box-shadow: 0 4px 15px rgba(142, 68, 173, 0.3);">
                    <div style="font-size: 32px; margin-bottom: 10px;">üéâ üè™ üéâ</div>
                    <h3 style="margin: 0 0 10px 0; font-size: 22px;"><i class="fas fa-star"></i> –ù–û–í–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï!</h3>
                    <p style="font-size: 16px; margin: 10px 0; font-weight: bold;">–¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ë–ò–ó–ù–ï–°–ê!</p>
                    <ul style="text-align: left; margin: 15px 0; padding-left: 25px; font-size: 14px;">
                        <li style="margin-bottom: 8px;">üè™ –û—Ç–∫—Ä—ã–≤–∞–π —Å–≤–æ–π –±–∏–∑–Ω–µ—Å (–∫–∏–æ—Å–∫, –∫–∞—Ñ–µ, —Ä–µ—Å—Ç–æ—Ä–∞–Ω)</li>
                        <li style="margin-bottom: 8px;">üë• –ù–∞–Ω–∏–º–∞–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (–ø–æ–≤–∞—Ä, –∫–∞—Å—Å–∏—Ä, –º–µ–Ω–µ–¥–∂–µ—Ä)</li>
                        <li style="margin-bottom: 8px;">üì¶ –ü–æ–∫—É–ø–∞–π –∑–∞–ø–∞—Å—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è</li>
                        <li style="margin-bottom: 8px;">üí∞ –ü–æ–ª—É—á–∞–π –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å!</li>
                    </ul>
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; margin-top: 15px;">
                        <strong>–ù–∞–π–¥–∏ –∫–Ω–æ–ø–∫—É "–ë–∏–∑–Ω–µ—Å" üè™ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é!</strong>
                    </div>
                </div>
                
                <div style="text-align: center; margin-bottom: 20px;">
                    <p style="font-size: 18px; margin-bottom: 15px;">üëã –ü—Ä–∏–≤–µ—Ç! –†–∞–¥—ã –≤–∏–¥–µ—Ç—å —Ç–µ–±—è –≤ –∏–≥—Ä–µ <strong>"–í—ã–∂–∏–≤–∏ –¥–æ –∑–∞—Ä–ø–ª–∞—Ç—ã"</strong></p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="margin-top: 0; color: #667eea;"><i class="fas fa-gamepad"></i> –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</h3>
                    <ul style="margin: 10px 0; padding-left: 25px;">
                        <li style="margin-bottom: 10px;"><strong>üíº –†–∞–±–æ—Ç–∞–π</strong> ‚Äî –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –¥–µ–Ω—å–≥–∏, –Ω–æ —Å–ª–µ–¥–∏ –∑–∞ —ç–Ω–µ—Ä–≥–∏–µ–π</li>
                        <li style="margin-bottom: 10px;"><strong>üè™ –û—Ç–∫—Ä—ã–≤–∞–π –±–∏–∑–Ω–µ—Å</strong> ‚Äî –ø–æ–ª—É—á–∞–π –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥!</li>
                        <li style="margin-bottom: 10px;"><strong>üõí –ü–æ–∫—É–ø–∞–π</strong> ‚Äî –±—É—Å—Ç–µ—Ä—ã, –º–∞—à–∏–Ω—ã –∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –ø–æ–º–æ–≥—É—Ç —Ç–µ–±–µ</li>
                        <li style="margin-bottom: 10px;"><strong>üéØ –í—ã–ø–æ–ª–Ω—è–π —Ü–µ–ª–∏</strong> ‚Äî –ø–æ–ª—É—á–∞–π –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</li>
                        <li style="margin-bottom: 10px;"><strong>üìÖ –î–æ–∂–∏–≤–∏ –¥–æ –∑–∞—Ä–ø–ª–∞—Ç—ã</strong> ‚Äî 30 –¥–Ω–µ–π –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ–Ω–µ–≥</li>
                        <li style="margin-bottom: 10px;"><strong>üé≤ –†–∏—Å–∫—É–π</strong> ‚Äî —Ä—É–ª–µ—Ç–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–µ—Å—Ç–∏ —É–¥–∞—á—É</li>
                    </ul>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 12px; border-left: 4px solid #ffc107; margin-bottom: 20px;">
                    <p style="margin: 0;"><i class="fas fa-lightbulb"></i> <strong>–°–æ–≤–µ—Ç:</strong> –°–ª–µ–¥–∏ –∑–∞ –∑–¥–æ—Ä–æ–≤—å–µ–º –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º ‚Äî –æ–Ω–∏ –≤–ª–∏—è—é—Ç –Ω–∞ —Ç–≤–æ–π –¥–æ—Ö–æ–¥!</p>
                </div>
                
                <div style="text-align: center;">
                    <button onclick="showNameInput()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 40px; border-radius: 12px; font-size: 16px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                        <i class="fas fa-arrow-right"></i> –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –í–≤–æ–¥ –∏–º–µ–Ω–∏ -->
    <div class="modal" id="nameModal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <h2 style="margin: 0; color: white;"><i class="fas fa-user-edit"></i> –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?</h2>
            </div>
            <div class="modal-body" style="padding: 30px; text-align: center;">
                <p style="font-size: 16px; color: #555; margin-bottom: 20px;">–ü—Ä–∏–¥—É–º–∞–π –∏–º—è –¥–ª—è —Å–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</p>
                <input type="text" id="playerNameInput" placeholder="–í–≤–µ–¥–∏ –∏–º—è (2-20 —Å–∏–º–≤–æ–ª–æ–≤)" maxlength="20" style="width: 100%; padding: 15px; border: 2px solid #667eea; border-radius: 12px; font-size: 16px; text-align: center; margin-bottom: 20px; box-sizing: border-box;">
                <button onclick="setPlayerName()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 40px; border-radius: 12px; font-size: 16px; cursor: pointer; font-weight: bold; width: 100%; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                    <i class="fas fa-check"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ -->
    <div class="modal" id="leaderboardModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2><i class="fas fa-trophy"></i> –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h2>
                <button class="close-btn" onclick="closeLeaderboard()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div id="leaderboardContent" style="max-height: 500px; overflow-y: auto;">
                    <p style="text-align: center; color: #999;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="message" id="message"></div>
    
    <script>
        // –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º userId
        let userId = localStorage.getItem('userId');
        
        // –ï—Å–ª–∏ userId –Ω–µ—Ç –≤ localStorage, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ Telegram –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
        if (!userId) {
            try {
                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    tg.ready();
                    tg.expand();
                    
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
                    const user = tg.initDataUnsafe?.user;
                    if (user && user.id) {
                        userId = 'tg_' + user.id.toString();
                        console.log('‚úÖ Telegram User ID:', userId);
                        console.log('‚úÖ User data:', user);
                    } else {
                        console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å Telegram ID');
                        console.warn('‚ö†Ô∏è initDataUnsafe:', tg.initDataUnsafe);
                        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ (–û–î–ò–ù –†–ê–ó!)
                        userId = 'web_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    }
                } else {
                    console.warn('‚ö†Ô∏è Telegram WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ (–û–î–ò–ù –†–ê–ó!)
                    userId = 'web_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è Telegram ID:', error);
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ (–û–î–ò–ù –†–ê–ó!)
                userId = 'web_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            // –°–û–•–†–ê–ù–Ø–ï–ú userId –≤ localStorage!
            localStorage.setItem('userId', userId);
            console.log('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–æ–≤—ã–π userId:', userId);
        } else {
            console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω userId –∏–∑ localStorage:', userId);
        }
        
        let gameData = {};
        
        console.log('üéÆ –ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);
        
        async function loadUserData() {
            try {
                const response = await fetch('/api/user/' + userId);
                if (response.ok) {
                    gameData = await response.json();
                    updateUI();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                    if (!gameData.tutorial_completed) {
                        setTimeout(() => {
                            document.getElementById('welcomeModal').style.display = 'flex';
                        }, 300);
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–±—Ä–∞–Ω–∞ –ª–∏ —á–µ—Ä—Ç–∞ (—Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ DOM)
                    if (!gameData.trait_selected) {
                        setTimeout(function() {
                            showTraitSelection();
                        }, 100);
                    }
                }
            } catch (error) {
                console.error('Load error:', error);
            }
        }
        
        function showTraitSelection() {
            const traits = {
                '—Ç–µ—Ä–ø–∏–ª–∞': {
                    name: '–¢–µ—Ä–ø–∏–ª–∞',
                    emoji: 'üò§',
                    desc: '–í—Å–µ —à—Ç—Ä–∞—Ñ—ã ‚àí20%, –Ω–æ –¥–æ—Ö–æ–¥ –æ—Ç —Ä–∞–±–æ—Ç—ã ‚àí15%',
                    color: '#e74c3c'
                },
                '—Ä–∏—Å–∫–æ–≤—ã–π': {
                    name: '–†–∏—Å–∫–æ–≤—ã–π',
                    emoji: 'üé≤',
                    desc: '–®–∞–Ω—Å —Å–æ–±—ã—Ç–∏–π +30%, –Ω–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —á–∞—â–µ',
                    color: '#f39c12'
                },
                '—ç–∫–æ–Ω–æ–º–Ω—ã–π': {
                    name: '–≠–∫–æ–Ω–æ–º–Ω—ã–π',
                    emoji: 'üí∞',
                    desc: '–í—Å–µ –ø–æ–∫—É–ø–∫–∏ –¥–µ—à–µ–≤–ª–µ –Ω–∞ 10%, –Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≥—Ä—É—Å—Ç–Ω—ã–π',
                    color: '#27ae60'
                },
                '–ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä': {
                    name: '–ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä',
                    emoji: 'üò¥',
                    desc: '–ò–Ω–æ–≥–¥–∞ –¥–µ–Ω—å –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –¥–µ–π—Å—Ç–≤–∏–π, –Ω–æ —É—Å—Ç–∞–ª–æ—Å—Ç—å –Ω–µ —Ä–∞—Å—Ç—ë—Ç',
                    color: '#9b59b6'
                }
            };
            
            const traitsList = document.getElementById('traitsList');
            traitsList.innerHTML = '';
            
            for (const traitId in traits) {
                const trait = traits[traitId];
                const card = document.createElement('div');
                card.className = 'item-card';
                card.style.borderColor = trait.color;
                card.onclick = function() { selectTrait(traitId); };
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + trait.emoji + '</div>' +
                    '<div class="item-name">' + trait.name + '</div>' +
                    '</div>' +
                    '<div class="item-desc">' + trait.desc + '</div>';
                
                traitsList.appendChild(card);
            }
            
            document.getElementById('traitModal').style.display = 'flex';
        }
        
        async function selectTrait(traitId) {
            try {
                const response = await fetch('/api/select_trait', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, trait_id: traitId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    document.getElementById('traitModal').style.display = 'none';
                    showMessage('–ß–µ—Ä—Ç–∞ –≤—ã–±—Ä–∞–Ω–∞: ' + result.trait.name + ' ' + result.trait.emoji, true);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        async function buyFood() {
            try {
                const response = await fetch('/api/buy_food', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showMessage(result.message, true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        async function takeRest() {
            try {
                const response = await fetch('/api/take_rest', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showMessage(result.message, true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        async function randomEvent() {
            try {
                const response = await fetch('/api/random_event', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showMessage(result.message, result.event.cost >= 0);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        function showStats() {
            document.getElementById('statMoney').textContent = (gameData.money || 0).toLocaleString();
            document.getElementById('statTotalEarned').textContent = (gameData.total_earned || 0).toLocaleString();
            document.getElementById('statTotalSpent').textContent = (gameData.total_spent || 0).toLocaleString();
            document.getElementById('statDays').textContent = (gameData.day || 1) - 1;
            document.getElementById('statWorkCount').textContent = gameData.work_count || 0;
            document.getElementById('statGoals').textContent = (gameData.completed_goals || []).length;
            document.getElementById('statCars').textContent = (gameData.cars || []).length;
            document.getElementById('statProperty').textContent = (gameData.real_estate || []).length;
            document.getElementById('statCredits').textContent = (gameData.credits || []).length;
            
            document.getElementById('statsModal').style.display = 'flex';
        }
        
        // ============================================
        // ENTERTAINMENT SYSTEM
        // ============================================
        
        function showEntertainment() {
            document.getElementById('entertainmentModal').style.display = 'flex';
        }
        
        function showRoulette() {
            document.getElementById('entertainmentModal').style.display = 'none';
            document.getElementById('rouletteMessage').textContent = 'üé∞ –í—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É';
            document.getElementById('slot1').textContent = 'üé∞';
            document.getElementById('slot2').textContent = 'üé∞';
            document.getElementById('slot3').textContent = 'üé∞';
            document.getElementById('rouletteModal').style.display = 'flex';
        }
        
        async function playRoulette(bet, retryCount = 0) {
            try {
                // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –±–∞—Ä–∞–±–∞–Ω–æ–≤
                const slot1 = document.getElementById('slot1');
                const slot2 = document.getElementById('slot2');
                const slot3 = document.getElementById('slot3');
                const messageEl = document.getElementById('rouletteMessage');
                
                const emojis = ['üçí', 'üçã', 'üçä', 'üçâ', '‚≠ê', 'üíé', '7Ô∏è‚É£'];
                let count = 0;
                
                messageEl.textContent = 'üé∞ –ö—Ä—É—Ç–∏–º...';
                messageEl.style.color = '#f39c12';
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –±–∞—Ä–∞–±–∞–Ω–æ–≤
                const interval = setInterval(function() {
                    slot1.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    slot2.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    slot3.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    count++;
                    if (count > 15) clearInterval(interval);
                }, 80);
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π API endpoint
                const response = await fetch('/api/entertainment/roulette', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, bet: bet })
                });
                
                setTimeout(async function() {
                    if (response.ok) {
                        const result = await response.json();
                        gameData = result.user;
                        updateUI();
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        const reels = result.result.reels;
                        slot1.textContent = reels[0];
                        slot2.textContent = reels[1];
                        slot3.textContent = reels[2];
                        
                        messageEl.textContent = result.message;
                        messageEl.style.color = result.result.won ? '#27ae60' : '#e74c3c';
                        
                        showMessage(result.message, result.result.won);
                    } else {
                        const error = await response.json();
                        messageEl.textContent = error.error || '–û—à–∏–±–∫–∞!';
                        messageEl.style.color = '#e74c3c';
                        showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                    }
                }, 1400);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä—É–ª–µ—Ç–∫–∏:', error);
                
                // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
                if (retryCount < 2) {
                    document.getElementById('rouletteMessage').textContent = `üîÑ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ... ${retryCount + 1}/2`;
                    document.getElementById('rouletteMessage').style.color = '#f39c12';
                    setTimeout(() => playRoulette(bet, retryCount + 1), 2000);
                } else {
                    document.getElementById('rouletteMessage').textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!';
                    document.getElementById('rouletteMessage').style.color = '#e74c3c';
                    showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è! –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)', false);
                }
            }
        }
        
        function showDice() {
            document.getElementById('entertainmentModal').style.display = 'none';
            document.getElementById('dice1').textContent = 'üé≤';
            document.getElementById('dice2').textContent = 'üé≤';
            document.getElementById('diceSum').textContent = '–°—É–º–º–∞: -';
            document.getElementById('diceMessage').textContent = 'üé≤ –í—ã–±–µ—Ä–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –∏ —Å—Ç–∞–≤–∫—É';
            document.getElementById('diceBet').value = 100;
            document.getElementById('diceModal').style.display = 'flex';
        }
        
        async function playDice(choice, retryCount = 0) {
            try {
                const bet = parseInt(document.getElementById('diceBet').value);
                
                if (bet < 100 || bet > 1000) {
                    showMessage('–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 100-1000‚ÇΩ', false);
                    return;
                }
                
                const dice1El = document.getElementById('dice1');
                const dice2El = document.getElementById('dice2');
                const sumEl = document.getElementById('diceSum');
                const messageEl = document.getElementById('diceMessage');
                
                const diceEmojis = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
                let count = 0;
                
                messageEl.textContent = 'üé≤ –ë—Ä–æ—Å–∞–µ–º –∫–æ—Å—Ç–∏...';
                messageEl.style.color = '#f39c12';
                sumEl.textContent = '–°—É–º–º–∞: ?';
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ—Å—Ç–µ–π
                const interval = setInterval(function() {
                    dice1El.textContent = diceEmojis[Math.floor(Math.random() * 6)];
                    dice2El.textContent = diceEmojis[Math.floor(Math.random() * 6)];
                    count++;
                    if (count > 12) clearInterval(interval);
                }, 100);
                
                const response = await fetch('/api/entertainment/dice', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, bet: bet, choice: choice })
                });
                
                setTimeout(async function() {
                    if (response.ok) {
                        const result = await response.json();
                        gameData = result.user;
                        updateUI();
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        dice1El.textContent = diceEmojis[result.result.dice1 - 1];
                        dice2El.textContent = diceEmojis[result.result.dice2 - 1];
                        sumEl.textContent = `–°—É–º–º–∞: ${result.result.sum}`;
                        sumEl.style.color = result.result.won ? '#27ae60' : '#e74c3c';
                        
                        messageEl.textContent = result.message;
                        messageEl.style.color = result.result.won ? '#27ae60' : '#e74c3c';
                        
                        showMessage(result.message, result.result.won);
                    } else {
                        const error = await response.json();
                        messageEl.textContent = error.error || '–û—à–∏–±–∫–∞!';
                        messageEl.style.color = '#e74c3c';
                        showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                    }
                }, 1300);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∫–æ—Å—Ç–µ–π:', error);
                
                if (retryCount < 2) {
                    document.getElementById('diceMessage').textContent = `üîÑ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ... ${retryCount + 1}/2`;
                    document.getElementById('diceMessage').style.color = '#f39c12';
                    setTimeout(() => playDice(choice, retryCount + 1), 2000);
                } else {
                    document.getElementById('diceMessage').textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!';
                    document.getElementById('diceMessage').style.color = '#e74c3c';
                    showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!', false);
                }
            }
        }
        
        function showCrash() {
            document.getElementById('entertainmentModal').style.display = 'none';
            document.getElementById('crashMultiplier').textContent = 'x1.00';
            document.getElementById('crashMultiplier').style.color = '#27ae60';
            document.getElementById('crashMessage').textContent = 'üìà –£—Å—Ç–∞–Ω–æ–≤–∏ —Å—Ç–∞–≤–∫—É';
            document.getElementById('crashBet').value = 100;
            document.getElementById('crashPlayBtn').disabled = false;
            document.getElementById('crashPlayBtn').style.display = 'block';
            document.getElementById('crashCashOutBtn').style.display = 'none';
            document.getElementById('crashBetInput').style.display = 'block';
            document.getElementById('crashModal').style.display = 'flex';
        }
        
        let crashInterval = null;
        let crashPoint = 0;
        let currentCrashMultiplier = 1.0;
        let crashBetAmount = 0;
        let crashStarted = false;
        
        function startCrashGame() {
            const bet = parseInt(document.getElementById('crashBet').value);
            
            if (bet < 100 || bet > 5000) {
                showMessage('–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 100-5000‚ÇΩ', false);
                return;
            }
            
            if (gameData.money < bet) {
                showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!', false);
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
            gameData.money -= bet;
            crashBetAmount = bet;
            updateUI();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ—á–∫—É –∫—Ä–∞—à–∞ (–Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏)
            crashPoint = generateCrashPoint();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ —Å—Ç–∞–≤–∫–∏ –∏ –∫–Ω–æ–ø–∫—É "–ò–≥—Ä–∞—Ç—å"
            document.getElementById('crashBetInput').style.display = 'none';
            document.getElementById('crashPlayBtn').style.display = 'none';
            document.getElementById('crashCashOutBtn').style.display = 'block';
            document.getElementById('crashCashOutBtn').disabled = false;
            
            const multiplierEl = document.getElementById('crashMultiplier');
            const messageEl = document.getElementById('crashMessage');
            
            currentCrashMultiplier = 1.0;
            crashStarted = true;
            messageEl.textContent = 'üìà –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ä–∞—Å—Ç–µ—Ç... –ù–∞–∂–º–∏ "–ó–∞–±—Ä–∞—Ç—å"!';
            messageEl.style.color = '#f39c12';
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Ä–æ—Å—Ç–∞ –º–Ω–æ–∂–∏—Ç–µ–ª—è
            crashInterval = setInterval(function() {
                if (!crashStarted) {
                    clearInterval(crashInterval);
                    return;
                }
                
                currentCrashMultiplier += 0.02 + (currentCrashMultiplier * 0.01); // –£—Å–∫–æ—Ä—è–µ—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
                multiplierEl.textContent = `x${currentCrashMultiplier.toFixed(2)}`;
                
                // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞
                if (currentCrashMultiplier >= 5) {
                    multiplierEl.style.color = '#f39c12';
                } else if (currentCrashMultiplier >= 3) {
                    multiplierEl.style.color = '#3498db';
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∞—à
                if (currentCrashMultiplier >= crashPoint) {
                    clearInterval(crashInterval);
                    crashGame(false);
                }
            }, 100);
        }
        
        function generateCrashPoint() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ—á–∫—É –∫—Ä–∞—à–∞ (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
            const random = Math.random();
            let point = 1.0 + (-Math.log(1 - random) * 0.5);
            
            // –£—á–∏—Ç—ã–≤–∞–µ–º —É–¥–∞—á—É
            const luckLevel = gameData.skills?.luck || 1;
            point *= (1 + (luckLevel - 1) * 0.1);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω
            point = Math.max(1.1, Math.min(10.0, point));
            
            return point;
        }
        
        function cashOutCrash() {
            if (!crashStarted) return;
            
            clearInterval(crashInterval);
            crashGame(true);
        }
        
        async function crashGame(cashedOut) {
            crashStarted = false;
            
            const multiplierEl = document.getElementById('crashMultiplier');
            const messageEl = document.getElementById('crashMessage');
            const cashOutBtn = document.getElementById('crashCashOutBtn');
            
            cashOutBtn.disabled = true;
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch('/api/entertainment/crash', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_id: userId, 
                        bet: crashBetAmount, 
                        cash_out_multiplier: cashedOut ? currentCrashMultiplier : null
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    
                    if (cashedOut) {
                        multiplierEl.style.color = '#27ae60';
                        messageEl.textContent = `‚úÖ –ó–∞–±—Ä–∞–ª –Ω–∞ x${currentCrashMultiplier.toFixed(2)}! +${result.result.payout}‚ÇΩ`;
                        messageEl.style.color = '#27ae60';
                        showMessage(result.message, true);
                    } else {
                        multiplierEl.textContent = `x${crashPoint.toFixed(2)}`;
                        multiplierEl.style.color = '#e74c3c';
                        messageEl.textContent = `‚ùå –ö—Ä–∞—à –Ω–∞ x${crashPoint.toFixed(2)}!`;
                        messageEl.style.color = '#e74c3c';
                        showMessage(`–ö—Ä–∞—à –Ω–∞ x${crashPoint.toFixed(2)}!`, false);
                    }
                } else {
                    const error = await response.json();
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ–Ω—å–≥–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    gameData.money += crashBetAmount;
                    updateUI();
                    messageEl.textContent = error.error || '–û—à–∏–±–∫–∞!';
                    messageEl.style.color = '#e74c3c';
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∫—Ä–∞—à–∞:', error);
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ–Ω—å–≥–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                gameData.money += crashBetAmount;
                updateUI();
                messageEl.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!';
                messageEl.style.color = '#e74c3c';
                showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!', false);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ò–≥—Ä–∞—Ç—å" —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                document.getElementById('crashBetInput').style.display = 'block';
                document.getElementById('crashPlayBtn').style.display = 'block';
                document.getElementById('crashPlayBtn').disabled = false;
                document.getElementById('crashCashOutBtn').style.display = 'none';
                multiplierEl.textContent = 'x1.00';
                multiplierEl.style.color = '#27ae60';
                messageEl.textContent = 'üìà –£—Å—Ç–∞–Ω–æ–≤–∏ —Å—Ç–∞–≤–∫—É';
                messageEl.style.color = '#f39c12';
            }, 2000);
        }
        
        function stopCrashGame() {
            if (crashInterval) {
                clearInterval(crashInterval);
                crashInterval = null;
            }
            crashStarted = false;
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ–Ω—å–≥–∏ –µ—Å–ª–∏ –∏–≥—Ä–∞ –±—ã–ª–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞
            if (crashBetAmount > 0) {
                gameData.money += crashBetAmount;
                crashBetAmount = 0;
                updateUI();
            }
        }
        
        // ============================================
        // END ENTERTAINMENT SYSTEM
        // ============================================
        
        
        function showSkills() {
            const skills = gameData.skills || { speed: 1, luck: 1, charisma: 1, intelligence: 1 };
            document.getElementById('skillPoints').textContent = gameData.skill_points || 0;
            document.getElementById('speedLevel').textContent = skills.speed || 1;
            document.getElementById('luckLevel').textContent = skills.luck || 1;
            document.getElementById('charismaLevel').textContent = skills.charisma || 1;
            document.getElementById('intelligenceLevel').textContent = skills.intelligence || 1;
            
            document.getElementById('skillsModal').style.display = 'flex';
        }
        
        async function upgradeSkill(skillName) {
            try {
                const response = await fetch('/api/upgrade_skill', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, skill: skillName })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showSkills();
                    showMessage(result.message, true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        function updateUI() {
            document.getElementById('day').textContent = gameData.day || 1;
            document.getElementById('month').textContent = gameData.month || 1;
            document.getElementById('money').textContent = gameData.money || 500;
            document.getElementById('topMoney').textContent = gameData.money || 500;
            
            const currentEnergy = gameData.energy || 100;
            const maxEnergy = gameData.max_energy || 100;
            document.getElementById('energyDisplay').textContent = currentEnergy + '/' + maxEnergy;
            
            document.getElementById('workBtn').disabled = currentEnergy <= 0;
            document.getElementById('nextDayBtn').disabled = false;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
            const mood = gameData.mood || 50;
            document.getElementById('moodValue').textContent = mood;
            document.getElementById('moodBar').style.setProperty('--progress', mood + '%');
            
            let moodEmoji = 'üòê';
            let moodText = '–ù–æ—Ä–º–∞–ª—å–Ω–æ';
            if (mood <= 20) {
                moodEmoji = 'üò≠';
                moodText = '–î–µ–ø—Ä–µ—Å—Å–∏—è';
            } else if (mood <= 40) {
                moodEmoji = 'üòî';
                moodText = '–ì—Ä—É—Å—Ç–Ω–æ';
            } else if (mood <= 60) {
                moodEmoji = 'üòê';
                moodText = '–ù–æ—Ä–º–∞–ª—å–Ω–æ';
            } else if (mood <= 80) {
                moodEmoji = 'üôÇ';
                moodText = '–•–æ—Ä–æ—à–æ';
            } else {
                moodEmoji = 'üòÑ';
                moodText = '–û—Ç–ª–∏—á–Ω–æ';
            }
            document.getElementById('moodEmoji').textContent = moodEmoji;
            document.getElementById('moodText').textContent = moodText;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
            const health = gameData.health || 100;
            document.getElementById('healthValue').textContent = health;
            document.getElementById('healthBar').style.setProperty('--progress', health + '%');
            
            let healthText = '–ó–¥–æ—Ä–æ–≤';
            if (health <= 20) {
                healthText = '–ö—Ä–∏—Ç–∏—á–Ω–æ';
            } else if (health <= 40) {
                healthText = '–ü–ª–æ—Ö–æ';
            } else if (health <= 60) {
                healthText = '–£—Å—Ç–∞–ª';
            } else if (health <= 80) {
                healthText = '–ù–æ—Ä–º–∞–ª—å–Ω–æ';
            }
            document.getElementById('healthText').textContent = healthText;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—Ç–µ
            const jobs = {
                'delivery': { name: '–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã', income: 80, energy: 5 },
                'office': { name: '–û—Ñ–∏—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞', income: 120, energy: 3 },
                'freelance': { name: '–§—Ä–∏–ª–∞–Ω—Å', income: 200, energy: 7 },
                'crypto': { name: '–ö—Ä–∏–ø—Ç–æ-—Ç—Ä–µ–π–¥–∏–Ω–≥', income: 300, energy: 10 }
            };
            
            const currentJobId = gameData.current_job || 'delivery';
            const currentJob = jobs[currentJobId];
            if (currentJob) {
                document.getElementById('currentJobName').textContent = currentJob.name;
                document.getElementById('jobIncome').textContent = currentJob.income;
                document.getElementById('jobEnergy').textContent = currentJob.energy;
            }
        }
        
        function showMessage(text, isSuccess) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message' + (isSuccess ? ' success' : '');
            msg.style.display = 'block';
            setTimeout(function() { msg.style.display = 'none'; }, 3000);
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–∏–∫—Ä–æ-–∞–Ω–∏–º–∞—Ü–∏–π
        function createFloatingEmoji(emoji, x, y) {
            const el = document.createElement('div');
            el.className = 'floating-emoji';
            el.textContent = emoji;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1500);
        }
        
        function createFloatingCoin(amount, x, y) {
            const el = document.createElement('div');
            el.className = 'floating-coin';
            el.textContent = 'üí∞ +' + amount + '‚ÇΩ';
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.style.color = '#27ae60';
            el.style.fontWeight = 'bold';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1200);
        }
        
        function createMultipleCoins(amount, centerX, centerY, count = 5) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const offsetX = (Math.random() - 0.5) * 100;
                    const offsetY = (Math.random() - 0.5) * 50;
                    createFloatingCoin(Math.floor(amount / count), centerX + offsetX, centerY + offsetY);
                }, i * 100);
            }
        }
        
        function triggerSuccessAnimation(elementId) {
            const el = document.getElementById(elementId);
            if (el) {
                el.classList.add('success-pulse');
                setTimeout(() => el.classList.remove('success-pulse'), 600);
            }
        }
        
        function triggerShakeAnimation(elementId) {
            const el = document.getElementById(elementId);
            if (el) {
                el.classList.add('shake');
                setTimeout(() => el.classList.remove('shake'), 500);
            }
        }
        
        async function work(retryCount = 0) {
            try {
                const response = await fetch('/api/work', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // –ê–Ω–∏–º–∞—Ü–∏—è –º–æ–Ω–µ—Ç–æ–∫
                    const workBtn = document.getElementById('workBtn');
                    const rect = workBtn.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    createMultipleCoins(result.income, centerX, centerY, 3);
                    
                    // –ê–Ω–∏–º–∞—Ü–∏—è —É—Å–ø–µ—Ö–∞ –Ω–∞ –∫–Ω–æ–ø–∫–µ
                    triggerSuccessAnimation('workBtn');
                    
                    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—Ç–µ—Ä–∏ —ç–Ω–µ—Ä–≥–∏–∏
                    createFloatingEmoji('‚ö°', centerX + 50, centerY);
                    triggerShakeAnimation('energyDisplay');
                    
                    gameData = result.user;
                    updateUI();
                    showMessage('+' + result.income + '‚ÇΩ', true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ:', error);
                
                // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
                if (retryCount < 2) {
                    showMessage(`üîÑ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ... ${retryCount + 1}/2`, false);
                    setTimeout(() => work(retryCount + 1), 2000);
                } else {
                    showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è! –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)', false);
                }
            }
        }
        
        async function nextDay(retryCount = 0) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            if (retryCount === 0) {
                showMessage('–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...', true);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–¥—ã—Ö–∞
                const nextDayBtn = document.getElementById('nextDayBtn');
                const rect = nextDayBtn.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                // –õ–µ—Ç—è—â–∏–µ —ç–º–æ–¥–∑–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                createFloatingEmoji('üò¥', centerX - 30, centerY);
                setTimeout(() => createFloatingEmoji('‚ö°', centerX, centerY), 200);
                setTimeout(() => createFloatingEmoji('‚ù§Ô∏è', centerX + 30, centerY), 400);
                
                triggerSuccessAnimation('nextDayBtn');
            }
            
            try {
                const response = await fetch('/api/next_day', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å
                    if (gameData.energy === gameData.max_energy) {
                        showMessage('‚úÖ –ù–æ–≤—ã–π –¥–µ–Ω—å! –≠–Ω–µ—Ä–≥–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!', true);
                        
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —É—Å–ø–µ—Ö–∞
                        triggerSuccessAnimation('energyDisplay');
                        triggerSuccessAnimation('healthValue');
                    } else {
                        showMessage(`‚ö†Ô∏è –ù–æ–≤—ã–π –¥–µ–Ω—å! –≠–Ω–µ—Ä–≥–∏—è: ${gameData.energy}/${gameData.max_energy}`, true);
                    }
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å:', error);
                
                // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ (–º–∞–∫—Å–∏–º—É–º 3 —Ä–∞–∑–∞)
                if (retryCount < 3) {
                    showMessage(`üîÑ –°–µ—Ä–≤–µ—Ä –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è... –ü–æ–ø—ã—Ç–∫–∞ ${retryCount + 1}/3`, false);
                    setTimeout(() => nextDay(retryCount + 1), 3000); // –ñ–¥—ë–º 3 —Å–µ–∫—É–Ω–¥—ã
                } else {
                    showMessage('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1 –º–∏–Ω—É—Ç—É –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)', false);
                }
            }
        }
        
        function confirmEndDay() {
            const currentEnergy = gameData.energy || 0;
            
            if (currentEnergy > 20) {
                // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å –º–Ω–æ–≥–æ —ç–Ω–µ—Ä–≥–∏–∏
                if (confirm('–£ —Ç–µ–±—è –æ—Å—Ç–∞–ª–æ—Å—å ' + currentEnergy + ' —ç–Ω–µ—Ä–≥–∏–∏! –£–≤–µ—Ä–µ–Ω —á—Ç–æ —Ö–æ—á–µ—à—å –∑–∞–∫–æ–Ω—á–∏—Ç—å –¥–µ–Ω—å? –ú–æ–∂–Ω–æ –µ—â–µ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å!')) {
                    nextDay();
                }
            } else if (currentEnergy > 0) {
                // –ù–µ–±–æ–ª—å—à–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                if (confirm('–û—Å—Ç–∞–ª–æ—Å—å ' + currentEnergy + ' —ç–Ω–µ—Ä–≥–∏–∏. –ó–∞–∫–æ–Ω—á–∏—Ç—å –¥–µ–Ω—å?')) {
                    nextDay();
                }
            } else {
                // –≠–Ω–µ—Ä–≥–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å - —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏–º
                nextDay();
            }
        }
        
        async function workUntilExhausted() {
            const startEnergy = gameData.energy || 0;
            
            if (startEnergy <= 0) {
                showMessage('–≠–Ω–µ—Ä–≥–∏—è —É–∂–µ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å!', false);
                return;
            }
            
            showMessage('–†–∞–±–æ—Ç–∞—é –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è... ‚ö°', true);
            
            let totalIncome = 0;
            let workCount = 0;
            let consecutiveErrors = 0;
            const maxErrors = 3;
            
            // –†–∞–±–æ—Ç–∞–µ–º –ø–æ–∫–∞ –µ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏—è
            while (gameData.energy > 0 && consecutiveErrors < maxErrors) {
                try {
                    const response = await fetch('/api/work', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ user_id: userId })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        gameData = result.user;
                        totalIncome += result.income;
                        workCount++;
                        consecutiveErrors = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
                        updateUI();
                        
                        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
                        await new Promise(resolve => setTimeout(resolve, 300));
                    } else {
                        const error = await response.json();
                        // –ï—Å–ª–∏ –Ω–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –≤—ã—Ö–æ–¥–∏–º
                        if (error.error && error.error.includes('—ç–Ω–µ—Ä–≥–∏–∏')) {
                            break;
                        }
                        consecutiveErrors++;
                        if (consecutiveErrors >= maxErrors) {
                            showMessage('–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞', false);
                            break;
                        }
                        // –ñ–¥—ë–º –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ:', error);
                    consecutiveErrors++;
                    if (consecutiveErrors >= maxErrors) {
                        showMessage('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è! –û—Å—Ç–∞–Ω–æ–≤–∫–∞', false);
                        break;
                    }
                    // –ñ–¥—ë–º –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            if (workCount > 0) {
                showMessage(`–û—Ç—Ä–∞–±–æ—Ç–∞–ª –≤–µ—Å—å –¥–µ–Ω—å! üí™ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: +${totalIncome}‚ÇΩ (${workCount} —Ä–∞–∑)`, true);
            } else {
                showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å', false);
            }
        }
        
        function showJobs() {
            const jobsList = document.getElementById('jobsList');
            jobsList.innerHTML = '';
            
            const jobs = {
                'delivery': { name: '–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã', emoji: 'üõµ', income: 80, energy: 5, unlock_day: 1 },
                'office': { name: '–û—Ñ–∏—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞', emoji: 'üíª', income: 120, energy: 3, unlock_day: 5 },
                'freelance': { name: '–§—Ä–∏–ª–∞–Ω—Å', emoji: 'üé®', income: 200, energy: 7, unlock_day: 10 },
                'crypto': { name: '–ö—Ä–∏–ø—Ç–æ-—Ç—Ä–µ–π–¥–∏–Ω–≥', emoji: 'üìà', income: 300, energy: 10, unlock_day: 15 }
            };
            
            for (const jobId in jobs) {
                const job = jobs[jobId];
                const isUnlocked = (gameData.day || 1) >= job.unlock_day;
                const isCurrent = (gameData.current_job || 'delivery') === jobId;
                
                const card = document.createElement('div');
                card.className = 'item-card' + (!isUnlocked ? ' locked' : '') + (isCurrent ? ' owned' : '');
                if (isUnlocked && !isCurrent) {
                    card.onclick = function() { changeJob(jobId); };
                }
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + job.emoji + '</div>' +
                    '<div class="item-name">' + job.name + '</div>' +
                    '<div class="item-price">+' + job.income + '‚ÇΩ</div>' +
                    '</div>' +
                    '<div class="item-desc">–≠–Ω–µ—Ä–≥–∏—è: -' + job.energy + '</div>' +
                    '<div class="item-desc">' + (isUnlocked ? (isCurrent ? '‚úÖ –¢–µ–∫—É—â–∞—è' : '–î–æ—Å—Ç—É–ø–Ω–æ') : 'üîí –î–µ–Ω—å ' + job.unlock_day) + '</div>';
                
                jobsList.appendChild(card);
            }
            
            document.getElementById('jobsModal').style.display = 'flex';
        }
        
        async function changeJob(jobId) {
            try {
                const response = await fetch('/api/change_job', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, job_id: jobId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    document.getElementById('jobsModal').style.display = 'none';
                    showMessage('–†–∞–±–æ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞!', true);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        function showShop() {
            showShopTab('boosters');
            document.getElementById('shopModal').style.display = 'flex';
        }
        
        let currentShopTab = 'boosters';
        
        function showShopTab(tab) {
            currentShopTab = tab;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–±
            const tabs = document.querySelectorAll('.shop-tab');
            tabs.forEach(function(t, index) {
                t.classList.remove('active');
                if ((tab === 'boosters' && index === 0) ||
                    (tab === 'cars' && index === 1) ||
                    (tab === 'realestate' && index === 2)) {
                    t.classList.add('active');
                }
            });
            
            const shopList = document.getElementById('shopList');
            shopList.innerHTML = '';
            
            if (tab === 'boosters') {
                showBoosters(shopList);
            } else if (tab === 'cars') {
                showCars(shopList);
            } else if (tab === 'realestate') {
                showRealEstate(shopList);
            }
        }
        
        function showBoosters(container) {
            const items = {
                'coffee': { name: '–ö–æ—Ñ–µ', emoji: '‚òï', price: 150, desc: '+30 —ç–Ω–µ—Ä–≥–∏–∏' },
                'energy_drink': { name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', emoji: 'ü•§', price: 300, desc: '+50 —ç–Ω–µ—Ä–≥–∏–∏' },
                'laptop': { name: '–ù–æ—É—Ç–±—É–∫', emoji: 'üíª', price: 2000, desc: '–û—Ñ–∏—Å +50%' },
                'scooter': { name: '–°–∞–º–æ–∫–∞—Ç', emoji: 'üõ¥', price: 1500, desc: '–î–æ—Å—Ç–∞–≤–∫–∞ -20%' }
            };
            
            for (const itemId in items) {
                const item = items[itemId];
                const canAfford = (gameData.money || 500) >= item.price;
                const isOwned = (gameData.owned_items || []).includes(itemId);
                
                const card = document.createElement('div');
                card.className = 'item-card' + (!canAfford ? ' locked' : '') + (isOwned ? ' owned' : '');
                if (canAfford && !isOwned) {
                    card.onclick = function() { buyItem(itemId); };
                }
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + item.emoji + '</div>' +
                    '<div class="item-name">' + item.name + '</div>' +
                    '<div class="item-price">' + item.price + '‚ÇΩ</div>' +
                    '</div>' +
                    '<div class="item-desc">' + item.desc + '</div>' +
                    '<div class="item-desc">' + (isOwned ? '‚úÖ –ö—É–ø–ª–µ–Ω–æ' : (canAfford ? '–î–æ—Å—Ç—É–ø–Ω–æ' : 'üîí –ú–∞–ª–æ –¥–µ–Ω–µ–≥')) + '</div>';
                
                container.appendChild(card);
            }
        }
        
        function showCars(container) {
            const cars = {
                'old_car': { name: '–°—Ç–∞—Ä–∞—è –º–∞—à–∏–Ω–∞', emoji: 'üöó', price: 150000, desc: '–î–æ—Å—Ç–∞–≤–∫–∞ +10%', monthly: 8000 },
                'new_car': { name: '–ù–æ–≤–∞—è –º–∞—à–∏–Ω–∞', emoji: 'üöô', price: 800000, desc: '–î–æ—Å—Ç–∞–≤–∫–∞ +20%', monthly: 15000 },
                'luxury_car': { name: '–ü—Ä–µ–º–∏—É–º –∞–≤—Ç–æ', emoji: 'üèéÔ∏è', price: 2500000, desc: '–î–æ—Å—Ç–∞–≤–∫–∞ +30%', monthly: 35000 }
            };
            
            for (const carId in cars) {
                const car = cars[carId];
                const canAfford = (gameData.money || 500) >= car.price;
                const isOwned = (gameData.cars || []).includes(carId);
                
                const card = document.createElement('div');
                card.className = 'item-card' + (!canAfford ? ' locked' : '') + (isOwned ? ' owned' : '');
                if (canAfford && !isOwned) {
                    card.onclick = function() { buyCar(carId); };
                }
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + car.emoji + '</div>' +
                    '<div class="item-name">' + car.name + '</div>' +
                    '<div class="item-price">' + car.price.toLocaleString() + '‚ÇΩ</div>' +
                    '</div>' +
                    '<div class="item-desc">' + car.desc + '</div>' +
                    '<div class="item-desc">–†–∞—Å—Ö–æ–¥—ã: ' + car.monthly.toLocaleString() + '‚ÇΩ/–º–µ—Å</div>' +
                    '<div class="item-desc">' + (isOwned ? '‚úÖ –ö—É–ø–ª–µ–Ω–æ' : (canAfford ? '–î–æ—Å—Ç—É–ø–Ω–æ' : 'üîí –ú–∞–ª–æ –¥–µ–Ω–µ–≥')) + '</div>';
                
                container.appendChild(card);
            }
        }
        
        function showRealEstate(container) {
            const properties = {
                'studio': { name: '–°—Ç—É–¥–∏—è', emoji: 'üè†', price: 3000000, desc: '–≠–∫–æ–Ω–æ–º–∏—è 5000‚ÇΩ/–º–µ—Å', income: 0 },
                'apartment': { name: '–ö–≤–∞—Ä—Ç–∏—Ä–∞', emoji: 'üè°', price: 8000000, desc: '–î–æ—Ö–æ–¥ 25000‚ÇΩ/–º–µ—Å', income: 25000 },
                'house': { name: '–î–æ–º', emoji: 'üèòÔ∏è', price: 15000000, desc: '–î–æ—Ö–æ–¥ 50000‚ÇΩ/–º–µ—Å', income: 50000 },
                'shop': { name: '–ú–∞–≥–∞–∑–∏–Ω', emoji: 'üè™', price: 5000000, desc: '–î–æ—Ö–æ–¥ 80000‚ÇΩ/–º–µ—Å', income: 80000 },
                'office': { name: '–û—Ñ–∏—Å', emoji: 'üè¢', price: 12000000, desc: '–î–æ—Ö–æ–¥ 150000‚ÇΩ/–º–µ—Å', income: 150000 },
                'warehouse': { name: '–°–∫–ª–∞–¥', emoji: 'üè≠', price: 20000000, desc: '–î–æ—Ö–æ–¥ 200000‚ÇΩ/–º–µ—Å', income: 200000 }
            };
            
            for (const propId in properties) {
                const prop = properties[propId];
                const canAfford = (gameData.money || 500) >= prop.price;
                const isOwned = (gameData.real_estate || []).includes(propId);
                
                const card = document.createElement('div');
                card.className = 'item-card' + (!canAfford ? ' locked' : '') + (isOwned ? ' owned' : '');
                if (canAfford && !isOwned) {
                    card.onclick = function() { buyRealEstate(propId); };
                }
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + prop.emoji + '</div>' +
                    '<div class="item-name">' + prop.name + '</div>' +
                    '<div class="item-price">' + prop.price.toLocaleString() + '‚ÇΩ</div>' +
                    '</div>' +
                    '<div class="item-desc">' + prop.desc + '</div>' +
                    '<div class="item-desc">' + (isOwned ? '‚úÖ –ö—É–ø–ª–µ–Ω–æ' : (canAfford ? '–î–æ—Å—Ç—É–ø–Ω–æ' : 'üîí –ú–∞–ª–æ –¥–µ–Ω–µ–≥')) + '</div>';
                
                container.appendChild(card);
            }
        }
        
        async function buyCar(carId) {
            try {
                const response = await fetch('/api/buy_car', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_id: userId, 
                        car_id: carId,
                        payment_type: 'cash'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showShopTab(currentShopTab);
                    showMessage('–ú–∞—à–∏–Ω–∞ –∫—É–ø–ª–µ–Ω–∞!', true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        async function buyRealEstate(propId) {
            try {
                const response = await fetch('/api/buy_real_estate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_id: userId, 
                        property_id: propId,
                        payment_type: 'cash'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showShopTab(currentShopTab);
                    showMessage('–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –∫—É–ø–ª–µ–Ω–∞!', true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        function showShop_OLD() {
            const shopList = document.getElementById('shopList');
            shopList.innerHTML = '';
            
            const items = {
                'coffee': { name: '–ö–æ—Ñ–µ', emoji: '‚òï', price: 150, desc: '+30 —ç–Ω–µ—Ä–≥–∏–∏' },
                'energy_drink': { name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', emoji: 'ü•§', price: 300, desc: '+50 —ç–Ω–µ—Ä–≥–∏–∏' },
                'laptop': { name: '–ù–æ—É—Ç–±—É–∫', emoji: 'üíª', price: 2000, desc: '–û—Ñ–∏—Å +50%' },
                'scooter': { name: '–°–∞–º–æ–∫–∞—Ç', emoji: 'üõ¥', price: 1500, desc: '–î–æ—Å—Ç–∞–≤–∫–∞ -20%' }
            };
            
            for (const itemId in items) {
                const item = items[itemId];
                const canAfford = (gameData.money || 500) >= item.price;
                const isOwned = (gameData.owned_items || []).includes(itemId);
                
                const card = document.createElement('div');
                card.className = 'item-card' + (!canAfford ? ' locked' : '') + (isOwned ? ' owned' : '');
                if (canAfford && !isOwned) {
                    card.onclick = function() { buyItem(itemId); };
                }
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + item.emoji + '</div>' +
                    '<div class="item-name">' + item.name + '</div>' +
                    '<div class="item-price">' + item.price + '‚ÇΩ</div>' +
                    '</div>' +
                    '<div class="item-desc">' + item.desc + '</div>' +
                    '<div class="item-desc">' + (isOwned ? '‚úÖ –ö—É–ø–ª–µ–Ω–æ' : (canAfford ? '–î–æ—Å—Ç—É–ø–Ω–æ' : 'üîí –ú–∞–ª–æ –¥–µ–Ω–µ–≥')) + '</div>';
                
                shopList.appendChild(card);
            }
            
            document.getElementById('shopModal').style.display = 'flex';
        }
        
        async function buyItem(itemId) {
            try {
                const response = await fetch('/api/buy_booster', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, booster_id: itemId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showShop();
                    showMessage('–ö—É–ø–ª–µ–Ω–æ!', true);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        async function showGoals() {
            try {
                const response = await fetch('/api/goals');
                const goals = await response.json();
                
                const goalsList = document.getElementById('goalsList');
                goalsList.innerHTML = '';
                
                for (const goalId in goals) {
                    const goal = goals[goalId];
                    const isCompleted = (gameData.completed_goals || []).includes(goalId);
                    
                    const card = document.createElement('div');
                    card.className = 'item-card' + (isCompleted ? ' owned' : '');
                    
                    card.innerHTML = '<div class="item-header">' +
                        '<div class="item-icon">' + goal.emoji + '</div>' +
                        '<div class="item-name">' + goal.name + '</div>' +
                        '<div class="item-price">' + (isCompleted ? '‚úÖ' : goal.reward_money + '‚ÇΩ') + '</div>' +
                        '</div>' +
                        '<div class="item-desc">' + goal.description + '</div>';
                    
                    goalsList.appendChild(card);
                }
                
                document.getElementById('goalsModal').style.display = 'flex';
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏!', false);
            }
        }
        
        // ============================================
        // –ë–ò–ó–ù–ï–° –°–ò–°–¢–ï–ú–ê
        // ============================================
        
        async function showBusiness() {
            try {
                const response = await fetch(`/api/business/list?user_id=${userId}`);
                const data = await response.json();
                
                const businessList = document.getElementById('businessList');
                businessList.innerHTML = '';
                
                // –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å
                const createSection = document.createElement('div');
                createSection.style.cssText = 'margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #8e44ad 0%, #6c3483 100%); border-radius: 12px; color: white;';
                createSection.innerHTML = `
                    <h3 style="margin-bottom: 10px;"><i class="fas fa-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å</h3>
                    <select id="businessTypeSelect" style="width: 100%; padding: 10px; border-radius: 8px; border: none; margin-bottom: 10px; font-size: 14px;">
                        <option value="kiosk">üè™ –ö–∏–æ—Å–∫ —Å —à–∞—É—Ä–º–æ–π - 50,000‚ÇΩ</option>
                        <option value="cafe">‚òï –ö–∞—Ñ–µ - 300,000‚ÇΩ</option>
                        <option value="restaurant">üçΩÔ∏è –†–µ—Å—Ç–æ—Ä–∞–Ω - 1,000,000‚ÇΩ</option>
                        <option value="restaurant_chain">üè¢ –°–µ—Ç—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ - 5,000,000‚ÇΩ</option>
                    </select>
                    <button onclick="createBusiness()" style="width: 100%; padding: 12px; background: white; color: #8e44ad; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px;">
                        <i class="fas fa-store"></i> –°–æ–∑–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å
                    </button>
                `;
                businessList.appendChild(createSection);
                
                // –°–ø–∏—Å–æ–∫ –±–∏–∑–Ω–µ—Å–æ–≤
                if (data.businesses && data.businesses.length > 0) {
                    data.businesses.forEach(business => {
                        const card = document.createElement('div');
                        card.className = 'item-card';
                        card.style.cssText = 'margin-bottom: 15px;';
                        
                        const profitClass = business.net_profit >= 0 ? 'profit' : 'loss';
                        const profitColor = business.net_profit >= 0 ? '#27ae60' : '#e74c3c';
                        
                        card.innerHTML = `
                            <div class="item-header">
                                <div class="item-icon">${business.config.emoji}</div>
                                <div class="item-name">${business.config.name}</div>
                                <div class="item-price" style="color: ${profitColor};">
                                    ${business.net_profit >= 0 ? '+' : ''}${Math.round(business.net_profit)}‚ÇΩ/–¥–µ–Ω—å
                                </div>
                            </div>
                            <div class="item-desc">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                    <div>‚≠ê –†–µ–π—Ç–∏–Ω–≥: ${business.rating.toFixed(1)}/5.0</div>
                                    <div>üì¶ –ó–∞–ø–∞—Å—ã: ${Math.round(business.inventory_level)}%</div>
                                    <div>üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${business.employees.length}/${business.config.max_employees}</div>
                                    <div>üíµ –î–æ—Ö–æ–¥: ${Math.round(business.daily_revenue)}‚ÇΩ</div>
                                </div>
                                <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                    <button onclick="buyInventory('${business.business_id}')" style="flex: 1; padding: 8px; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                        üì¶ –ó–∞–ø–∞—Å—ã (5,000‚ÇΩ)
                                    </button>
                                    <button onclick="hireEmployee('${business.business_id}')" style="flex: 1; padding: 8px; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                        üë§ –ù–∞–Ω—è—Ç—å
                                    </button>
                                    <button onclick="sellBusiness('${business.business_id}')" style="flex: 1; padding: 8px; background: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                        üí∞ –ü—Ä–æ–¥–∞—Ç—å
                                    </button>
                                </div>
                            </div>
                        `;
                        businessList.appendChild(card);
                    });
                } else {
                    const emptyMsg = document.createElement('div');
                    emptyMsg.style.cssText = 'text-align: center; padding: 20px; color: #888;';
                    emptyMsg.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±–∏–∑–Ω–µ—Å–æ–≤</p><p style="font-size: 12px; margin-top: 10px;">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –±–∏–∑–Ω–µ—Å –≤—ã—à–µ!</p>';
                    businessList.appendChild(emptyMsg);
                }
                
                document.getElementById('businessModal').style.display = 'flex';
            } catch (error) {
                console.error('Error loading business:', error);
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–∑–Ω–µ—Å–æ–≤!', false);
            }
        }
        
        async function createBusiness() {
            const businessType = document.getElementById('businessTypeSelect').value;
            
            try {
                const response = await fetch('/api/business/create', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        user_id: userId,
                        business_type: businessType
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message, true);
                    await updateGameData();
                    await showBusiness(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    showMessage(data.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–∏–∑–Ω–µ—Å–∞', false);
                }
            } catch (error) {
                console.error('Error creating business:', error);
                showMessage('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–∏–∑–Ω–µ—Å–∞!', false);
            }
        }
        
        async function buyInventory(businessId) {
            try {
                const response = await fetch(`/api/business/${businessId}/buy-inventory`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: userId})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message, true);
                    await updateGameData();
                    await showBusiness();
                } else {
                    showMessage(data.error || '–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏ –∑–∞–ø–∞—Å–æ–≤', false);
                }
            } catch (error) {
                console.error('Error buying inventory:', error);
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏ –∑–∞–ø–∞—Å–æ–≤!', false);
            }
        }
        
        async function hireEmployee(businessId) {
            const employeeType = prompt('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:\nchef - –ü–æ–≤–∞—Ä (5,000‚ÇΩ/–¥–µ–Ω—å, +30% –∫–∞—á–µ—Å—Ç–≤–æ)\ncashier - –ö–∞—Å—Å–∏—Ä (3,000‚ÇΩ/–¥–µ–Ω—å, +20% —Å–∫–æ—Ä–æ—Å—Ç—å)\nmanager - –ú–µ–Ω–µ–¥–∂–µ—Ä (8,000‚ÇΩ/–¥–µ–Ω—å, +25% –¥–æ—Ö–æ–¥)');
            
            if (!employeeType) return;
            
            try {
                const response = await fetch(`/api/business/${businessId}/hire`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        user_id: userId,
                        employee_type: employeeType
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message, true);
                    await updateGameData();
                    await showBusiness();
                } else {
                    showMessage(data.error || '–û—à–∏–±–∫–∞ –Ω–∞–π–º–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', false);
                }
            } catch (error) {
                console.error('Error hiring employee:', error);
                showMessage('–û—à–∏–±–∫–∞ –Ω–∞–π–º–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞!', false);
            }
        }
        
        async function sellBusiness(businessId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å? –í—ã –ø–æ–ª—É—á–∏—Ç–µ 50% –æ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤.')) return;
            
            try {
                const response = await fetch(`/api/business/${businessId}/sell`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: userId})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message, true);
                    await updateGameData();
                    await showBusiness();
                } else {
                    showMessage(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–æ–¥–∞–∂–∏ –±–∏–∑–Ω–µ—Å–∞', false);
                }
            } catch (error) {
                console.error('Error selling business:', error);
                showMessage('–û—à–∏–±–∫–∞ –ø—Ä–æ–¥–∞–∂–∏ –±–∏–∑–Ω–µ—Å–∞!', false);
            }
        }
        
        // ============================================
        // SIDE JOBS FUNCTIONS
        // ============================================
        
        async function showSideJobs() {
            try {
                // –í–ê–ñ–ù–û: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º
                await loadUserData();
                
                const response = await fetch(`/api/side-jobs/list?user_id=${userId}`);
                const data = await response.json();
                
                const sideJobsList = document.getElementById('sideJobsList');
                sideJobsList.innerHTML = '';
                
                if (data.success && data.jobs && data.jobs.length > 0) {
                    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                    const categories = {
                        'physical': { name: '–§–∏–∑–∏—á–µ—Å–∫–∏–µ', color: '#e74c3c', jobs: [] },
                        'mental': { name: '–£–º—Å—Ç–≤–µ–Ω–Ω—ã–µ', color: '#3498db', jobs: [] },
                        'creative': { name: '–¢–≤–æ—Ä—á–µ—Å–∫–∏–µ', color: '#9b59b6', jobs: [] },
                        'social': { name: '–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ', color: '#f39c12', jobs: [] }
                    };
                    
                    data.jobs.forEach(job => {
                        if (categories[job.category]) {
                            categories[job.category].jobs.push(job);
                        }
                    });
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                    for (const catKey in categories) {
                        const cat = categories[catKey];
                        if (cat.jobs.length === 0) continue;
                        
                        const catHeader = document.createElement('div');
                        catHeader.style.cssText = `padding: 10px; background: ${cat.color}; color: white; font-weight: bold; border-radius: 8px; margin: 10px 0 5px 0;`;
                        catHeader.textContent = cat.name;
                        sideJobsList.appendChild(catHeader);
                        
                        cat.jobs.forEach(job => {
                            const card = document.createElement('div');
                            card.className = 'item-card';
                            if (job.completed) {
                                card.style.opacity = '0.5';
                            }
                            
                            const successRate = job.final_success_rate || job.success_rate || 0.5;
                            const successPercent = Math.round(successRate * 100);
                            const successColor = successPercent >= 80 ? '#27ae60' : successPercent >= 60 ? '#f39c12' : '#e74c3c';
                            const payment = job.final_payment || job.base_payment || 0;
                            
                            card.innerHTML = `
                                <div class="item-header">
                                    <div class="item-icon">${job.emoji}</div>
                                    <div class="item-name">${job.name}</div>
                                    <div class="item-price">+${payment}‚ÇΩ</div>
                                </div>
                                <div class="item-desc">${job.description}</div>
                                <div class="item-desc" style="margin-top: 8px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span>‚ö° –≠–Ω–µ—Ä–≥–∏—è: ${job.energy_cost}</span>
                                        <span style="color: ${successColor};">üìä –®–∞–Ω—Å: ${successPercent}%</span>
                                    </div>
                                    ${job.completed ? 
                                        '<div style="text-align: center; padding: 8px; background: #95a5a6; color: white; border-radius: 6px; margin-top: 8px;">‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>' :
                                        `<button onclick="executeSideJob('${job.id}')" style="width: 100%; padding: 10px; background: ${cat.color}; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 8px;">
                                            –í—ã–ø–æ–ª–Ω–∏—Ç—å
                                        </button>`
                                    }
                                </div>
                            `;
                            sideJobsList.appendChild(card);
                        });
                    }
                } else {
                    sideJobsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #888;"><p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–¥—Ä–∞–±–æ—Ç–æ–∫</p></div>';
                }
                
                document.getElementById('sideJobsModal').style.display = 'flex';
            } catch (error) {
                console.error('Error loading side jobs:', error);
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥—Ä–∞–±–æ—Ç–æ–∫!', false);
            }
        }
        
        async function executeSideJob(jobId) {
            try {
                const response = await fetch('/api/side-jobs/execute', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        user_id: userId,
                        job_id: jobId
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    gameData = data.user;
                    updateUI();
                    showMessage(data.message, data.job_success);
                    await showSideJobs(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    showMessage(data.error || '–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–¥—Ä–∞–±–æ—Ç–∫–∏', false);
                }
            } catch (error) {
                console.error('Error executing side job:', error);
                showMessage('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–¥—Ä–∞–±–æ—Ç–∫–∏!', false);
            }
        }
        
        // ============================================
        // –ü–†–ò–í–ï–¢–°–¢–í–ò–ï –ò –ò–ú–Ø –ò–ì–†–û–ö–ê
        // ============================================
        
        function showNameInput() {
            document.getElementById('welcomeModal').style.display = 'none';
            document.getElementById('nameModal').style.display = 'flex';
            document.getElementById('playerNameInput').focus();
        }
        
        async function setPlayerName() {
            const nameInput = document.getElementById('playerNameInput');
            const playerName = nameInput.value.trim();
            
            if (!playerName || playerName.length < 2) {
                showMessage('–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞!', false);
                return;
            }
            
            if (playerName.length > 20) {
                showMessage('–ò–º—è —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å 20 —Å–∏–º–≤–æ–ª–æ–≤)!', false);
                return;
            }
            
            try {
                const response = await fetch('/api/set_name', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, player_name: playerName })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    gameData.player_name = playerName;
                    gameData.name_set = true;
                    
                    document.getElementById('nameModal').style.display = 'none';
                    showMessage(data.message, true);
                    
                    // –û—Ç–º–µ—á–∞–µ–º –≥–∞–π–¥ –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π
                    await fetch('/api/complete_tutorial', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ user_id: userId })
                    });
                    
                    gameData.tutorial_completed = true;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —á–µ—Ä—Ç—ã
                    if (!gameData.trait_selected) {
                        setTimeout(() => showTraitSelection(), 500);
                    }
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏!', false);
            }
        }
        
        // Enter –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–º–µ–Ω–∏
        document.addEventListener('DOMContentLoaded', () => {
            const nameInput = document.getElementById('playerNameInput');
            if (nameInput) {
                nameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        setPlayerName();
                    }
                });
            }
        });
        
        // ============================================
        // –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í
        // ============================================
        
        async function showLeaderboard() {
            document.getElementById('leaderboardModal').style.display = 'flex';
            document.getElementById('leaderboardContent').innerHTML = '<p style="text-align: center; color: #999;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
            
            try {
                const response = await fetch('/api/leaderboard');
                if (response.ok) {
                    const players = await response.json();
                    
                    if (players.length === 0) {
                        document.getElementById('leaderboardContent').innerHTML = '<p style="text-align: center; color: #999;">–ü–æ–∫–∞ –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü–µ</p>';
                        return;
                    }
                    
                    let html = '<div style="overflow-x: auto;">';
                    html += '<table style="width: 100%; border-collapse: collapse;">';
                    html += '<thead><tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">';
                    html += '<th style="padding: 12px; text-align: center;">#</th>';
                    html += '<th style="padding: 12px; text-align: left;">–ò–≥—Ä–æ–∫</th>';
                    html += '<th style="padding: 12px; text-align: center;">–ú–µ—Å—è—Ü</th>';
                    html += '<th style="padding: 12px; text-align: right;">–î–µ–Ω—å–≥–∏</th>';
                    html += '<th style="padding: 12px; text-align: center;">–¶–µ–ª–∏</th>';
                    html += '</tr></thead><tbody>';
                    
                    players.forEach((player, index) => {
                        const rank = index + 1;
                        let medal = '';
                        let bgColor = '';
                        
                        if (rank === 1) {
                            medal = 'ü•á';
                            bgColor = 'background: #fff9e6;';
                        } else if (rank === 2) {
                            medal = 'ü•à';
                            bgColor = 'background: #f5f5f5;';
                        } else if (rank === 3) {
                            medal = 'ü•â';
                            bgColor = 'background: #fff5f0;';
                        }
                        
                        html += `<tr style="${bgColor} border-bottom: 1px solid #eee;">`;
                        html += `<td style="padding: 12px; text-align: center; font-weight: bold;">${medal} ${rank}</td>`;
                        html += `<td style="padding: 12px; text-align: left; font-weight: bold;">${player.player_name}</td>`;
                        html += `<td style="padding: 12px; text-align: center;">${player.month}</td>`;
                        html += `<td style="padding: 12px; text-align: right; color: #27ae60; font-weight: bold;">${player.money.toLocaleString()}‚ÇΩ</td>`;
                        html += `<td style="padding: 12px; text-align: center;">${player.total_goals}</td>`;
                        html += '</tr>';
                    });
                    
                    html += '</tbody></table></div>';
                    document.getElementById('leaderboardContent').innerHTML = html;
                } else {
                    document.getElementById('leaderboardContent').innerHTML = '<p style="text-align: center; color: #e74c3c;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
                }
            } catch (error) {
                document.getElementById('leaderboardContent').innerHTML = '<p style="text-align: center; color: #e74c3c;">–û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p>';
            }
        }
        
        function closeLeaderboard() {
            document.getElementById('leaderboardModal').style.display = 'none';
        }
        
        loadUserData();
    </script>
</body>
</html>
