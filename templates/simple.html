<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–í—ã–∂–∏–≤–∏ –¥–æ –∑–∞—Ä–ø–ª–∞—Ç—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #2c5f8d 0%, #1e4266 100%);
            color: #2c3e50;
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: linear-gradient(135deg, #e8dcc0 0%, #d4c4a0 100%);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            border: 8px solid #2c3e50;
        }
        
        .top-bar {
            background: linear-gradient(135deg, #2c5f8d 0%, #1e4266 100%);
            border-radius: 12px;
            padding: 12px 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        .main-area {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .character-card {
            background: linear-gradient(135deg, #8b7355 0%, #6d5a45 100%);
            border-radius: 15px;
            padding: 15px;
            border: 3px solid #5a4a35;
        }
        
        .character-image {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #4a4a4a 0%, #2c2c2c 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            border: 3px solid #3a3a3a;
            position: relative;
        }
        
        .character-level-badge {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            z-index: 10;
        }
        
        .right-panel { 
            display: flex; 
            flex-direction: column; 
            gap: 12px;
            background-image: url('/static/room-bg.jpg.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 15px;
            padding: 15px;
            position: relative;
        }
        
        .right-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            z-index: 0;
        }
        
        .right-panel > * {
            position: relative;
            z-index: 1;
        }
        
        .money-progress {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            border-radius: 12px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-weight: bold;
            border: 2px solid #1e8449;
        }
        
        .progress-bar {
            flex: 1;
            height: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f39c12 0%, #f1c40f 100%);
            transition: width 0.3s;
        }
        
        .nav-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .nav-btn {
            background: linear-gradient(135deg, #8b4513 0%, #654321 100%);
            border: 3px solid #5a3a1a;
            border-radius: 12px;
            padding: 15px 10px;
            color: white;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            text-align: center;
        }
        
        .nav-btn.shop {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            border-color: #21618c;
        }
        
        .nav-btn.goals {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            border-color: #ca6f1e;
        }
        
        .nav-btn-icon { font-size: 28px; display: block; margin-bottom: 5px; }
        
        .job-info {
            background: rgba(255,255,255,0.3);
            border-radius: 12px;
            padding: 15px;
            border: 2px solid rgba(139,115,85,0.3);
        }
        
        .work-button, .next-day-btn {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
            border: 3px solid #1e8449;
            border-radius: 12px;
            cursor: pointer;
        }
        
        .work-button:disabled, .next-day-btn:disabled {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            border-color: #7f8c8d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
            border-radius: 20px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 4px solid #34495e;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            padding: 20px;
            border-radius: 16px 16px 0 0;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            font-size: 24px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .modal-body { padding: 20px; }
        
        .item-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border: 3px solid #8b7355;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
        }
        
        .item-card.locked { opacity: 0.5; cursor: not-allowed; }
        .item-card.owned {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
        }
        
        .item-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .item-icon { font-size: 32px; }
        .item-name { flex: 1; font-weight: bold; font-size: 16px; }
        .item-price { font-size: 16px; font-weight: bold; color: #27ae60; }
        .item-desc { font-size: 13px; color: #666; }
        
        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 2000;
            display: none;
            font-weight: bold;
        }
        
        .message.success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }
        
        .shop-tabs {
            display: flex;
            gap: 5px;
            padding: 15px;
            background: rgba(0,0,0,0.1);
        }
        
        .shop-tab {
            flex: 1;
            padding: 12px 10px;
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            border: 2px solid #5a6268;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .shop-tab.active {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            border-color: #21618c;
            transform: scale(1.05);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .container {
                padding: 8px;
                border: 4px solid #2c3e50;
                border-radius: 15px;
            }
            
            .top-bar {
                padding: 8px 12px;
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            .main-area { 
                grid-template-columns: 1fr;
                gap: 8px;
                margin-bottom: 8px;
            }
            
            .character-card {
                padding: 10px;
            }
            
            .character-image {
                height: 180px;
                font-size: 60px;
            }
            
            .character-level-badge {
                padding: 5px 10px;
                font-size: 11px;
            }
            
            .right-panel {
                gap: 8px;
            }
            
            .money-progress {
                padding: 8px 10px;
                font-size: 13px;
            }
            
            .progress-bar {
                height: 16px;
            }
            
            .nav-buttons {
                gap: 6px;
            }
            
            .nav-btn {
                padding: 10px 6px;
                font-size: 11px;
                border: 2px solid;
            }
            
            .nav-btn-icon {
                font-size: 20px;
                margin-bottom: 3px;
            }
            
            .job-info {
                padding: 10px;
                font-size: 13px;
            }
            
            .work-button, .next-day-btn {
                padding: 12px;
                font-size: 15px;
                border: 2px solid;
            }
            
            .modal {
                padding: 10px;
            }
            
            .modal-content {
                max-height: 85vh;
            }
            
            .modal-header {
                padding: 12px 15px;
                font-size: 16px;
            }
            
            .modal-body {
                padding: 12px;
            }
            
            .item-card {
                padding: 10px;
                margin: 6px 0;
                border: 2px solid #8b7355;
            }
            
            .item-icon {
                font-size: 24px;
            }
            
            .item-name {
                font-size: 14px;
            }
            
            .item-price {
                font-size: 14px;
            }
            
            .item-desc {
                font-size: 11px;
            }
            
            .close-btn {
                width: 30px;
                height: 30px;
                font-size: 20px;
            }
            
            .shop-tabs {
                padding: 10px;
                gap: 4px;
            }
            
            .shop-tab {
                padding: 8px 6px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <div>–ú–µ—Å—è—Ü <span id="month">1</span> | –î–µ–Ω—å <span id="day">1</span> / 30</div>
            <div>üí∞ <span id="topMoney">500</span>‚ÇΩ</div>
            <button class="close-btn" style="border: none; background: rgba(255,255,255,0.2); margin-right: 5px;" onclick="showLeaderboard()"><i class="fas fa-trophy"></i></button>
            <button class="close-btn" style="border: none; background: rgba(255,255,255,0.2);" onclick="showStats()"><i class="fas fa-chart-bar"></i></button>
        </div>
        
        <div class="main-area">
            <div class="character-card">
                <div class="character-image">
                    ‚òï
                    <div class="character-level-badge">
                        <span id="levelName">–û–±—ã—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å</span>
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="money-progress">
                    üí∞ <span id="money">500</span>‚ÇΩ
                    <div class="progress-bar">
                        <div class="progress-fill" id="moneyFill" style="width: 50%"></div>
                    </div>
                    <span id="energyDisplay">100/100</span>‚ö°
                </div>
                
                <div class="money-progress" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); border-color: #7d3c98;">
                    <span id="moodEmoji">üòê</span> <span id="moodValue">50</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="moodFill" style="width: 50%; background: linear-gradient(90deg, #e74c3c 0%, #f39c12 50%, #27ae60 100%);"></div>
                    </div>
                    <span id="moodText">–ù–æ—Ä–º–∞–ª—å–Ω–æ</span>
                </div>
                
                <div class="money-progress" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); border-color: #a93226;">
                    ‚ù§Ô∏è <span id="healthValue">100</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="healthFill" style="width: 100%; background: linear-gradient(90deg, #c0392b 0%, #e74c3c 50%, #27ae60 100%);"></div>
                    </div>
                    <span id="healthText">–ó–¥–æ—Ä–æ–≤</span>
                </div>
                
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="showJobs()">
                        <span class="nav-btn-icon"><i class="fas fa-briefcase"></i></span>
                        –†–∞–±–æ—Ç–∞
                    </button>
                    <button class="nav-btn shop" onclick="showShop()">
                        <span class="nav-btn-icon"><i class="fas fa-shopping-cart"></i></span>
                        –ú–∞–≥–∞–∑–∏–Ω
                    </button>
                    <button class="nav-btn goals" onclick="showGoals()">
                        <span class="nav-btn-icon"><i class="fas fa-trophy"></i></span>
                        –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                    </button>
                </div>
                
                <div class="nav-buttons" style="grid-template-columns: repeat(3, 1fr);">
                    <button class="nav-btn" style="background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); border-color: #ba4a00; padding: 10px;" onclick="buyFood()">
                        <span class="nav-btn-icon" style="font-size: 20px; margin-bottom: 2px;"><i class="fas fa-pizza-slice"></i></span>
                        <div style="font-size: 11px;">–ï–¥–∞ -200‚ÇΩ</div>
                    </button>
                    <button class="nav-btn" style="background: linear-gradient(135deg, #16a085 0%, #138d75 100%); border-color: #117a65; padding: 10px;" onclick="takeRest()">
                        <span class="nav-btn-icon" style="font-size: 20px; margin-bottom: 2px;"><i class="fas fa-bed"></i></span>
                        <div style="font-size: 11px;">–û—Ç–¥—ã—Ö +20‚ö°</div>
                    </button>
                    <button class="nav-btn" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border-color: #21618c; padding: 10px;" onclick="showSkills()">
                        <span class="nav-btn-icon" style="font-size: 20px; margin-bottom: 2px;"><i class="fas fa-star"></i></span>
                        <div style="font-size: 11px;">–ù–∞–≤—ã–∫–∏</div>
                    </button>
                </div>
                
                <div class="job-info">
                    <div style="font-size: 14px; color: #666;">
                        <span id="traitDisplay"></span>
                    </div>
                    <div style="font-size: 16px; font-weight: bold; margin: 5px 0;">
                        –¢–≤–æ—è —Ä–∞–±–æ—Ç–∞: <span id="currentJobName">–ö—É—Ä—å–µ—Ä</span>
                    </div>
                    <div style="font-size: 13px; color: #555;">
                        –ó–∞—Ä–ø–ª–∞—Ç–∞: +<span id="jobIncome">80</span>‚ÇΩ | –≠–Ω–µ—Ä–≥–∏—è: -<span id="jobEnergy">5</span>
                    </div>
                </div>
                
                <button class="work-button" id="workBtn" onclick="work()">
                    <i class="fas fa-briefcase"></i> –ü–æ—Ä–∞–±–æ—Ç–∞—Ç—å
                </button>
                
                <button class="work-button" id="workAllBtn" onclick="workUntilExhausted()" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); border-color: #ca6f1e;">
                    <i class="fas fa-bolt"></i> –†–∞–±–æ—Ç–∞—Ç—å –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è
                </button>
                
                <button class="work-button" onclick="randomEvent()" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); border-color: #7d3c98;">
                    <i class="fas fa-dice"></i> –°–ª—É—á–∞–π–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
                </button>
                
                <button class="work-button" onclick="showRoulette()" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); border-color: #a93226;">
                    <i class="fas fa-dice-five"></i> –†—É–ª–µ—Ç–∫–∞
                </button>
            </div>
        </div>
        
        <button class="next-day-btn" id="nextDayBtn" onclick="confirmEndDay()">
            <i class="fas fa-moon"></i> –ó–∞–∫–æ–Ω—á–∏—Ç—å –¥–µ–Ω—å –∏ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å
        </button>
    </div>
    
    <div class="modal" id="jobsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-briefcase"></i> –í—ã–±–µ—Ä–∏ —Ä–∞–±–æ—Ç—É</div>
                <button class="close-btn" onclick="document.getElementById('jobsModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body" id="jobsList"></div>
        </div>
    </div>
    
    <div class="modal" id="shopModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-shopping-cart"></i> –ú–∞–≥–∞–∑–∏–Ω</div>
                <button class="close-btn" onclick="document.getElementById('shopModal').style.display='none'">√ó</button>
            </div>
            <div class="shop-tabs">
                <button class="shop-tab active" onclick="showShopTab('boosters')"><i class="fas fa-coffee"></i> –ë—É—Å—Ç–µ—Ä—ã</button>
                <button class="shop-tab" onclick="showShopTab('cars')"><i class="fas fa-car"></i> –ú–∞—à–∏–Ω—ã</button>
                <button class="shop-tab" onclick="showShopTab('realestate')"><i class="fas fa-home"></i> –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</button>
            </div>
            <div class="modal-body" id="shopList"></div>
        </div>
    </div>
    
    <div class="modal" id="goalsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-trophy"></i> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                <button class="close-btn" onclick="document.getElementById('goalsModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body" id="goalsList"></div>
        </div>
    </div>
    
    <div class="modal" id="traitModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;">–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —á–µ—Ä—Ç—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞</div>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: #555;">–ß–µ—Ä—Ç–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Å—å –≥–µ–π–º–ø–ª–µ–π. –í—ã–±–µ—Ä–∏ –º—É–¥—Ä–æ!</p>
                <div id="traitsList"></div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                <button class="close-btn" onclick="document.getElementById('statsModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body">
                <div style="background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%); border: 3px solid #8b7355; border-radius: 12px; padding: 15px; margin: 10px 0;">
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">üí∞ –§–∏–Ω–∞–Ω—Å—ã</div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–¢–µ–∫—É—â–∏–µ –¥–µ–Ω—å–≥–∏: <span id="statMoney">0</span>‚ÇΩ</div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="statTotalEarned">0</span>‚ÇΩ</div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ: <span id="statTotalSpent">0</span>‚ÇΩ</div>
                </div>
                
                <div style="background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%); border: 3px solid #8b7355; border-radius: 12px; padding: 15px; margin: 10px 0;">
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–î–Ω–µ–π –ø—Ä–æ–∂–∏—Ç–æ: <span id="statDays">0</span></div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–†–∞–∑ —Ä–∞–±–æ—Ç–∞–ª: <span id="statWorkCount">0</span></div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–¶–µ–ª–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: <span id="statGoals">0</span></div>
                </div>
                
                <div style="background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%); border: 3px solid #8b7355; border-radius: 12px; padding: 15px; margin: 10px 0;">
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">üè† –ò–º—É—â–µ—Å—Ç–≤–æ</div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–ú–∞—à–∏–Ω: <span id="statCars">0</span></div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏: <span id="statProperty">0</span></div>
                    <div style="font-size: 14px; color: #555; margin: 5px 0;">–ö—Ä–µ–¥–∏—Ç–æ–≤: <span id="statCredits">0</span></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="rouletteModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-dice-five"></i> –†—É–ª–µ—Ç–∫–∞</div>
                <button class="close-btn" onclick="document.getElementById('rouletteModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <!-- –ë–∞—Ä–∞–±–∞–Ω —Ä—É–ª–µ—Ç–∫–∏ -->
                <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); border-radius: 20px; padding: 30px 20px; margin: 20px 0; border: 4px solid #f39c12; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 20px;">
                        <!-- –ë–∞—Ä–∞–±–∞–Ω 1 -->
                        <div style="background: white; border-radius: 15px; padding: 20px 15px; min-width: 80px; border: 3px solid #34495e; box-shadow: inset 0 4px 8px rgba(0,0,0,0.2);">
                            <div id="slot1" style="font-size: 50px; transition: all 0.1s;">üé∞</div>
                        </div>
                        <!-- –ë–∞—Ä–∞–±–∞–Ω 2 -->
                        <div style="background: white; border-radius: 15px; padding: 20px 15px; min-width: 80px; border: 3px solid #34495e; box-shadow: inset 0 4px 8px rgba(0,0,0,0.2);">
                            <div id="slot2" style="font-size: 50px; transition: all 0.1s;">üé∞</div>
                        </div>
                        <!-- –ë–∞—Ä–∞–±–∞–Ω 3 -->
                        <div style="background: white; border-radius: 15px; padding: 20px 15px; min-width: 80px; border: 3px solid #34495e; box-shadow: inset 0 4px 8px rgba(0,0,0,0.2);">
                            <div id="slot3" style="font-size: 50px; transition: all 0.1s;">üé∞</div>
                        </div>
                    </div>
                    <div id="rouletteMessage" style="font-size: 20px; font-weight: bold; color: #f39c12; min-height: 30px;"></div>
                </div>
                
                <div style="font-size: 18px; margin: 15px 0; color: #555;">–í—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É:</div>
                <div style="display: flex; gap: 10px; justify-content: center; margin: 20px 0;">
                    <button class="nav-btn" style="padding: 15px 20px; background: linear-gradient(135deg, #27ae60 0%, #229954 100%); border-color: #1e8449;" onclick="playRoulette(100)">üí∞ 100‚ÇΩ</button>
                    <button class="nav-btn" style="padding: 15px 20px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border-color: #21618c;" onclick="playRoulette(500)">üíé 500‚ÇΩ</button>
                    <button class="nav-btn" style="padding: 15px 20px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); border-color: #a93226;" onclick="playRoulette(1000)">üëë 1000‚ÇΩ</button>
                </div>
                <div style="font-size: 14px; color: #888; margin-top: 10px;">
                    –®–∞–Ω—Å—ã: 60% üò≠ | 25% üôÇ | 10% üòÑ | 5% ü§ë
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="skillsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="font-size: 20px; font-weight: bold;"><i class="fas fa-star"></i> –ù–∞–≤—ã–∫–∏</div>
                <button class="close-btn" onclick="document.getElementById('skillsModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 24px; font-weight: bold; color: #f39c12;">
                        –û—á–∫–æ–≤ –Ω–∞–≤—ã–∫–æ–≤: <span id="skillPoints">0</span> <i class="fas fa-star"></i>
                    </div>
                    <div style="font-size: 14px; color: #888; margin-top: 5px;">
                        –ü–æ–ª—É—á–∞–π –æ—á–∫–∏ –∑–∞ —Ä–∞–±–æ—Ç—É!
                    </div>
                </div>
                
                <div class="item-card" onclick="upgradeSkill('speed')">
                    <div class="item-header">
                        <div class="item-icon"><i class="fas fa-running"></i></div>
                        <div class="item-name">–°–∫–æ—Ä–æ—Å—Ç—å</div>
                        <div class="item-price">–£—Ä–æ–≤–µ–Ω—å <span id="speedLevel">1</span></div>
                    </div>
                    <div class="item-desc">–ú–µ–Ω—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ —Ä–∞–±–æ—Ç—É (-5% –∑–∞ —É—Ä–æ–≤–µ–Ω—å)</div>
                    <div class="item-desc">–°—Ç–æ–∏–º–æ—Å—Ç—å: 1 –æ—á–∫–æ</div>
                </div>
                
                <div class="item-card" onclick="upgradeSkill('luck')">
                    <div class="item-header">
                        <div class="item-icon"><i class="fas fa-clover"></i></div>
                        <div class="item-name">–£–¥–∞—á–∞</div>
                        <div class="item-price">–£—Ä–æ–≤–µ–Ω—å <span id="luckLevel">1</span></div>
                    </div>
                    <div class="item-desc">–ë–æ–ª—å—à–µ —à–∞–Ω—Å –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (+5% –∑–∞ —É—Ä–æ–≤–µ–Ω—å)</div>
                    <div class="item-desc">–°—Ç–æ–∏–º–æ—Å—Ç—å: 1 –æ—á–∫–æ</div>
                </div>
                
                <div class="item-card" onclick="upgradeSkill('charisma')">
                    <div class="item-header">
                        <div class="item-icon"><i class="fas fa-comments"></i></div>
                        <div class="item-name">–•–∞—Ä–∏–∑–º–∞</div>
                        <div class="item-price">–£—Ä–æ–≤–µ–Ω—å <span id="charismaLevel">1</span></div>
                    </div>
                    <div class="item-desc">–ë–æ–ª—å—à–µ –¥–æ—Ö–æ–¥ –æ—Ç —Ä–∞–±–æ—Ç—ã (+5% –∑–∞ —É—Ä–æ–≤–µ–Ω—å)</div>
                    <div class="item-desc">–°—Ç–æ–∏–º–æ—Å—Ç—å: 1 –æ—á–∫–æ</div>
                </div>
                
                <div class="item-card" onclick="upgradeSkill('intelligence')">
                    <div class="item-header">
                        <div class="item-icon"><i class="fas fa-brain"></i></div>
                        <div class="item-name">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</div>
                        <div class="item-price">–£—Ä–æ–≤–µ–Ω—å <span id="intelligenceLevel">1</span></div>
                    </div>
                    <div class="item-desc">–ë—ã—Å—Ç—Ä–µ–µ –ø–æ–ª—É—á–∞–µ—à—å –æ—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ (+10% –∑–∞ —É—Ä–æ–≤–µ–Ω—å)</div>
                    <div class="item-desc">–°—Ç–æ–∏–º–æ—Å—Ç—å: 1 –æ—á–∫–æ</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–∞–π–¥ -->
    <div class="modal" id="welcomeModal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <h2 style="margin: 0; color: white;"><i class="fas fa-hand-wave"></i> –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            </div>
            <div class="modal-body" style="padding: 25px; line-height: 1.8; color: #2c3e50;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <p style="font-size: 18px; margin-bottom: 15px;">üëã –ü—Ä–∏–≤–µ—Ç! –†–∞–¥—ã –≤–∏–¥–µ—Ç—å —Ç–µ–±—è –≤ –∏–≥—Ä–µ <strong>"–í—ã–∂–∏–≤–∏ –¥–æ –∑–∞—Ä–ø–ª–∞—Ç—ã"</strong></p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="margin-top: 0; color: #667eea;"><i class="fas fa-gamepad"></i> –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</h3>
                    <ul style="margin: 10px 0; padding-left: 25px;">
                        <li style="margin-bottom: 10px;"><strong>üíº –†–∞–±–æ—Ç–∞–π</strong> ‚Äî –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –¥–µ–Ω—å–≥–∏, –Ω–æ —Å–ª–µ–¥–∏ –∑–∞ —ç–Ω–µ—Ä–≥–∏–µ–π</li>
                        <li style="margin-bottom: 10px;"><strong>üõí –ü–æ–∫—É–ø–∞–π</strong> ‚Äî –±—É—Å—Ç–µ—Ä—ã, –º–∞—à–∏–Ω—ã –∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –ø–æ–º–æ–≥—É—Ç —Ç–µ–±–µ</li>
                        <li style="margin-bottom: 10px;"><strong>üéØ –í—ã–ø–æ–ª–Ω—è–π —Ü–µ–ª–∏</strong> ‚Äî –ø–æ–ª—É—á–∞–π –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</li>
                        <li style="margin-bottom: 10px;"><strong>üìÖ –î–æ–∂–∏–≤–∏ –¥–æ –∑–∞—Ä–ø–ª–∞—Ç—ã</strong> ‚Äî 30 –¥–Ω–µ–π –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ–Ω–µ–≥</li>
                        <li style="margin-bottom: 10px;"><strong>üé≤ –†–∏—Å–∫—É–π</strong> ‚Äî —Ä—É–ª–µ—Ç–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–µ—Å—Ç–∏ —É–¥–∞—á—É</li>
                    </ul>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 12px; border-left: 4px solid #ffc107; margin-bottom: 20px;">
                    <p style="margin: 0;"><i class="fas fa-lightbulb"></i> <strong>–°–æ–≤–µ—Ç:</strong> –°–ª–µ–¥–∏ –∑–∞ –∑–¥–æ—Ä–æ–≤—å–µ–º –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º ‚Äî –æ–Ω–∏ –≤–ª–∏—è—é—Ç –Ω–∞ —Ç–≤–æ–π –¥–æ—Ö–æ–¥!</p>
                </div>
                
                <div style="text-align: center;">
                    <button onclick="showNameInput()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 40px; border-radius: 12px; font-size: 16px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                        <i class="fas fa-arrow-right"></i> –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –í–≤–æ–¥ –∏–º–µ–Ω–∏ -->
    <div class="modal" id="nameModal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <h2 style="margin: 0; color: white;"><i class="fas fa-user-edit"></i> –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?</h2>
            </div>
            <div class="modal-body" style="padding: 30px; text-align: center;">
                <p style="font-size: 16px; color: #555; margin-bottom: 20px;">–ü—Ä–∏–¥—É–º–∞–π –∏–º—è –¥–ª—è —Å–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</p>
                <input type="text" id="playerNameInput" placeholder="–í–≤–µ–¥–∏ –∏–º—è (2-20 —Å–∏–º–≤–æ–ª–æ–≤)" maxlength="20" style="width: 100%; padding: 15px; border: 2px solid #667eea; border-radius: 12px; font-size: 16px; text-align: center; margin-bottom: 20px; box-sizing: border-box;">
                <button onclick="setPlayerName()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 40px; border-radius: 12px; font-size: 16px; cursor: pointer; font-weight: bold; width: 100%; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                    <i class="fas fa-check"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ -->
    <div class="modal" id="leaderboardModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2><i class="fas fa-trophy"></i> –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h2>
                <button class="close-btn" onclick="closeLeaderboard()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div id="leaderboardContent" style="max-height: 500px; overflow-y: auto;">
                    <p style="text-align: center; color: #999;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="message" id="message"></div>
    
    <script>
        let userId = 'demo_user';
        let gameData = {};
        
        // –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
        try {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
                
                // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = tg.initDataUnsafe?.user;
                if (user && user.id) {
                    userId = 'tg_' + user.id.toString();
                    console.log('‚úÖ Telegram User ID:', userId);
                    console.log('‚úÖ User data:', user);
                } else {
                    console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å Telegram ID');
                    console.warn('‚ö†Ô∏è initDataUnsafe:', tg.initDataUnsafe);
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
                    userId = 'web_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                }
            } else {
                console.warn('‚ö†Ô∏è Telegram WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
                userId = 'web_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è Telegram ID:', error);
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
            userId = 'web_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        console.log('üéÆ –ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);
        
        async function loadUserData() {
            try {
                const response = await fetch('/api/user/' + userId);
                if (response.ok) {
                    gameData = await response.json();
                    updateUI();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                    if (!gameData.tutorial_completed) {
                        setTimeout(() => {
                            document.getElementById('welcomeModal').style.display = 'flex';
                        }, 300);
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–±—Ä–∞–Ω–∞ –ª–∏ —á–µ—Ä—Ç–∞ (—Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ DOM)
                    if (!gameData.trait_selected) {
                        setTimeout(function() {
                            showTraitSelection();
                        }, 100);
                    }
                }
            } catch (error) {
                console.error('Load error:', error);
            }
        }
        
        function showTraitSelection() {
            const traits = {
                '—Ç–µ—Ä–ø–∏–ª–∞': {
                    name: '–¢–µ—Ä–ø–∏–ª–∞',
                    emoji: 'üò§',
                    desc: '–í—Å–µ —à—Ç—Ä–∞—Ñ—ã ‚àí20%, –Ω–æ –¥–æ—Ö–æ–¥ –æ—Ç —Ä–∞–±–æ—Ç—ã ‚àí15%',
                    color: '#e74c3c'
                },
                '—Ä–∏—Å–∫–æ–≤—ã–π': {
                    name: '–†–∏—Å–∫–æ–≤—ã–π',
                    emoji: 'üé≤',
                    desc: '–®–∞–Ω—Å —Å–æ–±—ã—Ç–∏–π +30%, –Ω–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —á–∞—â–µ',
                    color: '#f39c12'
                },
                '—ç–∫–æ–Ω–æ–º–Ω—ã–π': {
                    name: '–≠–∫–æ–Ω–æ–º–Ω—ã–π',
                    emoji: 'üí∞',
                    desc: '–í—Å–µ –ø–æ–∫—É–ø–∫–∏ –¥–µ—à–µ–≤–ª–µ –Ω–∞ 10%, –Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≥—Ä—É—Å—Ç–Ω—ã–π',
                    color: '#27ae60'
                },
                '–ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä': {
                    name: '–ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä',
                    emoji: 'üò¥',
                    desc: '–ò–Ω–æ–≥–¥–∞ –¥–µ–Ω—å –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –¥–µ–π—Å—Ç–≤–∏–π, –Ω–æ —É—Å—Ç–∞–ª–æ—Å—Ç—å –Ω–µ —Ä–∞—Å—Ç—ë—Ç',
                    color: '#9b59b6'
                }
            };
            
            const traitsList = document.getElementById('traitsList');
            traitsList.innerHTML = '';
            
            for (const traitId in traits) {
                const trait = traits[traitId];
                const card = document.createElement('div');
                card.className = 'item-card';
                card.style.borderColor = trait.color;
                card.onclick = function() { selectTrait(traitId); };
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + trait.emoji + '</div>' +
                    '<div class="item-name">' + trait.name + '</div>' +
                    '</div>' +
                    '<div class="item-desc">' + trait.desc + '</div>';
                
                traitsList.appendChild(card);
            }
            
            document.getElementById('traitModal').style.display = 'flex';
        }
        
        async function selectTrait(traitId) {
            try {
                const response = await fetch('/api/select_trait', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, trait_id: traitId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    document.getElementById('traitModal').style.display = 'none';
                    showMessage('–ß–µ—Ä—Ç–∞ –≤—ã–±—Ä–∞–Ω–∞: ' + result.trait.name + ' ' + result.trait.emoji, true);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        async function buyFood() {
            try {
                const response = await fetch('/api/buy_food', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showMessage(result.message, true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        async function takeRest() {
            try {
                const response = await fetch('/api/take_rest', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showMessage(result.message, true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        async function randomEvent() {
            try {
                const response = await fetch('/api/random_event', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showMessage(result.message, result.event.cost >= 0);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        function showStats() {
            document.getElementById('statMoney').textContent = (gameData.money || 0).toLocaleString();
            document.getElementById('statTotalEarned').textContent = (gameData.total_earned || 0).toLocaleString();
            document.getElementById('statTotalSpent').textContent = (gameData.total_spent || 0).toLocaleString();
            document.getElementById('statDays').textContent = (gameData.day || 1) - 1;
            document.getElementById('statWorkCount').textContent = gameData.work_count || 0;
            document.getElementById('statGoals').textContent = (gameData.completed_goals || []).length;
            document.getElementById('statCars').textContent = (gameData.cars || []).length;
            document.getElementById('statProperty').textContent = (gameData.real_estate || []).length;
            document.getElementById('statCredits').textContent = (gameData.credits || []).length;
            
            document.getElementById('statsModal').style.display = 'flex';
        }
        
        function showRoulette() {
            document.getElementById('rouletteMessage').textContent = 'üé∞ –í—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É';
            document.getElementById('slot1').textContent = 'üé∞';
            document.getElementById('slot2').textContent = 'üé∞';
            document.getElementById('slot3').textContent = 'üé∞';
            document.getElementById('rouletteModal').style.display = 'flex';
        }
        
        async function playRoulette(bet, retryCount = 0) {
            try {
                // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –±–∞—Ä–∞–±–∞–Ω–æ–≤
                const slot1 = document.getElementById('slot1');
                const slot2 = document.getElementById('slot2');
                const slot3 = document.getElementById('slot3');
                const messageEl = document.getElementById('rouletteMessage');
                
                const emojis = ['üçí', 'üçã', 'üçä', 'üçá', 'üíé', '7Ô∏è‚É£', '‚≠ê', 'üîî'];
                let count = 0;
                
                messageEl.textContent = 'üé∞ –ö—Ä—É—Ç–∏–º...';
                messageEl.style.color = '#f39c12';
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –±–∞—Ä–∞–±–∞–Ω–æ–≤
                const interval = setInterval(function() {
                    slot1.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    slot2.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    slot3.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    count++;
                    if (count > 15) clearInterval(interval);
                }, 80);
                
                const response = await fetch('/api/play_roulette', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, bet: bet })
                });
                
                setTimeout(async function() {
                    if (response.ok) {
                        const result = await response.json();
                        gameData = result.user;
                        updateUI();
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        const resultEmoji = result.result_emoji;
                        slot1.textContent = resultEmoji;
                        slot2.textContent = resultEmoji;
                        slot3.textContent = resultEmoji;
                        
                        messageEl.textContent = result.message;
                        messageEl.style.color = result.multiplier > 0 ? '#27ae60' : '#e74c3c';
                        
                        showMessage(result.message, result.multiplier > 0);
                    } else {
                        const error = await response.json();
                        messageEl.textContent = error.error || '–û—à–∏–±–∫–∞!';
                        messageEl.style.color = '#e74c3c';
                        showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                    }
                }, 1400);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä—É–ª–µ—Ç–∫–∏:', error);
                
                // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
                if (retryCount < 2) {
                    document.getElementById('rouletteMessage').textContent = `üîÑ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ... ${retryCount + 1}/2`;
                    document.getElementById('rouletteMessage').style.color = '#f39c12';
                    setTimeout(() => playRoulette(bet, retryCount + 1), 2000);
                } else {
                    document.getElementById('rouletteMessage').textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!';
                    document.getElementById('rouletteMessage').style.color = '#e74c3c';
                    showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è! –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)', false);
                }
            }
        }
        
        function showSkills() {
            const skills = gameData.skills || { speed: 1, luck: 1, charisma: 1, intelligence: 1 };
            document.getElementById('skillPoints').textContent = gameData.skill_points || 0;
            document.getElementById('speedLevel').textContent = skills.speed || 1;
            document.getElementById('luckLevel').textContent = skills.luck || 1;
            document.getElementById('charismaLevel').textContent = skills.charisma || 1;
            document.getElementById('intelligenceLevel').textContent = skills.intelligence || 1;
            
            document.getElementById('skillsModal').style.display = 'flex';
        }
        
        async function upgradeSkill(skillName) {
            try {
                const response = await fetch('/api/upgrade_skill', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, skill: skillName })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showSkills();
                    showMessage(result.message, true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        function updateUI() {
            document.getElementById('day').textContent = gameData.day || 1;
            document.getElementById('month').textContent = gameData.month || 1;
            document.getElementById('money').textContent = gameData.money || 500;
            document.getElementById('topMoney').textContent = gameData.money || 500;
            
            const currentEnergy = gameData.energy || 100;
            const maxEnergy = gameData.max_energy || 100;
            document.getElementById('energyDisplay').textContent = currentEnergy + '/' + maxEnergy;
            
            const energyPercent = (currentEnergy / maxEnergy) * 100;
            document.getElementById('moneyFill').style.width = energyPercent + '%';
            
            document.getElementById('workBtn').disabled = currentEnergy <= 0;
            document.getElementById('workAllBtn').disabled = currentEnergy <= 0;
            
            // –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫–æ–Ω—á–∏—Ç—å –¥–µ–Ω—å" –≤—Å–µ–≥–¥–∞ –∞–∫—Ç–∏–≤–Ω–∞ - –∏–≥—Ä–æ–∫ —Å–∞–º —Ä–µ—à–∞–µ—Ç
            document.getElementById('nextDayBtn').disabled = false;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
            const mood = gameData.mood || 50;
            document.getElementById('moodValue').textContent = mood;
            document.getElementById('moodFill').style.width = mood + '%';
            
            let moodEmoji = 'üòê';
            let moodText = '–ù–æ—Ä–º–∞–ª—å–Ω–æ';
            if (mood <= 20) {
                moodEmoji = 'üò≠';
                moodText = '–î–µ–ø—Ä–µ—Å—Å–∏—è';
            } else if (mood <= 40) {
                moodEmoji = 'üòî';
                moodText = '–ì—Ä—É—Å—Ç–Ω–æ';
            } else if (mood <= 60) {
                moodEmoji = 'üòê';
                moodText = '–ù–æ—Ä–º–∞–ª—å–Ω–æ';
            } else if (mood <= 80) {
                moodEmoji = 'üôÇ';
                moodText = '–•–æ—Ä–æ—à–æ';
            } else {
                moodEmoji = 'üòÑ';
                moodText = '–û—Ç–ª–∏—á–Ω–æ';
            }
            document.getElementById('moodEmoji').textContent = moodEmoji;
            document.getElementById('moodText').textContent = moodText;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
            const health = gameData.health || 100;
            document.getElementById('healthValue').textContent = health;
            document.getElementById('healthFill').style.width = health + '%';
            
            let healthText = '–ó–¥–æ—Ä–æ–≤';
            if (health <= 20) {
                healthText = '–ö—Ä–∏—Ç–∏—á–Ω–æ';
            } else if (health <= 40) {
                healthText = '–ü–ª–æ—Ö–æ';
            } else if (health <= 60) {
                healthText = '–£—Å—Ç–∞–ª';
            } else if (health <= 80) {
                healthText = '–ù–æ—Ä–º–∞–ª—å–Ω–æ';
            }
            document.getElementById('healthText').textContent = healthText;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—Ç–µ
            const jobs = {
                'delivery': { name: '–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã', income: 80, energy: 5 },
                'office': { name: '–û—Ñ–∏—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞', income: 120, energy: 3 },
                'freelance': { name: '–§—Ä–∏–ª–∞–Ω—Å', income: 200, energy: 7 },
                'crypto': { name: '–ö—Ä–∏–ø—Ç–æ-—Ç—Ä–µ–π–¥–∏–Ω–≥', income: 300, energy: 10 }
            };
            
            const currentJobId = gameData.current_job || 'delivery';
            const currentJob = jobs[currentJobId];
            if (currentJob) {
                document.getElementById('currentJobName').textContent = currentJob.name;
                document.getElementById('jobIncome').textContent = currentJob.income;
                document.getElementById('jobEnergy').textContent = currentJob.energy;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä—Ç—ã
            const traitDisplay = document.getElementById('traitDisplay');
            if (gameData.trait) {
                const traits = {
                    '—Ç–µ—Ä–ø–∏–ª–∞': { emoji: 'üò§', name: '–¢–µ—Ä–ø–∏–ª–∞' },
                    '—Ä–∏—Å–∫–æ–≤—ã–π': { emoji: 'üé≤', name: '–†–∏—Å–∫–æ–≤—ã–π' },
                    '—ç–∫–æ–Ω–æ–º–Ω—ã–π': { emoji: 'üí∞', name: '–≠–∫–æ–Ω–æ–º–Ω—ã–π' },
                    '–ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä': { emoji: 'üò¥', name: '–ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä' }
                };
                const trait = traits[gameData.trait];
                if (trait) {
                    traitDisplay.textContent = trait.emoji + ' ' + trait.name;
                }
            } else {
                traitDisplay.textContent = '–û–±—ã—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å';
            }
        }
        
        function showMessage(text, isSuccess) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message' + (isSuccess ? ' success' : '');
            msg.style.display = 'block';
            setTimeout(function() { msg.style.display = 'none'; }, 3000);
        }
        
        async function work(retryCount = 0) {
            try {
                const response = await fetch('/api/work', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showMessage('+' + result.income + '‚ÇΩ', true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ:', error);
                
                // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
                if (retryCount < 2) {
                    showMessage(`üîÑ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ... ${retryCount + 1}/2`, false);
                    setTimeout(() => work(retryCount + 1), 2000);
                } else {
                    showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è! –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)', false);
                }
            }
        }
        
        async function nextDay(retryCount = 0) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            if (retryCount === 0) {
                showMessage('–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...', true);
            }
            
            try {
                const response = await fetch('/api/next_day', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å
                    if (gameData.energy === gameData.max_energy) {
                        showMessage('‚úÖ –ù–æ–≤—ã–π –¥–µ–Ω—å! –≠–Ω–µ—Ä–≥–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!', true);
                    } else {
                        showMessage(`‚ö†Ô∏è –ù–æ–≤—ã–π –¥–µ–Ω—å! –≠–Ω–µ—Ä–≥–∏—è: ${gameData.energy}/${gameData.max_energy}`, true);
                    }
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å:', error);
                
                // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ (–º–∞–∫—Å–∏–º—É–º 3 —Ä–∞–∑–∞)
                if (retryCount < 3) {
                    showMessage(`üîÑ –°–µ—Ä–≤–µ—Ä –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è... –ü–æ–ø—ã—Ç–∫–∞ ${retryCount + 1}/3`, false);
                    setTimeout(() => nextDay(retryCount + 1), 3000); // –ñ–¥—ë–º 3 —Å–µ–∫—É–Ω–¥—ã
                } else {
                    showMessage('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1 –º–∏–Ω—É—Ç—É –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)', false);
                }
            }
        }
        
        function confirmEndDay() {
            const currentEnergy = gameData.energy || 0;
            
            if (currentEnergy > 20) {
                // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å –º–Ω–æ–≥–æ —ç–Ω–µ—Ä–≥–∏–∏
                if (confirm('–£ —Ç–µ–±—è –æ—Å—Ç–∞–ª–æ—Å—å ' + currentEnergy + ' —ç–Ω–µ—Ä–≥–∏–∏! –£–≤–µ—Ä–µ–Ω —á—Ç–æ —Ö–æ—á–µ—à—å –∑–∞–∫–æ–Ω—á–∏—Ç—å –¥–µ–Ω—å? –ú–æ–∂–Ω–æ –µ—â–µ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å!')) {
                    nextDay();
                }
            } else if (currentEnergy > 0) {
                // –ù–µ–±–æ–ª—å—à–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                if (confirm('–û—Å—Ç–∞–ª–æ—Å—å ' + currentEnergy + ' —ç–Ω–µ—Ä–≥–∏–∏. –ó–∞–∫–æ–Ω—á–∏—Ç—å –¥–µ–Ω—å?')) {
                    nextDay();
                }
            } else {
                // –≠–Ω–µ—Ä–≥–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å - —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏–º
                nextDay();
            }
        }
        
        async function workUntilExhausted() {
            const startEnergy = gameData.energy || 0;
            
            if (startEnergy <= 0) {
                showMessage('–≠–Ω–µ—Ä–≥–∏—è —É–∂–µ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å!', false);
                return;
            }
            
            showMessage('–†–∞–±–æ—Ç–∞—é –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è... ‚ö°', true);
            
            let totalIncome = 0;
            let workCount = 0;
            let consecutiveErrors = 0;
            const maxErrors = 3;
            
            // –†–∞–±–æ—Ç–∞–µ–º –ø–æ–∫–∞ –µ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏—è
            while (gameData.energy > 0 && consecutiveErrors < maxErrors) {
                try {
                    const response = await fetch('/api/work', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ user_id: userId })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        gameData = result.user;
                        totalIncome += result.income;
                        workCount++;
                        consecutiveErrors = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
                        updateUI();
                        
                        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
                        await new Promise(resolve => setTimeout(resolve, 300));
                    } else {
                        const error = await response.json();
                        // –ï—Å–ª–∏ –Ω–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –≤—ã—Ö–æ–¥–∏–º
                        if (error.error && error.error.includes('—ç–Ω–µ—Ä–≥–∏–∏')) {
                            break;
                        }
                        consecutiveErrors++;
                        if (consecutiveErrors >= maxErrors) {
                            showMessage('–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞', false);
                            break;
                        }
                        // –ñ–¥—ë–º –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ:', error);
                    consecutiveErrors++;
                    if (consecutiveErrors >= maxErrors) {
                        showMessage('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è! –û—Å—Ç–∞–Ω–æ–≤–∫–∞', false);
                        break;
                    }
                    // –ñ–¥—ë–º –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            if (workCount > 0) {
                showMessage(`–û—Ç—Ä–∞–±–æ—Ç–∞–ª –≤–µ—Å—å –¥–µ–Ω—å! üí™ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: +${totalIncome}‚ÇΩ (${workCount} —Ä–∞–∑)`, true);
            } else {
                showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å', false);
            }
        }
        
        function showJobs() {
            const jobsList = document.getElementById('jobsList');
            jobsList.innerHTML = '';
            
            const jobs = {
                'delivery': { name: '–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã', emoji: 'üõµ', income: 80, energy: 5, unlock_day: 1 },
                'office': { name: '–û—Ñ–∏—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞', emoji: 'üíª', income: 120, energy: 3, unlock_day: 5 },
                'freelance': { name: '–§—Ä–∏–ª–∞–Ω—Å', emoji: 'üé®', income: 200, energy: 7, unlock_day: 10 },
                'crypto': { name: '–ö—Ä–∏–ø—Ç–æ-—Ç—Ä–µ–π–¥–∏–Ω–≥', emoji: 'üìà', income: 300, energy: 10, unlock_day: 15 }
            };
            
            for (const jobId in jobs) {
                const job = jobs[jobId];
                const isUnlocked = (gameData.day || 1) >= job.unlock_day;
                const isCurrent = (gameData.current_job || 'delivery') === jobId;
                
                const card = document.createElement('div');
                card.className = 'item-card' + (!isUnlocked ? ' locked' : '') + (isCurrent ? ' owned' : '');
                if (isUnlocked && !isCurrent) {
                    card.onclick = function() { changeJob(jobId); };
                }
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + job.emoji + '</div>' +
                    '<div class="item-name">' + job.name + '</div>' +
                    '<div class="item-price">+' + job.income + '‚ÇΩ</div>' +
                    '</div>' +
                    '<div class="item-desc">–≠–Ω–µ—Ä–≥–∏—è: -' + job.energy + '</div>' +
                    '<div class="item-desc">' + (isUnlocked ? (isCurrent ? '‚úÖ –¢–µ–∫—É—â–∞—è' : '–î–æ—Å—Ç—É–ø–Ω–æ') : 'üîí –î–µ–Ω—å ' + job.unlock_day) + '</div>';
                
                jobsList.appendChild(card);
            }
            
            document.getElementById('jobsModal').style.display = 'flex';
        }
        
        async function changeJob(jobId) {
            try {
                const response = await fetch('/api/change_job', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, job_id: jobId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    document.getElementById('jobsModal').style.display = 'none';
                    showMessage('–†–∞–±–æ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞!', true);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        function showShop() {
            showShopTab('boosters');
            document.getElementById('shopModal').style.display = 'flex';
        }
        
        let currentShopTab = 'boosters';
        
        function showShopTab(tab) {
            currentShopTab = tab;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–±
            const tabs = document.querySelectorAll('.shop-tab');
            tabs.forEach(function(t, index) {
                t.classList.remove('active');
                if ((tab === 'boosters' && index === 0) ||
                    (tab === 'cars' && index === 1) ||
                    (tab === 'realestate' && index === 2)) {
                    t.classList.add('active');
                }
            });
            
            const shopList = document.getElementById('shopList');
            shopList.innerHTML = '';
            
            if (tab === 'boosters') {
                showBoosters(shopList);
            } else if (tab === 'cars') {
                showCars(shopList);
            } else if (tab === 'realestate') {
                showRealEstate(shopList);
            }
        }
        
        function showBoosters(container) {
            const items = {
                'coffee': { name: '–ö–æ—Ñ–µ', emoji: '‚òï', price: 150, desc: '+30 —ç–Ω–µ—Ä–≥–∏–∏' },
                'energy_drink': { name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', emoji: 'ü•§', price: 300, desc: '+50 —ç–Ω–µ—Ä–≥–∏–∏' },
                'laptop': { name: '–ù–æ—É—Ç–±—É–∫', emoji: 'üíª', price: 2000, desc: '–û—Ñ–∏—Å +50%' },
                'scooter': { name: '–°–∞–º–æ–∫–∞—Ç', emoji: 'üõ¥', price: 1500, desc: '–î–æ—Å—Ç–∞–≤–∫–∞ -20%' }
            };
            
            for (const itemId in items) {
                const item = items[itemId];
                const canAfford = (gameData.money || 500) >= item.price;
                const isOwned = (gameData.owned_items || []).includes(itemId);
                
                const card = document.createElement('div');
                card.className = 'item-card' + (!canAfford ? ' locked' : '') + (isOwned ? ' owned' : '');
                if (canAfford && !isOwned) {
                    card.onclick = function() { buyItem(itemId); };
                }
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + item.emoji + '</div>' +
                    '<div class="item-name">' + item.name + '</div>' +
                    '<div class="item-price">' + item.price + '‚ÇΩ</div>' +
                    '</div>' +
                    '<div class="item-desc">' + item.desc + '</div>' +
                    '<div class="item-desc">' + (isOwned ? '‚úÖ –ö—É–ø–ª–µ–Ω–æ' : (canAfford ? '–î–æ—Å—Ç—É–ø–Ω–æ' : 'üîí –ú–∞–ª–æ –¥–µ–Ω–µ–≥')) + '</div>';
                
                container.appendChild(card);
            }
        }
        
        function showCars(container) {
            const cars = {
                'old_car': { name: '–°—Ç–∞—Ä–∞—è –º–∞—à–∏–Ω–∞', emoji: 'üöó', price: 150000, desc: '–î–æ—Å—Ç–∞–≤–∫–∞ +10%', monthly: 8000 },
                'new_car': { name: '–ù–æ–≤–∞—è –º–∞—à–∏–Ω–∞', emoji: 'üöô', price: 800000, desc: '–î–æ—Å—Ç–∞–≤–∫–∞ +20%', monthly: 15000 },
                'luxury_car': { name: '–ü—Ä–µ–º–∏—É–º –∞–≤—Ç–æ', emoji: 'üèéÔ∏è', price: 2500000, desc: '–î–æ—Å—Ç–∞–≤–∫–∞ +30%', monthly: 35000 }
            };
            
            for (const carId in cars) {
                const car = cars[carId];
                const canAfford = (gameData.money || 500) >= car.price;
                const isOwned = (gameData.cars || []).includes(carId);
                
                const card = document.createElement('div');
                card.className = 'item-card' + (!canAfford ? ' locked' : '') + (isOwned ? ' owned' : '');
                if (canAfford && !isOwned) {
                    card.onclick = function() { buyCar(carId); };
                }
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + car.emoji + '</div>' +
                    '<div class="item-name">' + car.name + '</div>' +
                    '<div class="item-price">' + car.price.toLocaleString() + '‚ÇΩ</div>' +
                    '</div>' +
                    '<div class="item-desc">' + car.desc + '</div>' +
                    '<div class="item-desc">–†–∞—Å—Ö–æ–¥—ã: ' + car.monthly.toLocaleString() + '‚ÇΩ/–º–µ—Å</div>' +
                    '<div class="item-desc">' + (isOwned ? '‚úÖ –ö—É–ø–ª–µ–Ω–æ' : (canAfford ? '–î–æ—Å—Ç—É–ø–Ω–æ' : 'üîí –ú–∞–ª–æ –¥–µ–Ω–µ–≥')) + '</div>';
                
                container.appendChild(card);
            }
        }
        
        function showRealEstate(container) {
            const properties = {
                'studio': { name: '–°—Ç—É–¥–∏—è', emoji: 'üè†', price: 3000000, desc: '–≠–∫–æ–Ω–æ–º–∏—è 5000‚ÇΩ/–º–µ—Å', income: 0 },
                'apartment': { name: '–ö–≤–∞—Ä—Ç–∏—Ä–∞', emoji: 'üè°', price: 8000000, desc: '–î–æ—Ö–æ–¥ 25000‚ÇΩ/–º–µ—Å', income: 25000 },
                'house': { name: '–î–æ–º', emoji: 'üèòÔ∏è', price: 15000000, desc: '–î–æ—Ö–æ–¥ 50000‚ÇΩ/–º–µ—Å', income: 50000 },
                'shop': { name: '–ú–∞–≥–∞–∑–∏–Ω', emoji: 'üè™', price: 5000000, desc: '–î–æ—Ö–æ–¥ 80000‚ÇΩ/–º–µ—Å', income: 80000 },
                'office': { name: '–û—Ñ–∏—Å', emoji: 'üè¢', price: 12000000, desc: '–î–æ—Ö–æ–¥ 150000‚ÇΩ/–º–µ—Å', income: 150000 },
                'warehouse': { name: '–°–∫–ª–∞–¥', emoji: 'üè≠', price: 20000000, desc: '–î–æ—Ö–æ–¥ 200000‚ÇΩ/–º–µ—Å', income: 200000 }
            };
            
            for (const propId in properties) {
                const prop = properties[propId];
                const canAfford = (gameData.money || 500) >= prop.price;
                const isOwned = (gameData.real_estate || []).includes(propId);
                
                const card = document.createElement('div');
                card.className = 'item-card' + (!canAfford ? ' locked' : '') + (isOwned ? ' owned' : '');
                if (canAfford && !isOwned) {
                    card.onclick = function() { buyRealEstate(propId); };
                }
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + prop.emoji + '</div>' +
                    '<div class="item-name">' + prop.name + '</div>' +
                    '<div class="item-price">' + prop.price.toLocaleString() + '‚ÇΩ</div>' +
                    '</div>' +
                    '<div class="item-desc">' + prop.desc + '</div>' +
                    '<div class="item-desc">' + (isOwned ? '‚úÖ –ö—É–ø–ª–µ–Ω–æ' : (canAfford ? '–î–æ—Å—Ç—É–ø–Ω–æ' : 'üîí –ú–∞–ª–æ –¥–µ–Ω–µ–≥')) + '</div>';
                
                container.appendChild(card);
            }
        }
        
        async function buyCar(carId) {
            try {
                const response = await fetch('/api/buy_car', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_id: userId, 
                        car_id: carId,
                        payment_type: 'cash'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showShopTab(currentShopTab);
                    showMessage('–ú–∞—à–∏–Ω–∞ –∫—É–ø–ª–µ–Ω–∞!', true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        async function buyRealEstate(propId) {
            try {
                const response = await fetch('/api/buy_real_estate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_id: userId, 
                        property_id: propId,
                        payment_type: 'cash'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showShopTab(currentShopTab);
                    showMessage('–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –∫—É–ø–ª–µ–Ω–∞!', true);
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        function showShop_OLD() {
            const shopList = document.getElementById('shopList');
            shopList.innerHTML = '';
            
            const items = {
                'coffee': { name: '–ö–æ—Ñ–µ', emoji: '‚òï', price: 150, desc: '+30 —ç–Ω–µ—Ä–≥–∏–∏' },
                'energy_drink': { name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', emoji: 'ü•§', price: 300, desc: '+50 —ç–Ω–µ—Ä–≥–∏–∏' },
                'laptop': { name: '–ù–æ—É—Ç–±—É–∫', emoji: 'üíª', price: 2000, desc: '–û—Ñ–∏—Å +50%' },
                'scooter': { name: '–°–∞–º–æ–∫–∞—Ç', emoji: 'üõ¥', price: 1500, desc: '–î–æ—Å—Ç–∞–≤–∫–∞ -20%' }
            };
            
            for (const itemId in items) {
                const item = items[itemId];
                const canAfford = (gameData.money || 500) >= item.price;
                const isOwned = (gameData.owned_items || []).includes(itemId);
                
                const card = document.createElement('div');
                card.className = 'item-card' + (!canAfford ? ' locked' : '') + (isOwned ? ' owned' : '');
                if (canAfford && !isOwned) {
                    card.onclick = function() { buyItem(itemId); };
                }
                
                card.innerHTML = '<div class="item-header">' +
                    '<div class="item-icon">' + item.emoji + '</div>' +
                    '<div class="item-name">' + item.name + '</div>' +
                    '<div class="item-price">' + item.price + '‚ÇΩ</div>' +
                    '</div>' +
                    '<div class="item-desc">' + item.desc + '</div>' +
                    '<div class="item-desc">' + (isOwned ? '‚úÖ –ö—É–ø–ª–µ–Ω–æ' : (canAfford ? '–î–æ—Å—Ç—É–ø–Ω–æ' : 'üîí –ú–∞–ª–æ –¥–µ–Ω–µ–≥')) + '</div>';
                
                shopList.appendChild(card);
            }
            
            document.getElementById('shopModal').style.display = 'flex';
        }
        
        async function buyItem(itemId) {
            try {
                const response = await fetch('/api/buy_booster', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, booster_id: itemId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    updateUI();
                    showShop();
                    showMessage('–ö—É–ø–ª–µ–Ω–æ!', true);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞!', false);
            }
        }
        
        async function showGoals() {
            try {
                const response = await fetch('/api/goals');
                const goals = await response.json();
                
                const goalsList = document.getElementById('goalsList');
                goalsList.innerHTML = '';
                
                for (const goalId in goals) {
                    const goal = goals[goalId];
                    const isCompleted = (gameData.completed_goals || []).includes(goalId);
                    
                    const card = document.createElement('div');
                    card.className = 'item-card' + (isCompleted ? ' owned' : '');
                    
                    card.innerHTML = '<div class="item-header">' +
                        '<div class="item-icon">' + goal.emoji + '</div>' +
                        '<div class="item-name">' + goal.name + '</div>' +
                        '<div class="item-price">' + (isCompleted ? '‚úÖ' : goal.reward_money + '‚ÇΩ') + '</div>' +
                        '</div>' +
                        '<div class="item-desc">' + goal.description + '</div>';
                    
                    goalsList.appendChild(card);
                }
                
                document.getElementById('goalsModal').style.display = 'flex';
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏!', false);
            }
        }
        
        // ============================================
        // –ü–†–ò–í–ï–¢–°–¢–í–ò–ï –ò –ò–ú–Ø –ò–ì–†–û–ö–ê
        // ============================================
        
        function showNameInput() {
            document.getElementById('welcomeModal').style.display = 'none';
            document.getElementById('nameModal').style.display = 'flex';
            document.getElementById('playerNameInput').focus();
        }
        
        async function setPlayerName() {
            const nameInput = document.getElementById('playerNameInput');
            const playerName = nameInput.value.trim();
            
            if (!playerName || playerName.length < 2) {
                showMessage('–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞!', false);
                return;
            }
            
            if (playerName.length > 20) {
                showMessage('–ò–º—è —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å 20 —Å–∏–º–≤–æ–ª–æ–≤)!', false);
                return;
            }
            
            try {
                const response = await fetch('/api/set_name', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, player_name: playerName })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    gameData.player_name = playerName;
                    gameData.name_set = true;
                    
                    document.getElementById('nameModal').style.display = 'none';
                    showMessage(data.message, true);
                    
                    // –û—Ç–º–µ—á–∞–µ–º –≥–∞–π–¥ –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π
                    await fetch('/api/complete_tutorial', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ user_id: userId })
                    });
                    
                    gameData.tutorial_completed = true;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —á–µ—Ä—Ç—ã
                    if (!gameData.trait_selected) {
                        setTimeout(() => showTraitSelection(), 500);
                    }
                } else {
                    const error = await response.json();
                    showMessage(error.error || '–û—à–∏–±–∫–∞!', false);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏!', false);
            }
        }
        
        // Enter –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–º–µ–Ω–∏
        document.addEventListener('DOMContentLoaded', () => {
            const nameInput = document.getElementById('playerNameInput');
            if (nameInput) {
                nameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        setPlayerName();
                    }
                });
            }
        });
        
        // ============================================
        // –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í
        // ============================================
        
        async function showLeaderboard() {
            document.getElementById('leaderboardModal').style.display = 'flex';
            document.getElementById('leaderboardContent').innerHTML = '<p style="text-align: center; color: #999;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
            
            try {
                const response = await fetch('/api/leaderboard');
                if (response.ok) {
                    const players = await response.json();
                    
                    if (players.length === 0) {
                        document.getElementById('leaderboardContent').innerHTML = '<p style="text-align: center; color: #999;">–ü–æ–∫–∞ –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü–µ</p>';
                        return;
                    }
                    
                    let html = '<div style="overflow-x: auto;">';
                    html += '<table style="width: 100%; border-collapse: collapse;">';
                    html += '<thead><tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">';
                    html += '<th style="padding: 12px; text-align: center;">#</th>';
                    html += '<th style="padding: 12px; text-align: left;">–ò–≥—Ä–æ–∫</th>';
                    html += '<th style="padding: 12px; text-align: center;">–ú–µ—Å—è—Ü</th>';
                    html += '<th style="padding: 12px; text-align: right;">–î–µ–Ω—å–≥–∏</th>';
                    html += '<th style="padding: 12px; text-align: center;">–¶–µ–ª–∏</th>';
                    html += '</tr></thead><tbody>';
                    
                    players.forEach((player, index) => {
                        const rank = index + 1;
                        let medal = '';
                        let bgColor = '';
                        
                        if (rank === 1) {
                            medal = 'ü•á';
                            bgColor = 'background: #fff9e6;';
                        } else if (rank === 2) {
                            medal = 'ü•à';
                            bgColor = 'background: #f5f5f5;';
                        } else if (rank === 3) {
                            medal = 'ü•â';
                            bgColor = 'background: #fff5f0;';
                        }
                        
                        html += `<tr style="${bgColor} border-bottom: 1px solid #eee;">`;
                        html += `<td style="padding: 12px; text-align: center; font-weight: bold;">${medal} ${rank}</td>`;
                        html += `<td style="padding: 12px; text-align: left; font-weight: bold;">${player.player_name}</td>`;
                        html += `<td style="padding: 12px; text-align: center;">${player.month}</td>`;
                        html += `<td style="padding: 12px; text-align: right; color: #27ae60; font-weight: bold;">${player.money.toLocaleString()}‚ÇΩ</td>`;
                        html += `<td style="padding: 12px; text-align: center;">${player.total_goals}</td>`;
                        html += '</tr>';
                    });
                    
                    html += '</tbody></table></div>';
                    document.getElementById('leaderboardContent').innerHTML = html;
                } else {
                    document.getElementById('leaderboardContent').innerHTML = '<p style="text-align: center; color: #e74c3c;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
                }
            } catch (error) {
                document.getElementById('leaderboardContent').innerHTML = '<p style="text-align: center; color: #e74c3c;">–û—à–∏–±–∫–∞ —Å–µ—Ç–∏</p>';
            }
        }
        
        function closeLeaderboard() {
            document.getElementById('leaderboardModal').style.display = 'none';
        }
        
        loadUserData();
    </script>
</body>
</html>
