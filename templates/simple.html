<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–í—ã–∂–∏–≤–∏ –¥–æ –∑–∞—Ä–ø–ª–∞—Ç—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .game-area {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .character {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .work-btn {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            border-radius: 10px;
            margin: 10px 0;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .work-btn:active {
            transform: scale(0.95);
        }
        
        .work-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .energy-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ed573, #7bed9f);
            transition: width 0.3s;
        }
        
        .next-day-btn {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            background: linear-gradient(135deg, #3742fa, #2f3542);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        
        .message {
            background: rgba(255, 107, 53, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
        }
        
        .trait-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #ff6b35;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .trait-card:active {
            transform: scale(0.95);
            background: rgba(255, 107, 53, 0.2);
        }
        
        .trait-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .trait-emoji {
            font-size: 30px;
            margin-right: 10px;
        }
        
        .trait-name {
            font-size: 18px;
            font-weight: bold;
        }
        
        .trait-desc {
            font-size: 14px;
            color: #bdc3c7;
        }
        
        .menu-btn {
            flex: 1;
            padding: 10px;
            font-size: 14px;
            font-weight: bold;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .menu-btn:active {
            transform: scale(0.95);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #2c3e50;
            border-radius: 15px;
            max-width: 350px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 15px 15px 0 0;
            color: white;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }
        
        .item-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #34495e;
            border-radius: 10px;
            padding: 15px;
            margin: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .item-card:active {
            transform: scale(0.95);
            background: rgba(255, 107, 53, 0.2);
            border-color: #ff6b35;
        }
        
        .item-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .item-card.owned {
            background: rgba(46, 213, 115, 0.2);
            border-color: #2ed573;
        }
        
        .item-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .item-emoji {
            font-size: 24px;
            margin-right: 10px;
        }
        
        .item-name {
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            flex: 1;
        }
        
        .item-price {
            font-size: 14px;
            font-weight: bold;
            color: #ff6b35;
        }
        
        .item-desc {
            font-size: 12px;
            color: #bdc3c7;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="loading" id="loading">
            üéÆ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...
        </div>
        
        <div id="gameContent" style="display: none;">
            <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —á–µ—Ä—Ç—ã -->
            <div id="traitSelection" style="display: none;">
                <div class="header">
                    <div class="title">–í—ã–±–µ—Ä–∏ —á–µ—Ä—Ç—É –ª–∏—á–Ω–æ—Å—Ç–∏</div>
                    <div style="font-size: 14px;">–í–ª–∏—è–µ—Ç –Ω–∞ –≤—Å—é –∏–≥—Ä—É!</div>
                </div>
                
                <div id="traitsList"></div>
            </div>
            
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞ -->
            <div id="mainGame">
                <div class="header">
                    <div class="title">–í—ã–∂–∏–≤–∏ –¥–æ –∑–∞—Ä–ø–ª–∞—Ç—ã</div>
                    <div class="stats">
                        <div>–î–µ–Ω—å: <span id="day">1</span>/30</div>
                        <div>üí∞ <span id="money">500</span>‚ÇΩ</div>
                        <div id="traitDisplay" style="display: none;">
                            <span id="traitEmoji"></span> <span id="traitName"></span>
                        </div>
                    </div>
                </div>
            
            <div class="game-area">
                <div class="character" id="character">‚òï</div>
                
                <!-- –¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—Ç–∞ -->
                <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                    <div style="font-size: 14px; color: #bdc3c7;">–¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—Ç–∞:</div>
                    <div style="font-size: 16px; font-weight: bold;">
                        <span id="currentJobEmoji">üõµ</span> <span id="currentJobName">–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã</span>
                    </div>
                </div>
                
                <button class="work-btn" id="workBtn">–†–ê–ë–û–¢–ê–¢–¨! üíº</button>
                <div>–≠–Ω–µ—Ä–≥–∏—è: <span id="energy">100</span>/100</div>
                <div class="energy-bar">
                    <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                </div>
            </div>
            
            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                <button class="menu-btn" id="jobsBtn">–†–∞–±–æ—Ç—ã üíº</button>
                <button class="menu-btn" id="shopBtn">–ú–∞–≥–∞–∑–∏–Ω üõí</button>
            </div>
            
            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                <button class="menu-btn" id="carsBtn">–ú–∞—à–∏–Ω—ã üöó</button>
                <button class="menu-btn" id="realEstateBtn">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å üè†</button>
            </div>
            
            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                <button class="menu-btn" id="goalsBtn">–¶–µ–ª–∏ üéØ</button>
                <button class="menu-btn" id="statsBtn">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ üìä</button>
            </div>
            
            <button class="next-day-btn" id="nextDayBtn">–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å üåÖ</button>
            
            <div class="message" id="message"></div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
        <div class="modal" id="jobsModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <div style="font-size: 18px; font-weight: bold;">–í—ã–±–µ—Ä–∏ —Ä–∞–±–æ—Ç—É</div>
                    <button class="close-btn" id="closeJobsModal">&times;</button>
                </div>
                <div id="jobsList"></div>
            </div>
        </div>
        
        <div class="modal" id="shopModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <div style="font-size: 18px; font-weight: bold;">–ú–∞–≥–∞–∑–∏–Ω</div>
                    <button class="close-btn" id="closeShopModal">&times;</button>
                </div>
                <div id="shopList"></div>
            </div>
        </div>
        
        <div class="modal" id="carsModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <div style="font-size: 18px; font-weight: bold;">–ê–≤—Ç–æ—Å–∞–ª–æ–Ω</div>
                    <button class="close-btn" id="closeCarsModal">&times;</button>
                </div>
                <div id="carsList"></div>
            </div>
        </div>
        
        <div class="modal" id="realEstateModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <div style="font-size: 18px; font-weight: bold;">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</div>
                    <button class="close-btn" id="closeRealEstateModal">&times;</button>
                </div>
                <div id="realEstateList"></div>
            </div>
        </div>
        
        <div class="modal" id="buyModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <div style="font-size: 18px; font-weight: bold;" id="buyModalTitle">–ü–æ–∫—É–ø–∫–∞</div>
                    <button class="close-btn" id="closeBuyModal">&times;</button>
                </div>
                <div style="padding: 20px;">
                    <div id="buyItemInfo"></div>
                    <div style="margin: 20px 0;">
                        <button class="work-btn" id="buyCashBtn" style="margin-bottom: 10px;">–ö—É–ø–∏—Ç—å –∑–∞ –Ω–∞–ª–∏—á–Ω—ã–µ üí∞</button>
                        <button class="work-btn" id="buyCreditBtn" style="background: linear-gradient(135deg, #3742fa, #2f3542);">–ö—É–ø–∏—Ç—å –≤ –∫—Ä–µ–¥–∏—Ç üè¶</button>
                    </div>
                    <div id="creditInfo" style="display: none; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px;">–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å:</label>
                            <input type="number" id="downPayment" style="width: 100%; padding: 8px; border-radius: 5px; border: none; background: rgba(255,255,255,0.2); color: white;">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px;">–°—Ä–æ–∫ (–º–µ—Å—è—Ü–µ–≤):</label>
                            <input type="number" id="termMonths" value="24" min="12" max="60" style="width: 100%; padding: 8px; border-radius: 5px; border: none; background: rgba(255,255,255,0.2); color: white;">
                        </div>
                        <div id="creditCalculation" style="font-size: 14px; color: #f39c12;"></div>
                        <button class="work-btn" id="confirmCreditBtn" style="margin-top: 15px;">–û—Ñ–æ—Ä–º–∏—Ç—å –∫—Ä–µ–¥–∏—Ç</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal" id="goalsModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <div style="font-size: 18px; font-weight: bold;">–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ü–µ–ª–∏</div>
                    <button class="close-btn" id="closeGoalsModal">&times;</button>
                </div>
                <div id="goalsList"></div>
            </div>
        </div>
        
        <div class="modal" id="statsModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <div style="font-size: 18px; font-weight: bold;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                    <button class="close-btn" id="closeStatsModal">&times;</button>
                </div>
                <div id="statsContent" style="padding: 20px;"></div>
            </div>
        </div>
    </div>

    <script>
        let userId = 'demo_user';
        let gameData = {};
        let traits = {};
        
        // –ß–µ—Ä—Ç—ã –ª–∏—á–Ω–æ—Å—Ç–∏
        const TRAITS = {
            "—Ç–µ—Ä–ø–∏–ª–∞": {
                "name": "–¢–µ—Ä–ø–∏–ª–∞",
                "description": "–í—Å–µ —à—Ç—Ä–∞—Ñ—ã ‚àí20%, –Ω–æ –¥–æ—Ö–æ–¥ –æ—Ç —Ä–∞–±–æ—Ç—ã ‚àí15%",
                "emoji": "üò§"
            },
            "—Ä–∏—Å–∫–æ–≤—ã–π": {
                "name": "–†–∏—Å–∫–æ–≤—ã–π", 
                "description": "–®–∞–Ω—Å —Å–æ–±—ã—Ç–∏–π +30%, –Ω–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —á–∞—â–µ",
                "emoji": "üé≤"
            },
            "—ç–∫–æ–Ω–æ–º–Ω—ã–π": {
                "name": "–≠–∫–æ–Ω–æ–º–Ω—ã–π",
                "description": "–í—Å–µ –ø–æ–∫—É–ø–∫–∏ –¥–µ—à–µ–≤–ª–µ –Ω–∞ 10%, –Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≥—Ä—É—Å—Ç–Ω—ã–π",
                "emoji": "üí∞"
            },
            "–ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä": {
                "name": "–ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä", 
                "description": "–ò–Ω–æ–≥–¥–∞ –¥–µ–Ω—å –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –¥–µ–π—Å—Ç–≤–∏–π, –Ω–æ —É—Å—Ç–∞–ª–æ—Å—Ç—å –Ω–µ —Ä–∞—Å—Ç—ë—Ç",
                "emoji": "üò¥"
            }
        };
        
        // –†–∞–±–æ—Ç—ã
        const JOBS = {
            "delivery": {
                "name": "–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã",
                "emoji": "üõµ",
                "income": 80,
                "energy": 15,
                "unlock_day": 1,
                "description": "–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–Ω—å–≥–∏, –Ω–æ —É—Å—Ç–∞—ë—à—å"
            },
            "office": {
                "name": "–û—Ñ–∏—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞", 
                "emoji": "üíª",
                "income": 120,
                "energy": 10,
                "unlock_day": 5,
                "description": "–°—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥"
            },
            "freelance": {
                "name": "–§—Ä–∏–ª–∞–Ω—Å",
                "emoji": "üé®", 
                "income": 200,
                "energy": 20,
                "unlock_day": 10,
                "description": "–í—ã—Å–æ–∫–∏–π –¥–æ—Ö–æ–¥, –Ω–æ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ"
            },
            "crypto": {
                "name": "–ö—Ä–∏–ø—Ç–æ-—Ç—Ä–µ–π–¥–∏–Ω–≥",
                "emoji": "üìà",
                "income": 300,
                "energy": 25,
                "unlock_day": 15,
                "description": "–†–∏—Å–∫–æ–≤–∞–Ω–Ω–æ, –Ω–æ –ø—Ä–∏–±—ã–ª—å–Ω–æ"
            }
        };
        
        // –¢–æ–≤–∞—Ä—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ
        const SHOP_ITEMS = {
            "coffee": {
                "name": "–ö–æ—Ñ–µ",
                "emoji": "‚òï",
                "price": 150,
                "description": "+30 —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ –¥–µ–Ω—å"
            },
            "energy_drink": {
                "name": "–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫",
                "emoji": "ü•§",
                "price": 300,
                "description": "+50 —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ –¥–µ–Ω—å"
            },
            "laptop": {
                "name": "–ù–æ–≤—ã–π –Ω–æ—É—Ç–±—É–∫",
                "emoji": "üíª",
                "price": 2000,
                "description": "–î–æ—Ö–æ–¥ –æ—Ç –æ—Ñ–∏—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã +50%"
            },
            "scooter": {
                "name": "–≠–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç",
                "emoji": "üõ¥",
                "price": 1500,
                "description": "–î–æ—Å—Ç–∞–≤–∫–∞ —Ç—Ä–∞—Ç–∏—Ç –º–µ–Ω—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏"
            }
        };
        
        // –ú–∞—à–∏–Ω—ã
        const CARS = {
            "old_car": {
                "name": "–°—Ç–∞—Ä–∞—è –º–∞—à–∏–Ω–∞",
                "emoji": "üöó",
                "price": 150000,
                "monthly_cost": 8000,
                "income_bonus": 0.1,
                "description": "–î–µ—à–µ–≤–∞—è, –Ω–æ –Ω–∞–¥–µ–∂–Ω–∞—è. +10% –∫ –¥–æ—Ö–æ–¥—É –æ—Ç –¥–æ—Å—Ç–∞–≤–∫–∏"
            },
            "new_car": {
                "name": "–ù–æ–≤–∞—è –º–∞—à–∏–Ω–∞",
                "emoji": "üöô",
                "price": 800000,
                "monthly_cost": 15000,
                "income_bonus": 0.2,
                "description": "–ö–æ–º—Ñ–æ—Ä—Ç –∏ —Å—Ç–∞—Ç—É—Å. +20% –∫ –¥–æ—Ö–æ–¥—É –æ—Ç –¥–æ—Å—Ç–∞–≤–∫–∏"
            },
            "luxury_car": {
                "name": "–ü—Ä–µ–º–∏—É–º –∞–≤—Ç–æ",
                "emoji": "üèéÔ∏è",
                "price": 2500000,
                "monthly_cost": 35000,
                "income_bonus": 0.3,
                "description": "–î–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –ª—é–¥–µ–π. +30% –∫ –¥–æ—Ö–æ–¥—É –æ—Ç –¥–æ—Å—Ç–∞–≤–∫–∏"
            }
        };
        
        // –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
        const REAL_ESTATE = {
            "studio": {
                "name": "–°—Ç—É–¥–∏—è",
                "emoji": "üè†",
                "price": 3000000,
                "monthly_income": 0,
                "monthly_cost": -5000,
                "description": "–°–≤–æ—è –∫—Ä—ã—à–∞ –Ω–∞–¥ –≥–æ–ª–æ–≤–æ–π. –≠–∫–æ–Ω–æ–º–∏—è 5000‚ÇΩ/–º–µ—Å"
            },
            "apartment": {
                "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞",
                "emoji": "üè°",
                "price": 8000000,
                "monthly_income": 25000,
                "monthly_cost": -8000,
                "description": "–ú–æ–∂–Ω–æ —Å–¥–∞–≤–∞—Ç—å –≤ –∞—Ä–µ–Ω–¥—É. +25000‚ÇΩ/–º–µ—Å"
            },
            "shop": {
                "name": "–ú–∞–≥–∞–∑–∏–Ω",
                "emoji": "üè™",
                "price": 5000000,
                "monthly_income": 80000,
                "monthly_cost": 20000,
                "description": "–°—Ç–∞–±–∏–ª—å–Ω—ã–π –±–∏–∑–Ω–µ—Å. +60000‚ÇΩ/–º–µ—Å —á–∏—Å—Ç—ã–º–∏"
            },
            "office": {
                "name": "–û—Ñ–∏—Å",
                "emoji": "üè¢",
                "price": 12000000,
                "monthly_income": 150000,
                "monthly_cost": 40000,
                "description": "–°–¥–∞—á–∞ –æ—Ñ–∏—Å–Ω—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏–π. +110000‚ÇΩ/–º–µ—Å —á–∏—Å—Ç—ã–º–∏"
            }
        };
        
        let currentBuyItem = null;
        let currentBuyType = null;
        let goals = {};
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        try {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
                
                const user = tg.initDataUnsafe?.user;
                if (user && user.id) {
                    userId = user.id.toString();
                }
            }
        } catch (error) {
            console.log('Telegram WebApp error:', error);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, duration = 3000) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, duration);
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        function updateUI() {
            document.getElementById('day').textContent = gameData.day || 1;
            document.getElementById('money').textContent = gameData.money || 500;
            document.getElementById('energy').textContent = gameData.energy || 100;
            
            const energyPercent = ((gameData.energy || 100) / (gameData.max_energy || 100)) * 100;
            document.getElementById('energyFill').style.width = energyPercent + '%';
            
            const workBtn = document.getElementById('workBtn');
            workBtn.disabled = (gameData.energy || 100) <= 0;
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —á–µ—Ä—Ç—É
            if (gameData.trait && TRAITS[gameData.trait]) {
                const traitDisplay = document.getElementById('traitDisplay');
                const traitEmoji = document.getElementById('traitEmoji');
                const traitName = document.getElementById('traitName');
                
                traitEmoji.textContent = TRAITS[gameData.trait].emoji;
                traitName.textContent = TRAITS[gameData.trait].name;
                traitDisplay.style.display = 'block';
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—Ç—ã
            if (gameData.current_job && JOBS[gameData.current_job]) {
                const currentJob = JOBS[gameData.current_job];
                document.getElementById('currentJobEmoji').textContent = currentJob.emoji;
                document.getElementById('currentJobName').textContent = currentJob.name;
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            const character = document.getElementById('character');
            if (gameData.energy < 30) {
                character.textContent = 'üò¥';
            } else if (gameData.day <= 10) {
                character.textContent = '‚òï';
            } else if (gameData.day <= 20) {
                character.textContent = 'üíª';
            } else {
                character.textContent = 'üç∫';
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–±–æ—Ç—ã
        function showJobs() {
            const jobsList = document.getElementById('jobsList');
            jobsList.innerHTML = '';
            
            Object.keys(JOBS).forEach(jobId => {
                const job = JOBS[jobId];
                const isUnlocked = gameData.day >= job.unlock_day;
                const isCurrent = gameData.current_job === jobId;
                
                const jobCard = document.createElement('div');
                jobCard.className = `item-card ${!isUnlocked ? 'locked' : ''} ${isCurrent ? 'owned' : ''}`;
                
                if (isUnlocked && !isCurrent) {
                    jobCard.onclick = () => changeJob(jobId);
                }
                
                jobCard.innerHTML = `
                    <div class="item-header">
                        <div class="item-emoji">${job.emoji}</div>
                        <div class="item-name">${job.name}</div>
                        <div class="item-price">+${job.income}‚ÇΩ</div>
                    </div>
                    <div class="item-desc">${job.description}</div>
                    <div class="item-desc">–≠–Ω–µ—Ä–≥–∏—è: -${job.energy} | ${isUnlocked ? (isCurrent ? '–¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—Ç–∞' : '–î–æ—Å—Ç—É–ø–Ω–æ') : `–û—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–∞ ${job.unlock_day} –¥–µ–Ω—å`}</div>
                `;
                
                jobsList.appendChild(jobCard);
            });
            
            document.getElementById('jobsModal').style.display = 'flex';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω
        function showShop() {
            const shopList = document.getElementById('shopList');
            shopList.innerHTML = '';
            
            Object.keys(SHOP_ITEMS).forEach(itemId => {
                const item = SHOP_ITEMS[itemId];
                const canAfford = gameData.money >= item.price;
                const isOwned = gameData.owned_items && gameData.owned_items.includes(itemId);
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫—É –¥–ª—è —á–µ—Ä—Ç—ã "–≠–∫–æ–Ω–æ–º–Ω—ã–π"
                let price = item.price;
                if (gameData.trait === '—ç–∫–æ–Ω–æ–º–Ω—ã–π') {
                    price = Math.floor(price * 0.9);
                }
                
                const itemCard = document.createElement('div');
                itemCard.className = `item-card ${!canAfford ? 'locked' : ''} ${isOwned ? 'owned' : ''}`;
                
                if (canAfford && !isOwned) {
                    itemCard.onclick = () => buyItem(itemId);
                }
                
                itemCard.innerHTML = `
                    <div class="item-header">
                        <div class="item-emoji">${item.emoji}</div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-price">${price}‚ÇΩ</div>
                    </div>
                    <div class="item-desc">${item.description}</div>
                    <div class="item-desc">${isOwned ? '–ö—É–ø–ª–µ–Ω–æ' : (canAfford ? '–î–æ—Å—Ç—É–ø–Ω–æ' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥')}</div>
                `;
                
                shopList.appendChild(itemCard);
            });
            
            document.getElementById('shopModal').style.display = 'flex';
        }
        
        // –°–º–µ–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É
        async function changeJob(jobId) {
            try {
                const response = await fetch('/api/change_job', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_id: userId,
                        job_id: jobId
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                } else {
                    // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                    gameData.current_job = jobId;
                }
                
                updateUI();
                document.getElementById('jobsModal').style.display = 'none';
                showMessage(`–†–∞–±–æ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞: ${JOBS[jobId].name}`);
                
            } catch (error) {
                console.error('Change job error:', error);
                gameData.current_job = jobId;
                updateUI();
                document.getElementById('jobsModal').style.display = 'none';
                showMessage(`–†–∞–±–æ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞: ${JOBS[jobId].name} (–æ—Ñ—Ñ–ª–∞–π–Ω)`);
            }
        }
        
        // –ö—É–ø–∏—Ç—å —Ç–æ–≤–∞—Ä
        async function buyItem(itemId) {
            const item = SHOP_ITEMS[itemId];
            let price = item.price;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫—É –¥–ª—è —á–µ—Ä—Ç—ã "–≠–∫–æ–Ω–æ–º–Ω—ã–π"
            if (gameData.trait === '—ç–∫–æ–Ω–æ–º–Ω—ã–π') {
                price = Math.floor(price * 0.9);
            }
            
            if (gameData.money < price) {
                showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
                return;
            }
            
            try {
                const response = await fetch('/api/buy_booster', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_id: userId,
                        booster_id: itemId
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                } else {
                    // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                    gameData.money -= price;
                    if (!gameData.owned_items) gameData.owned_items = [];
                    gameData.owned_items.push(itemId);
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç
                    if (itemId === 'coffee') {
                        gameData.energy = Math.min(gameData.max_energy, gameData.energy + 30);
                    } else if (itemId === 'energy_drink') {
                        gameData.energy = Math.min(gameData.max_energy, gameData.energy + 50);
                    }
                }
                
                updateUI();
                showShop(); // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω
                showMessage(`–ö—É–ø–ª–µ–Ω–æ: ${item.name} –∑–∞ ${price}‚ÇΩ`);
                
            } catch (error) {
                console.error('Buy item error:', error);
                // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                gameData.money -= price;
                if (!gameData.owned_items) gameData.owned_items = [];
                gameData.owned_items.push(itemId);
                
                if (itemId === 'coffee') {
                    gameData.energy = Math.min(gameData.max_energy, gameData.energy + 30);
                } else if (itemId === 'energy_drink') {
                    gameData.energy = Math.min(gameData.max_energy, gameData.energy + 50);
                }
                
                updateUI();
                showShop();
                showMessage(`–ö—É–ø–ª–µ–Ω–æ: ${item.name} –∑–∞ ${price}‚ÇΩ (–æ—Ñ—Ñ–ª–∞–π–Ω)`);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–∞—à–∏–Ω—ã
        function showCars() {
            const carsList = document.getElementById('carsList');
            carsList.innerHTML = '';
            
            Object.keys(CARS).forEach(carId => {
                const car = CARS[carId];
                const isOwned = gameData.cars && gameData.cars.includes(carId);
                
                const carCard = document.createElement('div');
                carCard.className = `item-card ${isOwned ? 'owned' : ''}`;
                
                if (!isOwned) {
                    carCard.onclick = () => showBuyModal(carId, 'car');
                }
                
                carCard.innerHTML = `
                    <div class="item-header">
                        <div class="item-emoji">${car.emoji}</div>
                        <div class="item-name">${car.name}</div>
                        <div class="item-price">${car.price.toLocaleString()}‚ÇΩ</div>
                    </div>
                    <div class="item-desc">${car.description}</div>
                    <div class="item-desc">${isOwned ? '–í —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏' : `–†–∞—Å—Ö–æ–¥—ã: ${car.monthly_cost}‚ÇΩ/–º–µ—Å`}</div>
                `;
                
                carsList.appendChild(carCard);
            });
            
            document.getElementById('carsModal').style.display = 'flex';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
        function showRealEstate() {
            const realEstateList = document.getElementById('realEstateList');
            realEstateList.innerHTML = '';
            
            Object.keys(REAL_ESTATE).forEach(propertyId => {
                const property = REAL_ESTATE[propertyId];
                const isOwned = gameData.real_estate && gameData.real_estate.includes(propertyId);
                const monthlyNet = property.monthly_income - Math.abs(property.monthly_cost);
                
                const propertyCard = document.createElement('div');
                propertyCard.className = `item-card ${isOwned ? 'owned' : ''}`;
                
                if (!isOwned) {
                    propertyCard.onclick = () => showBuyModal(propertyId, 'real_estate');
                }
                
                propertyCard.innerHTML = `
                    <div class="item-header">
                        <div class="item-emoji">${property.emoji}</div>
                        <div class="item-name">${property.name}</div>
                        <div class="item-price">${property.price.toLocaleString()}‚ÇΩ</div>
                    </div>
                    <div class="item-desc">${property.description}</div>
                    <div class="item-desc">${isOwned ? '–í —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏' : `–î–æ—Ö–æ–¥: ${monthlyNet > 0 ? '+' : ''}${monthlyNet}‚ÇΩ/–º–µ—Å`}</div>
                `;
                
                realEstateList.appendChild(propertyCard);
            });
            
            document.getElementById('realEstateModal').style.display = 'flex';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫—É–ø–∫–∏
        function showBuyModal(itemId, itemType) {
            currentBuyItem = itemId;
            currentBuyType = itemType;
            
            const item = itemType === 'car' ? CARS[itemId] : REAL_ESTATE[itemId];
            
            document.getElementById('buyModalTitle').textContent = 
                itemType === 'car' ? '–ü–æ–∫—É–ø–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è' : '–ü–æ–∫—É–ø–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏';
            
            document.getElementById('buyItemInfo').innerHTML = `
                <div class="item-header">
                    <div class="item-emoji">${item.emoji}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">${item.price.toLocaleString()}‚ÇΩ</div>
                </div>
                <div class="item-desc">${item.description}</div>
            `;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—Ä–µ–¥–∏—Ç–∞
            const minDown = Math.floor(item.price * 0.3); // 30% –º–∏–Ω–∏–º—É–º
            document.getElementById('downPayment').value = minDown;
            document.getElementById('downPayment').min = minDown;
            
            updateCreditCalculation();
            
            document.getElementById('creditInfo').style.display = 'none';
            document.getElementById('buyModal').style.display = 'flex';
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫—Ä–µ–¥–∏—Ç–∞
        function updateCreditCalculation() {
            if (!currentBuyItem || !currentBuyType) return;
            
            const item = currentBuyType === 'car' ? CARS[currentBuyItem] : REAL_ESTATE[currentBuyItem];
            const downPayment = parseInt(document.getElementById('downPayment').value) || 0;
            const termMonths = parseInt(document.getElementById('termMonths').value) || 24;
            
            const loanAmount = item.price - downPayment;
            const rate = currentBuyType === 'car' ? 0.12 : 0.08; // 12% –¥–ª—è –∞–≤—Ç–æ, 8% –¥–ª—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
            const monthlyRate = rate / 12;
            
            if (loanAmount <= 0) {
                document.getElementById('creditCalculation').innerHTML = '–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞: 0‚ÇΩ';
                return;
            }
            
            const monthlyPayment = Math.floor(loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, termMonths)) / (Math.pow(1 + monthlyRate, termMonths) - 1));
            const totalPayment = monthlyPayment * termMonths;
            const overpayment = totalPayment - loanAmount;
            
            document.getElementById('creditCalculation').innerHTML = `
                <div>–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞: ${loanAmount.toLocaleString()}‚ÇΩ</div>
                <div>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂: ${monthlyPayment.toLocaleString()}‚ÇΩ</div>
                <div>–ü–µ—Ä–µ–ø–ª–∞—Ç–∞: ${overpayment.toLocaleString()}‚ÇΩ</div>
                <div>–°—Ç–∞–≤–∫–∞: ${Math.round(rate * 100)}% –≥–æ–¥–æ–≤—ã—Ö</div>
            `;
        }
        
        // –ö—É–ø–∏—Ç—å –∑–∞ –Ω–∞–ª–∏—á–Ω—ã–µ
        async function buyCash() {
            if (!currentBuyItem || !currentBuyType) return;
            
            const item = currentBuyType === 'car' ? CARS[currentBuyItem] : REAL_ESTATE[currentBuyItem];
            let price = item.price;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫—É –¥–ª—è —á–µ—Ä—Ç—ã "–≠–∫–æ–Ω–æ–º–Ω—ã–π"
            if (gameData.trait === '—ç–∫–æ–Ω–æ–º–Ω—ã–π') {
                price = Math.floor(price * 0.9);
            }
            
            if (gameData.money < price) {
                showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
                return;
            }
            
            try {
                const endpoint = currentBuyType === 'car' ? '/api/buy_car' : '/api/buy_real_estate';
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_id: userId,
                        [currentBuyType === 'car' ? 'car_id' : 'property_id']: currentBuyItem,
                        payment_type: 'cash'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Ü–µ–ª–∏
                    checkNewGoals(result);
                } else {
                    // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                    gameData.money -= price;
                    if (currentBuyType === 'car') {
                        if (!gameData.cars) gameData.cars = [];
                        gameData.cars.push(currentBuyItem);
                    } else {
                        if (!gameData.real_estate) gameData.real_estate = [];
                        gameData.real_estate.push(currentBuyItem);
                    }
                }
                
                updateUI();
                document.getElementById('buyModal').style.display = 'none';
                document.getElementById('carsModal').style.display = 'none';
                document.getElementById('realEstateModal').style.display = 'none';
                
                showMessage(`–ö—É–ø–ª–µ–Ω–æ: ${item.name} –∑–∞ ${price.toLocaleString()}‚ÇΩ`);
                
            } catch (error) {
                console.error('Buy error:', error);
                // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                gameData.money -= price;
                if (currentBuyType === 'car') {
                    if (!gameData.cars) gameData.cars = [];
                    gameData.cars.push(currentBuyItem);
                } else {
                    if (!gameData.real_estate) gameData.real_estate = [];
                    gameData.real_estate.push(currentBuyItem);
                }
                
                updateUI();
                document.getElementById('buyModal').style.display = 'none';
                document.getElementById('carsModal').style.display = 'none';
                document.getElementById('realEstateModal').style.display = 'none';
                
                showMessage(`–ö—É–ø–ª–µ–Ω–æ: ${item.name} –∑–∞ ${price.toLocaleString()}‚ÇΩ (–æ—Ñ—Ñ–ª–∞–π–Ω)`);
            }
        }
        
        // –ö—É–ø–∏—Ç—å –≤ –∫—Ä–µ–¥–∏—Ç
        async function buyCredit() {
            if (!currentBuyItem || !currentBuyType) return;
            
            const item = currentBuyType === 'car' ? CARS[currentBuyItem] : REAL_ESTATE[currentBuyItem];
            const downPayment = parseInt(document.getElementById('downPayment').value) || 0;
            const termMonths = parseInt(document.getElementById('termMonths').value) || 24;
            
            if (gameData.money < downPayment) {
                showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –≤–∑–Ω–æ—Å–∞!');
                return;
            }
            
            try {
                const endpoint = currentBuyType === 'car' ? '/api/buy_car' : '/api/buy_real_estate';
                const paymentType = currentBuyType === 'car' ? 'credit' : 'mortgage';
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_id: userId,
                        [currentBuyType === 'car' ? 'car_id' : 'property_id']: currentBuyItem,
                        payment_type: paymentType,
                        down_payment: downPayment,
                        term_months: termMonths
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Ü–µ–ª–∏
                    checkNewGoals(result);
                    
                    showMessage(`–ö—É–ø–ª–µ–Ω–æ –≤ –∫—Ä–µ–¥–∏—Ç: ${item.name}\n–í–∑–Ω–æ—Å: ${downPayment.toLocaleString()}‚ÇΩ\n–ü–ª–∞—Ç–µ–∂: ${result.monthly_payment?.toLocaleString()}‚ÇΩ/–º–µ—Å`);
                } else {
                    // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
                    gameData.money -= downPayment;
                    if (currentBuyType === 'car') {
                        if (!gameData.cars) gameData.cars = [];
                        gameData.cars.push(currentBuyItem);
                    } else {
                        if (!gameData.real_estate) gameData.real_estate = [];
                        gameData.real_estate.push(currentBuyItem);
                    }
                    showMessage(`–ö—É–ø–ª–µ–Ω–æ –≤ –∫—Ä–µ–¥–∏—Ç: ${item.name} (–æ—Ñ—Ñ–ª–∞–π–Ω)`);
                }
                
                updateUI();
                document.getElementById('buyModal').style.display = 'none';
                document.getElementById('carsModal').style.display = 'none';
                document.getElementById('realEstateModal').style.display = 'none';
                
            } catch (error) {
                console.error('Buy credit error:', error);
                // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                gameData.money -= downPayment;
                if (currentBuyType === 'car') {
                    if (!gameData.cars) gameData.cars = [];
                    gameData.cars.push(currentBuyItem);
                } else {
                    if (!gameData.real_estate) gameData.real_estate = [];
                    gameData.real_estate.push(currentBuyItem);
                }
                
                updateUI();
                document.getElementById('buyModal').style.display = 'none';
                document.getElementById('carsModal').style.display = 'none';
                document.getElementById('realEstateModal').style.display = 'none';
                
                showMessage(`–ö—É–ø–ª–µ–Ω–æ –≤ –∫—Ä–µ–¥–∏—Ç: ${item.name} (–æ—Ñ—Ñ–ª–∞–π–Ω)`);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ü–µ–ª–∏
        async function showGoals() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ü–µ–ª–∏ –µ—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
            if (!goals || Object.keys(goals).length === 0) {
                try {
                    const response = await fetch('/api/goals');
                    if (response.ok) {
                        goals = await response.json();
                    }
                } catch (error) {
                    console.error('Load goals error:', error);
                }
            }
            
            const goalsList = document.getElementById('goalsList');
            goalsList.innerHTML = '';
            
            Object.keys(goals).forEach(goalId => {
                const goal = goals[goalId];
                const isCompleted = gameData.completed_goals && gameData.completed_goals.includes(goalId);
                
                const goalCard = document.createElement('div');
                goalCard.className = `item-card ${isCompleted ? 'owned' : ''}`;
                
                goalCard.innerHTML = `
                    <div class="item-header">
                        <div class="item-emoji">${goal.emoji}</div>
                        <div class="item-name">${goal.name}</div>
                        <div class="item-price">${isCompleted ? '‚úÖ' : '‚è≥'}</div>
                    </div>
                    <div class="item-desc">${goal.description}</div>
                    <div class="item-desc">${isCompleted ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ!' : goal.reward_description}</div>
                `;
                
                goalsList.appendChild(goalCard);
            });
            
            document.getElementById('goalsModal').style.display = 'flex';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function showStats() {
            const completedGoals = gameData.completed_goals ? gameData.completed_goals.length : 0;
            const totalGoals = Object.keys(goals).length;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
            let passiveIncome = 0;
            if (gameData.real_estate) {
                gameData.real_estate.forEach(propertyId => {
                    if (REAL_ESTATE[propertyId]) {
                        passiveIncome += REAL_ESTATE[propertyId].monthly_income;
                    }
                });
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
            let monthlyExpenses = 0;
            if (gameData.cars) {
                gameData.cars.forEach(carId => {
                    if (CARS[carId]) {
                        monthlyExpenses += CARS[carId].monthly_cost;
                    }
                });
            }
            if (gameData.real_estate) {
                gameData.real_estate.forEach(propertyId => {
                    if (REAL_ESTATE[propertyId]) {
                        monthlyExpenses += Math.abs(REAL_ESTATE[propertyId].monthly_cost);
                    }
                });
            }
            
            const netIncome = passiveIncome - monthlyExpenses;
            
            document.getElementById('statsContent').innerHTML = `
                <div style="margin-bottom: 15px;">
                    <h3 style="color: #ff6b35; margin-bottom: 10px;">üí∞ –§–∏–Ω–∞–Ω—Å—ã</h3>
                    <div>–¢–µ–∫—É—â–∏–µ –¥–µ–Ω—å–≥–∏: ${gameData.money?.toLocaleString() || 0}‚ÇΩ</div>
                    <div>–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥: +${passiveIncome.toLocaleString()}‚ÇΩ/–º–µ—Å</div>
                    <div>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: -${monthlyExpenses.toLocaleString()}‚ÇΩ/–º–µ—Å</div>
                    <div style="color: ${netIncome >= 0 ? '#2ed573' : '#ff4757'};">–ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥: ${netIncome >= 0 ? '+' : ''}${netIncome.toLocaleString()}‚ÇΩ/–º–µ—Å</div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <h3 style="color: #ff6b35; margin-bottom: 10px;">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                    <div>–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Ü–µ–ª–µ–π: ${completedGoals}/${totalGoals}</div>
                    <div>–ü—Ä–æ–≥—Ä–µ—Å—Å: ${Math.round((completedGoals / totalGoals) * 100)}%</div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <h3 style="color: #ff6b35; margin-bottom: 10px;">üöó –ò–º—É—â–µ—Å—Ç–≤–æ</h3>
                    <div>–ú–∞—à–∏–Ω: ${gameData.cars?.length || 0}</div>
                    <div>–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏: ${gameData.real_estate?.length || 0}</div>
                    <div>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤: ${gameData.credits?.length || 0}</div>
                </div>
                
                <div>
                    <h3 style="color: #ff6b35; margin-bottom: 10px;">üìÖ –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
                    <div>–¢–µ–∫—É—â–∏–π –¥–µ–Ω—å: ${gameData.day || 1}/30</div>
                    <div>–ß–µ—Ä—Ç–∞ –ª–∏—á–Ω–æ—Å—Ç–∏: ${gameData.trait ? TRAITS[gameData.trait]?.name : '–ù–µ –≤—ã–±—Ä–∞–Ω–∞'}</div>
                    <div>–¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—Ç–∞: ${gameData.current_job ? JOBS[gameData.current_job]?.name : '–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã'}</div>
                </div>
            `;
            
            document.getElementById('statsModal').style.display = 'flex';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ü–µ–ª–∏
        function showGoalCompleted(goal) {
            showMessage(`üéâ –¶–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞: ${goal.name}!\n${goal.reward_description}`, 5000);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ —Ü–µ–ª–∏
        function checkNewGoals(result) {
            if (result.newly_completed_goals && result.newly_completed_goals.length > 0) {
                result.newly_completed_goals.forEach(goal => {
                    setTimeout(() => {
                        showGoalCompleted(goal);
                    }, 1000);
                });
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —á–µ—Ä—Ç—ã –¥–ª—è –≤—ã–±–æ—Ä–∞
        function showTraits() {
            const traitsList = document.getElementById('traitsList');
            traitsList.innerHTML = '';
            
            Object.keys(TRAITS).forEach(traitId => {
                const trait = TRAITS[traitId];
                const traitCard = document.createElement('div');
                traitCard.className = 'trait-card';
                traitCard.onclick = () => selectTrait(traitId);
                
                traitCard.innerHTML = `
                    <div class="trait-header">
                        <div class="trait-emoji">${trait.emoji}</div>
                        <div class="trait-name">${trait.name}</div>
                    </div>
                    <div class="trait-desc">${trait.description}</div>
                `;
                
                traitsList.appendChild(traitCard);
            });
        }
        
        // –í—ã–±—Ä–∞—Ç—å —á–µ—Ä—Ç—É
        async function selectTrait(traitId) {
            try {
                const response = await fetch('/api/select_trait', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_id: userId,
                        trait_id: traitId
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                } else {
                    // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                    gameData.trait = traitId;
                    gameData.trait_selected = true;
                }
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –∏–≥—Ä—É
                document.getElementById('traitSelection').style.display = 'none';
                document.getElementById('mainGame').style.display = 'block';
                updateUI();
                
                showMessage(`–í—ã–±—Ä–∞–Ω–∞ —á–µ—Ä—Ç–∞: ${TRAITS[traitId].name}`);
                
            } catch (error) {
                console.error('Select trait error:', error);
                // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                gameData.trait = traitId;
                gameData.trait_selected = true;
                
                document.getElementById('traitSelection').style.display = 'none';
                document.getElementById('mainGame').style.display = 'block';
                updateUI();
                
                showMessage(`–í—ã–±—Ä–∞–Ω–∞ —á–µ—Ä—Ç–∞: ${TRAITS[traitId].name} (–æ—Ñ—Ñ–ª–∞–π–Ω)`);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUser() {
            try {
                const response = await fetch(`/api/user/${userId}`);
                if (response.ok) {
                    gameData = await response.json();
                } else {
                    // –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    gameData = {
                        money: 500,
                        day: 1,
                        max_days: 30,
                        energy: 100,
                        max_energy: 100,
                        trait_selected: false,
                        current_job: 'delivery',
                        unlocked_jobs: ['delivery'],
                        owned_items: [],
                        cars: [],
                        real_estate: [],
                        credits: [],
                        completed_goals: [],
                        total_goals_completed: 0
                    };
                }
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –∏–≥—Ä—É
                document.getElementById('loading').style.display = 'none';
                document.getElementById('gameContent').style.display = 'block';
                
                // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—ã–±—Ä–∞–Ω–∞ –ª–∏ —á–µ—Ä—Ç–∞
                if (!gameData.trait_selected) {
                    document.getElementById('traitSelection').style.display = 'block';
                    document.getElementById('mainGame').style.display = 'none';
                    showTraits();
                } else {
                    document.getElementById('traitSelection').style.display = 'none';
                    document.getElementById('mainGame').style.display = 'block';
                    updateUI();
                }
                
            } catch (error) {
                console.error('Load user error:', error);
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ò–≥—Ä–∞–µ–º –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ.');
                
                gameData = {
                    money: 500,
                    day: 1,
                    max_days: 30,
                    energy: 100,
                    max_energy: 100,
                    trait_selected: false,
                    current_job: 'delivery',
                    unlocked_jobs: ['delivery'],
                    owned_items: [],
                    cars: [],
                    real_estate: [],
                    credits: [],
                    completed_goals: [],
                    total_goals_completed: 0
                };
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('gameContent').style.display = 'block';
                document.getElementById('traitSelection').style.display = 'block';
                document.getElementById('mainGame').style.display = 'none';
                showTraits();
            }
        }
        
        // –†–∞–±–æ—Ç–∞—Ç—å
        async function work() {
            if (gameData.energy <= 0) {
                showMessage('–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏! –ü–µ—Ä–µ—Ö–æ–¥–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é.');
                return;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Ä–∞–±–æ—Ç—É
            const currentJob = JOBS[gameData.current_job || 'delivery'];
            if (gameData.energy < currentJob.energy) {
                showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è —ç—Ç–æ–π —Ä–∞–±–æ—Ç—ã!');
                return;
            }
            
            try {
                const response = await fetch('/api/work', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    
                    showMessage(`–ó–∞—Ä–∞–±–æ—Ç–∞–ª ${result.income || currentJob.income}‚ÇΩ!`);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Ü–µ–ª–∏
                    checkNewGoals(result);
                    
                    if (result.event) {
                        setTimeout(() => {
                            showMessage(`${result.event.emoji} ${result.event.text}: ${result.event.cost > 0 ? '+' : ''}${result.event.cost}‚ÇΩ`);
                        }, 1500);
                    }
                } else {
                    // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                    let income = currentJob.income;
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã —á–µ—Ä—Ç
                    if (gameData.trait === '—Ç–µ—Ä–ø–∏–ª–∞') {
                        income = Math.floor(income * 0.85); // -15% –¥–æ—Ö–æ–¥–∞
                    }
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å—ã –æ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤
                    if (gameData.owned_items && gameData.owned_items.includes('laptop') && gameData.current_job === 'office') {
                        income = Math.floor(income * 1.5);
                    }
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å—ã –æ—Ç –º–∞—à–∏–Ω –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏
                    if (gameData.current_job === 'delivery' && gameData.cars) {
                        let carBonus = 0;
                        gameData.cars.forEach(carId => {
                            if (CARS[carId]) {
                                carBonus += CARS[carId].income_bonus;
                            }
                        });
                        income = Math.floor(income * (1 + carBonus));
                    }
                    
                    gameData.money += income;
                    gameData.energy -= currentJob.energy;
                    showMessage(`–ó–∞—Ä–∞–±–æ—Ç–∞–ª ${income}‚ÇΩ!`);
                }
                
                updateUI();
                
            } catch (error) {
                console.error('Work error:', error);
                // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                let income = currentJob.income;
                
                if (gameData.trait === '—Ç–µ—Ä–ø–∏–ª–∞') {
                    income = Math.floor(income * 0.85);
                }
                
                if (gameData.owned_items && gameData.owned_items.includes('laptop') && gameData.current_job === 'office') {
                    income = Math.floor(income * 1.5);
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å—ã –æ—Ç –º–∞—à–∏–Ω –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏
                if (gameData.current_job === 'delivery' && gameData.cars) {
                    let carBonus = 0;
                    gameData.cars.forEach(carId => {
                        if (CARS[carId]) {
                            carBonus += CARS[carId].income_bonus;
                        }
                    });
                    income = Math.floor(income * (1 + carBonus));
                }
                
                gameData.money += income;
                gameData.energy -= currentJob.energy;
                showMessage(`–ó–∞—Ä–∞–±–æ—Ç–∞–ª ${income}‚ÇΩ! (–æ—Ñ—Ñ–ª–∞–π–Ω)`);
                updateUI();
            }
        }
        
        // –°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
        async function nextDay() {
            try {
                const response = await fetch('/api/next_day', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gameData = result.user;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Ü–µ–ª–∏
                    checkNewGoals(result);
                    
                    if (result.salary_received) {
                        showMessage(result.message, 5000);
                    } else {
                        showMessage(result.message);
                    }
                } else {
                    // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                    gameData.day++;
                    gameData.energy = gameData.max_energy;
                    const cost = Math.floor(Math.random() * 300) + 200;
                    gameData.money -= cost;
                    if (gameData.money < 0) gameData.money = 0;
                    
                    showMessage(`–ü–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ –∂–∏–∑–Ω—å: ${cost}‚ÇΩ`);
                }
                
                updateUI();
                
            } catch (error) {
                console.error('Next day error:', error);
                // –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                gameData.day++;
                gameData.energy = gameData.max_energy;
                const cost = Math.floor(Math.random() * 300) + 200;
                gameData.money -= cost;
                if (gameData.money < 0) gameData.money = 0;
                
                showMessage(`–ü–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ –∂–∏–∑–Ω—å: ${cost}‚ÇΩ (–æ—Ñ—Ñ–ª–∞–π–Ω)`);
                updateUI();
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('workBtn').addEventListener('click', work);
        document.getElementById('nextDayBtn').addEventListener('click', nextDay);
        document.getElementById('jobsBtn').addEventListener('click', showJobs);
        document.getElementById('shopBtn').addEventListener('click', showShop);
        document.getElementById('carsBtn').addEventListener('click', showCars);
        document.getElementById('realEstateBtn').addEventListener('click', showRealEstate);
        document.getElementById('goalsBtn').addEventListener('click', showGoals);
        document.getElementById('statsBtn').addEventListener('click', showStats);
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        document.getElementById('closeJobsModal').addEventListener('click', () => {
            document.getElementById('jobsModal').style.display = 'none';
        });
        
        document.getElementById('closeShopModal').addEventListener('click', () => {
            document.getElementById('shopModal').style.display = 'none';
        });
        
        document.getElementById('closeCarsModal').addEventListener('click', () => {
            document.getElementById('carsModal').style.display = 'none';
        });
        
        document.getElementById('closeRealEstateModal').addEventListener('click', () => {
            document.getElementById('realEstateModal').style.display = 'none';
        });
        
        document.getElementById('closeBuyModal').addEventListener('click', () => {
            document.getElementById('buyModal').style.display = 'none';
        });
        
        document.getElementById('closeGoalsModal').addEventListener('click', () => {
            document.getElementById('goalsModal').style.display = 'none';
        });
        
        document.getElementById('closeStatsModal').addEventListener('click', () => {
            document.getElementById('statsModal').style.display = 'none';
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–∫—É–ø–∫–∏
        document.getElementById('buyCashBtn').addEventListener('click', buyCash);
        
        document.getElementById('buyCreditBtn').addEventListener('click', () => {
            document.getElementById('creditInfo').style.display = 'block';
        });
        
        document.getElementById('confirmCreditBtn').addEventListener('click', buyCredit);
        
        document.getElementById('downPayment').addEventListener('input', updateCreditCalculation);
        document.getElementById('termMonths').addEventListener('input', updateCreditCalculation);
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        document.getElementById('jobsModal').addEventListener('click', (e) => {
            if (e.target.id === 'jobsModal') {
                document.getElementById('jobsModal').style.display = 'none';
            }
        });
        
        document.getElementById('shopModal').addEventListener('click', (e) => {
            if (e.target.id === 'shopModal') {
                document.getElementById('shopModal').style.display = 'none';
            }
        });
        
        document.getElementById('carsModal').addEventListener('click', (e) => {
            if (e.target.id === 'carsModal') {
                document.getElementById('carsModal').style.display = 'none';
            }
        });
        
        document.getElementById('realEstateModal').addEventListener('click', (e) => {
            if (e.target.id === 'realEstateModal') {
                document.getElementById('realEstateModal').style.display = 'none';
            }
        });
        
        document.getElementById('buyModal').addEventListener('click', (e) => {
            if (e.target.id === 'buyModal') {
                document.getElementById('buyModal').style.display = 'none';
            }
        });
        
        document.getElementById('goalsModal').addEventListener('click', (e) => {
            if (e.target.id === 'goalsModal') {
                document.getElementById('goalsModal').style.display = 'none';
            }
        });
        
        document.getElementById('statsModal').addEventListener('click', (e) => {
            if (e.target.id === 'statsModal') {
                document.getElementById('statsModal').style.display = 'none';
            }
        });
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        loadUser();
    </script>
</body>
</html>