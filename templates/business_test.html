<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –±–∏–∑–Ω–µ—Å-—Å–∏—Å—Ç–µ–º—ã</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        h1 { color: #4ecca3; }
        .section {
            background: #16213e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid #0f3460;
        }
        button {
            background: #4ecca3;
            color: #1a1a2e;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #45b393;
        }
        .business-card {
            background: #0f3460;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #4ecca3;
        }
        .profit { color: #4ecca3; }
        .loss { color: #ff6b6b; }
        input, select {
            padding: 8px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid #0f3460;
            background: #16213e;
            color: #eee;
        }
        #output {
            background: #0f3460;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #4ecca3; }
        .error { color: #ff6b6b; }
    </style>
</head>
<body>
    <h1>üè™ –¢–µ—Å—Ç –±–∏–∑–Ω–µ—Å-—Å–∏—Å—Ç–µ–º—ã</h1>
    
    <div class="section">
        <h2>üë§ User ID</h2>
        <input type="text" id="userId" value="demo_user" placeholder="User ID">
        <button onclick="loadUserData()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
    </div>

    <div class="section">
        <h2>üèóÔ∏è –°–æ–∑–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å</h2>
        <select id="businessType">
            <option value="kiosk">üè™ –ö–∏–æ—Å–∫ (50,000‚ÇΩ)</option>
            <option value="cafe">‚òï –ö–∞—Ñ–µ (300,000‚ÇΩ)</option>
            <option value="restaurant">üçΩÔ∏è –†–µ—Å—Ç–æ—Ä–∞–Ω (1,000,000‚ÇΩ)</option>
            <option value="restaurant_chain">üè¢ –°–µ—Ç—å (5,000,000‚ÇΩ)</option>
        </select>
        <button onclick="createBusiness()">–°–æ–∑–¥–∞—Ç—å</button>
    </div>

    <div class="section">
        <h2>üìã –ú–æ–∏ –±–∏–∑–Ω–µ—Å—ã</h2>
        <button onclick="loadBusinesses()">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        <div id="businessList"></div>
    </div>

    <div class="section">
        <h2>‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h2>
        <button onclick="loadConfigs()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</button>
    </div>

    <div class="section">
        <h2>üìä –í—ã–≤–æ–¥</h2>
        <div id="output">–ó–¥–µ—Å—å –±—É–¥—É—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤...</div>
    </div>

    <script>
        const userId = () => document.getElementById('userId').value;
        const output = document.getElementById('output');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }

        async function apiCall(url, method = 'GET', body = null) {
            try {
                log(`‚Üí ${method} ${url}`);
                const options = {
                    method,
                    headers: {'Content-Type': 'application/json'}
                };
                if (body) {
                    options.body = JSON.stringify(body);
                    log(`  Body: ${JSON.stringify(body, null, 2)}`);
                }
                
                const response = await fetch(url, options);
                const data = await response.json();
                
                if (response.ok) {
                    log(`‚úì ${response.status} OK`, 'success');
                    log(`  ${JSON.stringify(data, null, 2)}`);
                    return data;
                } else {
                    log(`‚úó ${response.status} Error: ${data.error || 'Unknown error'}`, 'error');
                    return null;
                }
            } catch (error) {
                log(`‚úó Network error: ${error.message}`, 'error');
                return null;
            }
        }

        async function loadUserData() {
            const data = await apiCall(`/api/user/${userId()}`);
            if (data) {
                log(`üí∞ –î–µ–Ω—å–≥–∏: ${data.money}‚ÇΩ`, 'success');
                log(`üìÖ –î–µ–Ω—å: ${data.day}/${data.max_days}`, 'success');
            }
        }

        async function createBusiness() {
            const businessType = document.getElementById('businessType').value;
            const data = await apiCall('/api/business/create', 'POST', {
                user_id: userId(),
                business_type: businessType
            });
            if (data && data.success) {
                log(`‚úì –ë–∏–∑–Ω–µ—Å —Å–æ–∑–¥–∞–Ω!`, 'success');
                await loadBusinesses();
            }
        }

        async function loadBusinesses() {
            const data = await apiCall(`/api/business/list?user_id=${userId()}`);
            if (data) {
                const container = document.getElementById('businessList');
                if (data.businesses.length === 0) {
                    container.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±–∏–∑–Ω–µ—Å–æ–≤</p>';
                } else {
                    container.innerHTML = data.businesses.map(b => `
                        <div class="business-card">
                            <h3>${b.config.emoji} ${b.config.name}</h3>
                            <p>‚≠ê –†–µ–π—Ç–∏–Ω–≥: ${b.rating.toFixed(1)}/5.0</p>
                            <p>üì¶ –ó–∞–ø–∞—Å—ã: ${b.inventory_level.toFixed(0)}%</p>
                            <p>üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${b.employees.length}/${b.config.max_employees}</p>
                            <p>üíµ –î–æ—Ö–æ–¥: ${Math.round(b.daily_revenue)}‚ÇΩ/–¥–µ–Ω—å</p>
                            <p>üí∏ –†–∞—Å—Ö–æ–¥—ã: ${Math.round(b.daily_expenses)}‚ÇΩ/–¥–µ–Ω—å</p>
                            <p class="${b.net_profit >= 0 ? 'profit' : 'loss'}">
                                üí∞ –ü—Ä–∏–±—ã–ª—å: ${b.net_profit >= 0 ? '+' : ''}${Math.round(b.net_profit)}‚ÇΩ/–¥–µ–Ω—å
                            </p>
                            <button onclick="buyInventory('${b.business_id}')">–ö—É–ø–∏—Ç—å –∑–∞–ø–∞—Å—ã (5,000‚ÇΩ)</button>
                            <button onclick="hireEmployee('${b.business_id}')">–ù–∞–Ω—è—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
                            <button onclick="sellBusiness('${b.business_id}')">–ü—Ä–æ–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å</button>
                        </div>
                    `).join('');
                }
            }
        }

        async function buyInventory(businessId) {
            const data = await apiCall(`/api/business/${businessId}/buy-inventory`, 'POST', {
                user_id: userId()
            });
            if (data && data.success) {
                log(`‚úì ${data.message}`, 'success');
                await loadBusinesses();
            }
        }

        async function hireEmployee(businessId) {
            const employeeType = prompt('–¢–∏–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (chef/cashier/manager):');
            if (!employeeType) return;
            
            const data = await apiCall(`/api/business/${businessId}/hire`, 'POST', {
                user_id: userId(),
                employee_type: employeeType
            });
            if (data && data.success) {
                log(`‚úì ${data.message}`, 'success');
                await loadBusinesses();
            }
        }

        async function sellBusiness(businessId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å?')) return;
            
            const data = await apiCall(`/api/business/${businessId}/sell`, 'POST', {
                user_id: userId()
            });
            if (data && data.success) {
                log(`‚úì ${data.message}`, 'success');
                await loadBusinesses();
            }
        }

        async function loadConfigs() {
            await apiCall('/api/business/configs');
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        window.onload = () => {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!', 'success');
            log('üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API');
        };
    </script>
</body>
</html>
